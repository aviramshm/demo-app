{"version":3,"file":"utils.js","sources":["../../../src/workflow/utils.ts"],"sourcesContent":["import type { WorkflowRuntime, WorkflowStepDefinition } from './types.js';\n\ninterface FinalizeGitOptions {\n    commitMessage: string;\n    allowEmptyCommit?: boolean;\n}\n\n/**\n * Commits (and optionally pushes) any staged changes according to the step configuration.\n * Returns true if a commit was created.\n */\nexport async function finalizeStepGitActions(\n    context: WorkflowRuntime,\n    step: WorkflowStepDefinition,\n    options: FinalizeGitOptions\n): Promise<boolean> {\n    if (!step.commit) {\n        return false;\n    }\n\n    const { gitManager, logger } = context;\n    const hasStagedChanges = await gitManager.hasStagedChanges();\n\n    if (!hasStagedChanges && !options.allowEmptyCommit) {\n        logger.debug('No staged changes to commit for step', { stepId: step.id });\n        return false;\n    }\n\n    try {\n        await gitManager.commitChanges(options.commitMessage);\n        logger.info('Committed changes for step', {\n            stepId: step.id,\n            message: options.commitMessage,\n        });\n    } catch (error) {\n        logger.error('Failed to commit changes for step', {\n            stepId: step.id,\n            error: error instanceof Error ? error.message : String(error),\n        });\n        throw error;\n    }\n\n    if (step.push) {\n        const branchName = await gitManager.getCurrentBranch();\n        await gitManager.pushBranch(branchName);\n        logger.info('Pushed branch after step', { stepId: step.id, branch: branchName });\n    }\n\n    return true;\n}\n"],"names":[],"mappings":"AAOA;;;AAGG;AACI,eAAe,sBAAsB,CACxC,OAAwB,EACxB,IAA4B,EAC5B,OAA2B,EAAA;AAE3B,IAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AACd,QAAA,OAAO,KAAK;IAChB;AAEA,IAAA,MAAM,EAAE,UAAU,EAAE,MAAM,EAAE,GAAG,OAAO;AACtC,IAAA,MAAM,gBAAgB,GAAG,MAAM,UAAU,CAAC,gBAAgB,EAAE;IAE5D,IAAI,CAAC,gBAAgB,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE;AAChD,QAAA,MAAM,CAAC,KAAK,CAAC,sCAAsC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;AACzE,QAAA,OAAO,KAAK;IAChB;AAEA,IAAA,IAAI;QACA,MAAM,UAAU,CAAC,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC;AACrD,QAAA,MAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE;YACtC,MAAM,EAAE,IAAI,CAAC,EAAE;YACf,OAAO,EAAE,OAAO,CAAC,aAAa;AACjC,SAAA,CAAC;IACN;IAAE,OAAO,KAAK,EAAE;AACZ,QAAA,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE;YAC9C,MAAM,EAAE,IAAI,CAAC,EAAE;AACf,YAAA,KAAK,EAAE,KAAK,YAAY,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC;AAChE,SAAA,CAAC;AACF,QAAA,MAAM,KAAK;IACf;AAEA,IAAA,IAAI,IAAI,CAAC,IAAI,EAAE;AACX,QAAA,MAAM,UAAU,GAAG,MAAM,UAAU,CAAC,gBAAgB,EAAE;AACtD,QAAA,MAAM,UAAU,CAAC,UAAU,CAAC,UAAU,CAAC;AACvC,QAAA,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;IACpF;AAEA,IAAA,OAAO,IAAI;AACf;;;;"}