{"version":3,"file":"types.js","sources":["../../src/types.ts"],"sourcesContent":["\n// import and export to keep a single type file\nimport type { CanUseTool, PermissionResult } from '@anthropic-ai/claude-agent-sdk';\nexport type { CanUseTool, PermissionResult };\n\n// PostHog Task model (matches Array's OpenAPI schema)\nexport interface Task {\n  id: string;\n  title: string;\n  description: string;\n  origin_product: 'error_tracking' | 'eval_clusters' | 'user_created' | 'support_queue' | 'session_summaries';\n  position?: number;\n  github_integration?: number | null;\n  repository_config?: unknown; // JSONField\n  repository_list: string;\n  primary_repository: string;\n  created_at: string;\n  updated_at: string;\n\n  // DEPRECATED: These fields have been moved to TaskRun\n  // Use task.latest_run instead\n  current_stage?: string | null;\n  github_branch?: string | null;\n  github_pr_url?: string | null;\n  latest_run?: TaskRun;\n}\n\n// Log entry structure for TaskRun.log\nexport interface LogEntry {\n  type: string; // e.g., \"info\", \"warning\", \"error\", \"success\", \"debug\"\n  message: string;\n  [key: string]: unknown; // Allow additional fields\n}\n\nexport type ArtifactType = 'plan' | 'context' | 'reference' | 'output' | 'artifact';\n\nexport interface TaskRunArtifact {\n  name: string;\n  type: ArtifactType;\n  size?: number;\n  content_type?: string;\n  storage_path?: string;\n  uploaded_at?: string;\n}\n\n// TaskRun model - represents individual execution runs of tasks\nexport interface TaskRun {\n  id: string;\n  task: string; // Task ID\n  team: number;\n  branch: string | null;\n  status: 'started' | 'in_progress' | 'completed' | 'failed';\n  log_url?: string; // Presigned S3 URL for log access (valid for 1 hour)\n  error_message: string | null;\n  output: Record<string, unknown> | null; // Structured output (PR URL, commit SHA, etc.)\n  state: Record<string, unknown>; // Intermediate run state (defaults to {}, never null)\n  artifacts?: TaskRunArtifact[];\n  created_at: string;\n  updated_at: string;\n  completed_at: string | null;\n}\n\nexport interface SupportingFile {\n  name: string;\n  content: string;\n  type: ArtifactType;\n  created_at: string;\n}\n\nexport interface TaskArtifactUploadPayload {\n  name: string;\n  type: ArtifactType;\n  content: string;\n  content_type?: string;\n}\n\nexport enum PermissionMode {\n  PLAN = \"plan\",\n  DEFAULT = \"default\",\n  ACCEPT_EDITS = \"acceptEdits\",\n  BYPASS = \"bypassPermissions\"\n}\n\nexport interface ExecutionOptions {\n  repositoryPath?: string;\n  permissionMode?: PermissionMode;\n}\n\nexport interface TaskExecutionOptions {\n  repositoryPath?: string;\n  permissionMode?: PermissionMode;\n  isCloudMode?: boolean; // Determines local vs cloud behavior (local pauses after each phase)\n  createPR?: boolean; // Whether to create PR after build (defaults to false if local. This setting has no effect if isCloudMode is true.)\n  autoProgress?: boolean;\n  queryOverrides?: Record<string, any>;\n  // Fine-grained permission control (only applied to build phase)\n  // See: https://docs.claude.com/en/api/agent-sdk/permissions\n  canUseTool?: CanUseTool;\n}\n\n// Base event with timestamp\ninterface BaseEvent {\n  ts: number;\n}\n\n// Streaming content events\nexport interface TokenEvent extends BaseEvent {\n  type: 'token';\n  content: string;\n  contentType?: 'text' | 'thinking' | 'tool_input';\n}\n\nexport interface ContentBlockStartEvent extends BaseEvent {\n  type: 'content_block_start';\n  index: number;\n  contentType: 'text' | 'tool_use' | 'thinking';\n  toolName?: string;\n  toolId?: string;\n}\n\nexport interface ContentBlockStopEvent extends BaseEvent {\n  type: 'content_block_stop';\n  index: number;\n}\n\n// Tool events\nexport interface ToolCallEvent extends BaseEvent {\n  type: 'tool_call';\n  toolName: string;\n  callId: string;\n  args: Record<string, any>;\n  parentToolUseId?: string | null;  // For nested tool calls (subagents)\n  // Tool metadata (enriched by adapter for UI consumption)\n  tool?: import('./tools/types.js').Tool;\n  category?: import('./tools/types.js').ToolCategory;\n}\n\nexport interface ToolResultEvent extends BaseEvent {\n  type: 'tool_result';\n  toolName: string;\n  callId: string;\n  result: any;\n  isError?: boolean;                // Whether the tool execution failed\n  parentToolUseId?: string | null;  // For nested tool calls (subagents)\n  // Tool metadata (enriched by adapter for UI consumption)\n  tool?: import('./tools/types.js').Tool;\n  category?: import('./tools/types.js').ToolCategory;\n}\n\n// Message lifecycle events\nexport interface MessageStartEvent extends BaseEvent {\n  type: 'message_start';\n  messageId?: string;\n  model?: string;\n}\n\nexport interface MessageDeltaEvent extends BaseEvent {\n  type: 'message_delta';\n  stopReason?: string;\n  stopSequence?: string;\n  usage?: {\n    outputTokens: number;\n  };\n}\n\nexport interface MessageStopEvent extends BaseEvent {\n  type: 'message_stop';\n}\n\n// User message events\nexport interface UserMessageEvent extends BaseEvent {\n  type: 'user_message';\n  content: string;\n  isSynthetic?: boolean;\n}\n\n// System events\nexport interface StatusEvent extends BaseEvent {\n  type: 'status';\n  phase: string;\n  // Common optional fields (varies by phase):\n  kind?: string;            // Kind of status (plan, implementation)\n  branch?: string;          // Git branch name\n  prUrl?: string;           // Pull request URL\n  taskId?: string;          // Task identifier\n  messageId?: string;       // Claude message ID\n  model?: string;           // Model name\n  [key: string]: any;       // Allow additional fields\n}\n\nexport interface InitEvent extends BaseEvent {\n  type: 'init';\n  model: string;\n  tools: string[];\n  permissionMode: string;\n  cwd: string;\n  apiKeySource: string;\n  agents?: string[];\n  slashCommands?: string[];\n  outputStyle?: string;\n  mcpServers?: Array<{ name: string; status: string }>;\n}\n\nexport interface CompactBoundaryEvent extends BaseEvent {\n  type: 'compact_boundary';\n  trigger: 'manual' | 'auto';\n  preTokens: number;\n}\n\n// Result events\nexport interface DoneEvent extends BaseEvent {\n  type: 'done';\n  result?: string;              // Final summary text from Claude\n  durationMs?: number;\n  durationApiMs?: number;       // API-only duration (excluding local processing)\n  numTurns?: number;\n  totalCostUsd?: number;\n  usage?: any;\n  modelUsage?: {                // Per-model usage breakdown\n    [modelName: string]: {\n      inputTokens: number;\n      outputTokens: number;\n      cacheReadInputTokens: number;\n      cacheCreationInputTokens: number;\n      webSearchRequests: number;\n      costUSD: number;\n      contextWindow: number;\n    };\n  };\n  permissionDenials?: Array<{   // Tools that were denied by permissions\n    tool_name: string;\n    tool_use_id: string;\n    tool_input: Record<string, unknown>;\n  }>;\n}\n\nexport interface ErrorEvent extends BaseEvent {\n  type: 'error';\n  message: string;\n  error?: any;\n  errorType?: string;\n  context?: Record<string, any>; // Partial error context for debugging\n  sdkError?: any; // Original SDK error object\n}\n\n// Metric and artifact events (general purpose, not tool-specific)\nexport interface MetricEvent extends BaseEvent {\n  type: 'metric';\n  key: string;\n  value: number;\n  unit?: string;\n}\n\nexport interface ArtifactEvent extends BaseEvent {\n  type: 'artifact';\n  kind: string;\n  content: any;\n}\n\nexport interface RawSDKEvent extends BaseEvent {\n  type: 'raw_sdk_event';\n  sdkMessage: any; // Full SDK message for debugging\n}\n\nexport type AgentEvent =\n  | TokenEvent\n  | ContentBlockStartEvent\n  | ContentBlockStopEvent\n  | ToolCallEvent\n  | ToolResultEvent\n  | MessageStartEvent\n  | MessageDeltaEvent\n  | MessageStopEvent\n  | UserMessageEvent\n  | StatusEvent\n  | InitEvent\n  | CompactBoundaryEvent\n  | DoneEvent\n  | ErrorEvent\n  | MetricEvent\n  | ArtifactEvent\n  | RawSDKEvent;\n\nexport interface ExecutionResult {\n  results: any[];\n}\n\nexport interface PlanResult {\n  plan: string;\n}\n\nexport interface TaskExecutionResult {\n  task: Task;\n  plan?: string;\n  executionResult?: ExecutionResult;\n}\n\n// MCP Server configuration types (re-exported from Claude SDK for convenience)\nexport type McpServerConfig = {\n  type?: 'stdio';\n  command: string;\n  args?: string[];\n  env?: Record<string, string>;\n} | {\n  type: 'sse';\n  url: string;\n  headers?: Record<string, string>;\n} | {\n  type: 'http';\n  url: string;\n  headers?: Record<string, string>;\n} | {\n  type: 'sdk';\n  name: string;\n  instance?: any; // McpServer instance\n};\n\nexport interface AgentConfig {\n  workingDirectory?: string;\n  onEvent?: (event: AgentEvent) => void;\n\n  // PostHog API configuration\n  posthogApiUrl: string;\n  posthogApiKey: string;\n  posthogProjectId: number;\n\n  // PostHog MCP configuration\n  posthogMcpUrl?: string;\n\n\n  // MCP Server configuration\n  // Additional MCP servers (PostHog MCP is always included by default)\n  // You can override the PostHog MCP config by providing mcpServers.posthog\n  mcpServers?: Record<string, McpServerConfig>;\n\n  // Logging configuration\n  debug?: boolean;\n\n  // Fine-grained permission control for direct run() calls\n  // See: https://docs.claude.com/en/api/agent-sdk/permissions\n  canUseTool?: CanUseTool;\n}\n\nexport interface PostHogAPIConfig {\n  apiUrl: string;\n  apiKey: string;\n  projectId: number;\n}\n\n// URL mention types\nexport type ResourceType = 'error' | 'experiment' | 'insight' | 'feature_flag' | 'generic';\n\nexport interface PostHogResource {\n  type: ResourceType;\n  id: string;\n  url: string;\n  title?: string;\n  content: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface UrlMention {\n  url: string;\n  type: ResourceType;\n  id?: string;\n  label?: string;\n}\n\n// Research evaluation types\nexport interface ResearchQuestion {\n  id: string;\n  question: string;\n  options: string[];\n}\n\nexport interface ResearchAnswer {\n  questionId: string;\n  selectedOption: string;\n  customInput?: string;\n}\n\nexport interface ResearchEvaluation {\n  actionabilityScore: number;    // 0-1 confidence score\n  context: string;               // brief summary for planning\n  keyFiles: string[];            // files needing modification\n  blockers?: string[];           // what's preventing full confidence\n  questions?: ResearchQuestion[]; // only if score < 0.7\n  answered?: boolean;            // whether questions have been answered\n  answers?: ResearchAnswer[];    // user's answers to questions\n}"],"names":[],"mappings":"IA4EY;AAAZ,CAAA,UAAY,cAAc,EAAA;AACxB,IAAA,cAAA,CAAA,MAAA,CAAA,GAAA,MAAa;AACb,IAAA,cAAA,CAAA,SAAA,CAAA,GAAA,SAAmB;AACnB,IAAA,cAAA,CAAA,cAAA,CAAA,GAAA,aAA4B;AAC5B,IAAA,cAAA,CAAA,QAAA,CAAA,GAAA,mBAA4B;AAC9B,CAAC,EALW,cAAc,KAAd,cAAc,GAAA,EAAA,CAAA,CAAA;;;;"}