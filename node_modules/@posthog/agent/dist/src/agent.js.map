{"version":3,"file":"agent.js","sources":["../../src/agent.ts"],"sourcesContent":["import { query } from \"@anthropic-ai/claude-agent-sdk\";\nimport type { Task, ExecutionResult, AgentConfig, CanUseTool } from './types.js';\nimport { TaskManager } from './task-manager.js';\nimport { PostHogAPIClient } from './posthog-api.js';\nimport { PostHogFileManager } from './file-manager.js';\nimport { GitManager } from './git-manager.js';\nimport { TemplateManager } from './template-manager.js';\nimport { ClaudeAdapter } from './adapters/claude/claude-adapter.js';\nimport type { ProviderAdapter } from './adapters/types.js';\nimport { Logger } from './utils/logger.js';\nimport { PromptBuilder } from './prompt-builder.js';\nimport { TaskProgressReporter } from './task-progress-reporter.js';\nimport { TASK_WORKFLOW } from './workflow/config.js';\nimport type { WorkflowRuntime } from './workflow/types.js';\n\nexport class Agent {\n    private workingDirectory: string;\n    private onEvent?: (event: any) => void;\n    private taskManager: TaskManager;\n    private posthogAPI?: PostHogAPIClient;\n    private fileManager: PostHogFileManager;\n    private gitManager: GitManager;\n    private templateManager: TemplateManager;\n    private adapter: ProviderAdapter;\n    private logger: Logger;\n    private progressReporter: TaskProgressReporter;\n    private promptBuilder: PromptBuilder;\n    private mcpServers?: Record<string, any>;\n    private canUseTool?: CanUseTool;\n    public debug: boolean;\n\n    constructor(config: AgentConfig) {\n        this.workingDirectory = config.workingDirectory || process.cwd();\n        this.onEvent = config.onEvent;\n        this.canUseTool = config.canUseTool;\n        this.debug = config.debug || false;\n\n        // Build default PostHog MCP server configuration\n        const posthogMcpUrl = config.posthogMcpUrl\n            || process.env.POSTHOG_MCP_URL\n            || 'https://mcp.posthog.com/mcp';\n\n        // Add auth if API key provided\n        const headers: Record<string, string> = {};\n        if (config.posthogApiKey) {\n            headers['Authorization'] = `Bearer ${config.posthogApiKey}`;\n        }\n\n        const defaultMcpServers = {\n            posthog: {\n                type: 'http' as const,\n                url: posthogMcpUrl,\n                ...(Object.keys(headers).length > 0 ? { headers } : {}),\n            }\n        };\n\n        // Merge default PostHog MCP with user-provided servers (user config takes precedence)\n        this.mcpServers = {\n            ...defaultMcpServers,\n            ...config.mcpServers\n        };\n        this.logger = new Logger({ debug: this.debug, prefix: '[PostHog Agent]' });\n        this.taskManager = new TaskManager();\n        // Hardcode Claude adapter for now - extensible for other providers later\n        this.adapter = new ClaudeAdapter();\n\n        this.fileManager = new PostHogFileManager(\n            this.workingDirectory,\n            this.logger.child('FileManager')\n        );\n        this.gitManager = new GitManager({\n            repositoryPath: this.workingDirectory,\n            logger: this.logger.child('GitManager')\n            // TODO: Add author config from environment or config\n        });\n        this.templateManager = new TemplateManager();\n\n        if (config.posthogApiUrl && config.posthogApiKey) {\n            this.posthogAPI = new PostHogAPIClient({\n                apiUrl: config.posthogApiUrl,\n                apiKey: config.posthogApiKey,\n                projectId: config.posthogProjectId,\n            });\n        }\n\n        this.promptBuilder = new PromptBuilder({\n            getTaskFiles: (taskId: string) => this.getTaskFiles(taskId),\n            generatePlanTemplate: (vars) => this.templateManager.generatePlan(vars),\n            posthogClient: this.posthogAPI,\n            logger: this.logger.child('PromptBuilder')\n        });\n        this.progressReporter = new TaskProgressReporter(this.posthogAPI, this.logger);\n    }\n\n    /**\n     * Enable or disable debug logging\n     */\n    setDebug(enabled: boolean) {\n        this.debug = enabled;\n        this.logger.setDebug(enabled);\n    }\n\n    /**\n     * Configure LLM gateway environment variables for Claude Code CLI\n     */\n    private async _configureLlmGateway(): Promise<void> {\n        if (!this.posthogAPI) {\n            return;\n        }\n\n        try {\n            const gatewayUrl = this.posthogAPI.getLlmGatewayUrl();\n            const apiKey = this.posthogAPI.getApiKey();\n\n            process.env.ANTHROPIC_BASE_URL = gatewayUrl;\n            process.env.ANTHROPIC_AUTH_TOKEN = apiKey;\n            this.ensureOpenAIGatewayEnv(gatewayUrl, apiKey);\n\n            this.logger.debug('Configured LLM gateway', { gatewayUrl });\n        } catch (error) {\n            this.logger.error('Failed to configure LLM gateway', error);\n            throw error;\n        }\n    }\n\n    // Adaptive task execution orchestrated via workflow steps\n    async runTask(taskOrId: Task | string, options: import('./types.js').TaskExecutionOptions = {}): Promise<void> {\n        await this._configureLlmGateway();\n\n        const task = typeof taskOrId === 'string' ? await this.fetchTask(taskOrId) : taskOrId;\n        const cwd = options.repositoryPath || this.workingDirectory;\n        const isCloudMode = options.isCloudMode ?? false;\n        const taskSlug = (task as any).slug || task.id;\n\n        this.logger.info('Starting adaptive task execution', { taskId: task.id, taskSlug, isCloudMode });\n\n        // Initialize progress reporter for task run tracking (needed for PR attachment)\n        await this.progressReporter.start(task.id, { totalSteps: TASK_WORKFLOW.length });\n        this.emitEvent(this.adapter.createStatusEvent('run_started', { runId: this.progressReporter.runId }));\n\n        await this.prepareTaskBranch(taskSlug, isCloudMode);\n\n        let taskError: Error | undefined;\n        try {\n            const workflowContext: WorkflowRuntime = {\n                task,\n                taskSlug,\n                cwd,\n                isCloudMode,\n                options,\n                logger: this.logger,\n                fileManager: this.fileManager,\n                gitManager: this.gitManager,\n                promptBuilder: this.promptBuilder,\n                progressReporter: this.progressReporter,\n                adapter: this.adapter,\n                mcpServers: this.mcpServers,\n                posthogAPI: this.posthogAPI,\n                emitEvent: (event: any) => this.emitEvent(event),\n                stepResults: {},\n            };\n\n            for (const step of TASK_WORKFLOW) {\n                const result = await step.run({ step, context: workflowContext });\n                if (result.halt) {\n                    return;\n                }\n            }\n\n            const shouldCreatePR = options.createPR ?? isCloudMode;\n            if (shouldCreatePR) {\n                await this.ensurePullRequest(task, workflowContext.stepResults);\n            }\n\n            this.logger.info('Task execution complete', { taskId: task.id });\n            this.emitEvent(this.adapter.createStatusEvent('task_complete', { taskId: task.id }));\n        } catch (error) {\n            taskError = error instanceof Error ? error : new Error(String(error));\n            this.logger.error('Task execution failed', { taskId: task.id, error: taskError.message });\n        } finally {\n            if (taskError) {\n                await this.progressReporter.fail(taskError);\n                throw taskError;\n            } else {\n                await this.progressReporter.complete();\n            }\n        }\n    }\n\n    // Direct prompt execution - still supported for low-level usage\n    async run(prompt: string, options: { repositoryPath?: string; permissionMode?: import('./types.js').PermissionMode; queryOverrides?: Record<string, any>; canUseTool?: CanUseTool } = {}): Promise<ExecutionResult> {\n        await this._configureLlmGateway();\n        const baseOptions: Record<string, any> = {\n            model: \"claude-sonnet-4-5-20250929\",\n            cwd: options.repositoryPath || this.workingDirectory,\n            permissionMode: (options.permissionMode as any) || \"default\",\n            settingSources: [\"local\"],\n            mcpServers: this.mcpServers,\n        };\n\n        // Add canUseTool hook if provided (options take precedence over instance config)\n        const canUseTool = options.canUseTool || this.canUseTool;\n        if (canUseTool) {\n            baseOptions.canUseTool = canUseTool;\n        }\n\n        const response = query({\n            prompt,\n            options: { ...baseOptions, ...(options.queryOverrides || {}) },\n        });\n\n        const results = [];\n        for await (const message of response) {\n            this.logger.debug('Received message in direct run', message);\n            // Emit raw SDK event\n            this.emitEvent(this.adapter.createRawSDKEvent(message));\n            const transformedEvents = this.adapter.transform(message);\n            for (const event of transformedEvents) {\n                this.emitEvent(event);\n            }\n            results.push(message);\n        }\n        \n        return { results };\n    }\n    \n    // PostHog task operations\n    async fetchTask(taskId: string): Promise<Task> {\n        this.logger.debug('Fetching task from PostHog', { taskId });\n        if (!this.posthogAPI) {\n            const error = new Error('PostHog API not configured. Provide posthogApiUrl and posthogApiKey in constructor.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n        return this.posthogAPI.fetchTask(taskId);\n    }\n\n    getPostHogClient(): PostHogAPIClient | undefined {\n        return this.posthogAPI;\n    }\n    \n    async listTasks(filters?: {\n        repository?: string;\n        organization?: string;\n        origin_product?: string;\n    }): Promise<Task[]> {\n        if (!this.posthogAPI) {\n            throw new Error('PostHog API not configured. Provide posthogApiUrl and posthogApiKey in constructor.');\n        }\n        return this.posthogAPI.listTasks(filters);\n    }\n    \n    // File system operations for task artifacts\n    async writeTaskFile(taskId: string, fileName: string, content: string, type: 'plan' | 'context' | 'reference' | 'output' = 'reference'): Promise<void> {\n        this.logger.debug('Writing task file', { taskId, fileName, type, contentLength: content.length });\n        await this.fileManager.writeTaskFile(taskId, { name: fileName, content, type });\n    }\n    \n    async readTaskFile(taskId: string, fileName: string): Promise<string | null> {\n        this.logger.debug('Reading task file', { taskId, fileName });\n        return await this.fileManager.readTaskFile(taskId, fileName);\n    }\n    \n    async getTaskFiles(taskId: string): Promise<any[]> {\n        this.logger.debug('Getting task files', { taskId });\n        const files = await this.fileManager.getTaskFiles(taskId);\n        this.logger.debug('Found task files', { taskId, fileCount: files.length });\n        return files;\n    }\n    \n    async writePlan(taskId: string, plan: string): Promise<void> {\n        this.logger.info('Writing plan', { taskId, planLength: plan.length });\n        await this.fileManager.writePlan(taskId, plan);\n    }\n    \n    async readPlan(taskId: string): Promise<string | null> {\n        this.logger.debug('Reading plan', { taskId });\n        return await this.fileManager.readPlan(taskId);\n    }\n\n    // Git operations for task execution\n    async createPlanningBranch(taskId: string): Promise<string> {\n        this.logger.info('Creating planning branch', { taskId });\n        const branchName = await this.gitManager.createTaskPlanningBranch(taskId);\n        this.logger.debug('Planning branch created', { taskId, branchName });\n        return branchName;\n    }\n    \n    async commitPlan(taskId: string, taskTitle: string): Promise<string> {\n        this.logger.info('Committing plan', { taskId, taskTitle });\n        const commitHash = await this.gitManager.commitPlan(taskId, taskTitle);\n        this.logger.debug('Plan committed', { taskId, commitHash });\n        return commitHash;\n    }\n    \n    async createImplementationBranch(taskId: string, planningBranchName?: string): Promise<string> {\n        this.logger.info('Creating implementation branch', { taskId, fromBranch: planningBranchName });\n        const branchName = await this.gitManager.createTaskImplementationBranch(taskId, planningBranchName);\n        this.logger.debug('Implementation branch created', { taskId, branchName });\n        return branchName;\n    }\n    \n    async commitImplementation(taskId: string, taskTitle: string, planSummary?: string): Promise<string> {\n        this.logger.info('Committing implementation', { taskId, taskTitle });\n        const commitHash = await this.gitManager.commitImplementation(taskId, taskTitle, planSummary);\n        this.logger.debug('Implementation committed', { taskId, commitHash });\n        return commitHash;\n    }\n\n    async createPullRequest(\n        taskId: string,\n        branchName: string,\n        taskTitle: string,\n        taskDescription: string,\n        customBody?: string\n    ): Promise<string> {\n        this.logger.info('Creating pull request', { taskId, branchName, taskTitle });\n\n        const defaultBody = `## Task Details\n**Task ID**: ${taskId}\n**Description**: ${taskDescription}\n\n## Changes\nThis PR implements the changes described in the task.\n\nGenerated by PostHog Agent`;\n        const prBody = customBody || defaultBody;\n\n        const prUrl = await this.gitManager.createPullRequest(\n            branchName,\n            taskTitle,\n            prBody\n        );\n\n        this.logger.info('Pull request created', { taskId, prUrl });\n        return prUrl;\n    }\n\n    async attachPullRequestToTask(taskId: string, prUrl: string, branchName?: string): Promise<void> {\n        this.logger.info('Attaching PR to task run', { taskId, prUrl, branchName });\n\n        if (!this.posthogAPI || !this.progressReporter.runId) {\n            const error = new Error('PostHog API not configured or no active run. Cannot attach PR to task.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n\n        const updates: any = {\n            output: { pr_url: prUrl }\n        };\n        if (branchName) {\n            updates.branch = branchName;\n        }\n\n        await this.posthogAPI.updateTaskRun(taskId, this.progressReporter.runId, updates);\n        this.logger.debug('PR attached to task run', { taskId, runId: this.progressReporter.runId, prUrl });\n    }\n\n    async updateTaskBranch(taskId: string, branchName: string): Promise<void> {\n        this.logger.info('Updating task run branch', { taskId, branchName });\n\n        if (!this.posthogAPI || !this.progressReporter.runId) {\n            const error = new Error('PostHog API not configured or no active run. Cannot update branch.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n\n        await this.posthogAPI.updateTaskRun(taskId, this.progressReporter.runId, { branch: branchName });\n        this.logger.debug('Task run branch updated', { taskId, runId: this.progressReporter.runId, branchName });\n    }\n\n    // Execution management\n    cancelTask(taskId: string): void {\n        // Find the execution for this task and cancel it\n        for (const [executionId, execution] of this.taskManager['executionStates']) {\n            if (execution.taskId === taskId && execution.status === 'running') {\n                this.taskManager.cancelExecution(executionId);\n                break;\n            }\n        }\n    }\n\n    getTaskExecutionStatus(taskId: string): string | null {\n        // Find the execution for this task\n        for (const execution of this.taskManager['executionStates'].values()) {\n            if (execution.taskId === taskId) {\n                return execution.status;\n            }\n        }\n        return null;\n    }\n\n    private async prepareTaskBranch(taskSlug: string, isCloudMode: boolean): Promise<void> {\n        if (await this.gitManager.hasChanges()) {\n            throw new Error('Cannot start task with uncommitted changes. Please commit or stash your changes first.');\n        }\n\n        await this.gitManager.resetToDefaultBranchIfNeeded();\n\n        const existingBranch = await this.gitManager.getTaskBranch(taskSlug);\n        if (!existingBranch) {\n            const branchName = await this.gitManager.createTaskBranch(taskSlug);\n            this.emitEvent(this.adapter.createStatusEvent('branch_created', { branch: branchName }));\n\n            await this.gitManager.addAllPostHogFiles();\n            \n            // Only commit if there are changes or we're in cloud mode\n            if (isCloudMode) {\n                await this.gitManager.commitAndPush(`Initialize task ${taskSlug}`, { allowEmpty: true });\n            } else {\n                // Check if there are any changes before committing\n                const hasChanges = await this.gitManager.hasStagedChanges();\n                if (hasChanges) {\n                    await this.gitManager.commitChanges(`Initialize task ${taskSlug}`);\n                }\n            }\n        } else {\n            this.logger.info('Switching to existing task branch', { branch: existingBranch });\n            await this.gitManager.switchToBranch(existingBranch);\n        }\n    }\n\n    private ensureOpenAIGatewayEnv(gatewayUrl?: string, token?: string): void {\n        const resolvedGatewayUrl = gatewayUrl || process.env.ANTHROPIC_BASE_URL;\n        const resolvedToken = token || process.env.ANTHROPIC_AUTH_TOKEN;\n\n        if (resolvedGatewayUrl) {\n            process.env.OPENAI_BASE_URL = resolvedGatewayUrl;\n        }\n\n        if (resolvedToken) {\n            process.env.OPENAI_API_KEY = resolvedToken;\n        }\n    }\n\n    private async ensurePullRequest(task: Task, stepResults: Record<string, any>): Promise<void> {\n        const latestRun = task.latest_run;\n        const existingPr =\n            latestRun?.output && typeof latestRun.output === 'object'\n                ? (latestRun.output as any).pr_url\n                : null;\n\n        if (existingPr) {\n            this.logger.info('PR already exists, skipping creation', { taskId: task.id, prUrl: existingPr });\n            return;\n        }\n\n        const buildResult = stepResults['build'];\n        if (!buildResult?.commitCreated) {\n            this.logger.warn('Build step did not produce a commit; skipping PR creation', { taskId: task.id });\n            return;\n        }\n\n        const branchName = await this.gitManager.getCurrentBranch();\n        const finalizeResult = stepResults['finalize'];\n        const prBody = finalizeResult?.prBody;\n\n        const prUrl = await this.createPullRequest(\n            task.id,\n            branchName,\n            task.title,\n            task.description ?? '',\n            prBody\n        );\n\n        this.emitEvent(this.adapter.createStatusEvent('pr_created', { prUrl }));\n\n        try {\n            await this.attachPullRequestToTask(task.id, prUrl, branchName);\n            this.logger.info('PR attached to task successfully', { taskId: task.id, prUrl });\n        } catch (error) {\n            this.logger.warn('Could not attach PR to task', {\n                error: error instanceof Error ? error.message : String(error),\n            });\n        }\n    }\n\n    private emitEvent(event: any): void {\n        if (this.debug && event.type !== 'token') {\n            // Log all events except tokens (too verbose)\n            this.logger.debug('Emitting event', { type: event.type, ts: event.ts });\n        }\n        const persistPromise = this.progressReporter.recordEvent(event);\n        if (persistPromise && typeof persistPromise.then === 'function') {\n            persistPromise.catch((error: Error) =>\n                this.logger.debug('Failed to persist agent event', { message: error.message })\n            );\n        }\n        this.onEvent?.(event);\n    }\n}\n\nexport { PermissionMode } from './types.js';\nexport type { Task, SupportingFile, ExecutionResult, AgentConfig } from './types.js';\n"],"names":[],"mappings":";;;;;;;;;;;;;MAea,KAAK,CAAA;AACN,IAAA,gBAAgB;AAChB,IAAA,OAAO;AACP,IAAA,WAAW;AACX,IAAA,UAAU;AACV,IAAA,WAAW;AACX,IAAA,UAAU;AACV,IAAA,eAAe;AACf,IAAA,OAAO;AACP,IAAA,MAAM;AACN,IAAA,gBAAgB;AAChB,IAAA,aAAa;AACb,IAAA,UAAU;AACV,IAAA,UAAU;AACX,IAAA,KAAK;AAEZ,IAAA,WAAA,CAAY,MAAmB,EAAA;QAC3B,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC,gBAAgB,IAAI,OAAO,CAAC,GAAG,EAAE;AAChE,QAAA,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO;AAC7B,QAAA,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU;QACnC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,IAAI,KAAK;;AAGlC,QAAA,MAAM,aAAa,GAAG,MAAM,CAAC;eACtB,OAAO,CAAC,GAAG,CAAC;AACZ,eAAA,6BAA6B;;QAGpC,MAAM,OAAO,GAA2B,EAAE;AAC1C,QAAA,IAAI,MAAM,CAAC,aAAa,EAAE;YACtB,OAAO,CAAC,eAAe,CAAC,GAAG,UAAU,MAAM,CAAC,aAAa,CAAA,CAAE;QAC/D;AAEA,QAAA,MAAM,iBAAiB,GAAG;AACtB,YAAA,OAAO,EAAE;AACL,gBAAA,IAAI,EAAE,MAAe;AACrB,gBAAA,GAAG,EAAE,aAAa;gBAClB,IAAI,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC;AAC1D;SACJ;;QAGD,IAAI,CAAC,UAAU,GAAG;AACd,YAAA,GAAG,iBAAiB;YACpB,GAAG,MAAM,CAAC;SACb;AACD,QAAA,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,MAAM,EAAE,iBAAiB,EAAE,CAAC;AAC1E,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,WAAW,EAAE;;AAEpC,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,aAAa,EAAE;AAElC,QAAA,IAAI,CAAC,WAAW,GAAG,IAAI,kBAAkB,CACrC,IAAI,CAAC,gBAAgB,EACrB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CACnC;AACD,QAAA,IAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC;YAC7B,cAAc,EAAE,IAAI,CAAC,gBAAgB;YACrC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY;;AAEzC,SAAA,CAAC;AACF,QAAA,IAAI,CAAC,eAAe,GAAG,IAAI,eAAe,EAAE;QAE5C,IAAI,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAa,EAAE;AAC9C,YAAA,IAAI,CAAC,UAAU,GAAG,IAAI,gBAAgB,CAAC;gBACnC,MAAM,EAAE,MAAM,CAAC,aAAa;gBAC5B,MAAM,EAAE,MAAM,CAAC,aAAa;gBAC5B,SAAS,EAAE,MAAM,CAAC,gBAAgB;AACrC,aAAA,CAAC;QACN;AAEA,QAAA,IAAI,CAAC,aAAa,GAAG,IAAI,aAAa,CAAC;YACnC,YAAY,EAAE,CAAC,MAAc,KAAK,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;AAC3D,YAAA,oBAAoB,EAAE,CAAC,IAAI,KAAK,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,IAAI,CAAC;YACvE,aAAa,EAAE,IAAI,CAAC,UAAU;YAC9B,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,eAAe;AAC5C,SAAA,CAAC;AACF,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,oBAAoB,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC;IAClF;AAEA;;AAEG;AACH,IAAA,QAAQ,CAAC,OAAgB,EAAA;AACrB,QAAA,IAAI,CAAC,KAAK,GAAG,OAAO;AACpB,QAAA,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;IACjC;AAEA;;AAEG;AACK,IAAA,MAAM,oBAAoB,GAAA;AAC9B,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YAClB;QACJ;AAEA,QAAA,IAAI;YACA,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE;YACrD,MAAM,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE;AAE1C,YAAA,OAAO,CAAC,GAAG,CAAC,kBAAkB,GAAG,UAAU;AAC3C,YAAA,OAAO,CAAC,GAAG,CAAC,oBAAoB,GAAG,MAAM;AACzC,YAAA,IAAI,CAAC,sBAAsB,CAAC,UAAU,EAAE,MAAM,CAAC;YAE/C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wBAAwB,EAAE,EAAE,UAAU,EAAE,CAAC;QAC/D;QAAE,OAAO,KAAK,EAAE;YACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC;AAC3D,YAAA,MAAM,KAAK;QACf;IACJ;;AAGA,IAAA,MAAM,OAAO,CAAC,QAAuB,EAAE,UAAqD,EAAE,EAAA;AAC1F,QAAA,MAAM,IAAI,CAAC,oBAAoB,EAAE;QAEjC,MAAM,IAAI,GAAG,OAAO,QAAQ,KAAK,QAAQ,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,QAAQ;QACrF,MAAM,GAAG,GAAG,OAAO,CAAC,cAAc,IAAI,IAAI,CAAC,gBAAgB;AAC3D,QAAA,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,IAAI,KAAK;QAChD,MAAM,QAAQ,GAAI,IAAY,CAAC,IAAI,IAAI,IAAI,CAAC,EAAE;AAE9C,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kCAAkC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,WAAW,EAAE,CAAC;;AAGhG,QAAA,MAAM,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,UAAU,EAAE,aAAa,CAAC,MAAM,EAAE,CAAC;QAChF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,aAAa,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC,CAAC;QAErG,MAAM,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,WAAW,CAAC;AAEnD,QAAA,IAAI,SAA4B;AAChC,QAAA,IAAI;AACA,YAAA,MAAM,eAAe,GAAoB;gBACrC,IAAI;gBACJ,QAAQ;gBACR,GAAG;gBACH,WAAW;gBACX,OAAO;gBACP,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,WAAW,EAAE,IAAI,CAAC,WAAW;gBAC7B,UAAU,EAAE,IAAI,CAAC,UAAU;gBAC3B,aAAa,EAAE,IAAI,CAAC,aAAa;gBACjC,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;gBACvC,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,UAAU,EAAE,IAAI,CAAC,UAAU;gBAC3B,UAAU,EAAE,IAAI,CAAC,UAAU;gBAC3B,SAAS,EAAE,CAAC,KAAU,KAAK,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;AAChD,gBAAA,WAAW,EAAE,EAAE;aAClB;AAED,YAAA,KAAK,MAAM,IAAI,IAAI,aAAa,EAAE;AAC9B,gBAAA,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC;AACjE,gBAAA,IAAI,MAAM,CAAC,IAAI,EAAE;oBACb;gBACJ;YACJ;AAEA,YAAA,MAAM,cAAc,GAAG,OAAO,CAAC,QAAQ,IAAI,WAAW;YACtD,IAAI,cAAc,EAAE;gBAChB,MAAM,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,eAAe,CAAC,WAAW,CAAC;YACnE;AAEA,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;YAChE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;QACxF;QAAE,OAAO,KAAK,EAAE;AACZ,YAAA,SAAS,GAAG,KAAK,YAAY,KAAK,GAAG,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YACrE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,uBAAuB,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,SAAS,CAAC,OAAO,EAAE,CAAC;QAC7F;gBAAU;YACN,IAAI,SAAS,EAAE;gBACX,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC;AAC3C,gBAAA,MAAM,SAAS;YACnB;iBAAO;AACH,gBAAA,MAAM,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE;YAC1C;QACJ;IACJ;;AAGA,IAAA,MAAM,GAAG,CAAC,MAAc,EAAE,UAA4J,EAAE,EAAA;AACpL,QAAA,MAAM,IAAI,CAAC,oBAAoB,EAAE;AACjC,QAAA,MAAM,WAAW,GAAwB;AACrC,YAAA,KAAK,EAAE,4BAA4B;AACnC,YAAA,GAAG,EAAE,OAAO,CAAC,cAAc,IAAI,IAAI,CAAC,gBAAgB;AACpD,YAAA,cAAc,EAAG,OAAO,CAAC,cAAsB,IAAI,SAAS;YAC5D,cAAc,EAAE,CAAC,OAAO,CAAC;YACzB,UAAU,EAAE,IAAI,CAAC,UAAU;SAC9B;;QAGD,MAAM,UAAU,GAAG,OAAO,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU;QACxD,IAAI,UAAU,EAAE;AACZ,YAAA,WAAW,CAAC,UAAU,GAAG,UAAU;QACvC;QAEA,MAAM,QAAQ,GAAG,KAAK,CAAC;YACnB,MAAM;AACN,YAAA,OAAO,EAAE,EAAE,GAAG,WAAW,EAAE,IAAI,OAAO,CAAC,cAAc,IAAI,EAAE,CAAC,EAAE;AACjE,SAAA,CAAC;QAEF,MAAM,OAAO,GAAG,EAAE;AAClB,QAAA,WAAW,MAAM,OAAO,IAAI,QAAQ,EAAE;YAClC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gCAAgC,EAAE,OAAO,CAAC;;AAE5D,YAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;YACvD,MAAM,iBAAiB,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC;AACzD,YAAA,KAAK,MAAM,KAAK,IAAI,iBAAiB,EAAE;AACnC,gBAAA,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;YACzB;AACA,YAAA,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC;QACzB;QAEA,OAAO,EAAE,OAAO,EAAE;IACtB;;IAGA,MAAM,SAAS,CAAC,MAAc,EAAA;QAC1B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,EAAE,MAAM,EAAE,CAAC;AAC3D,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;AAClB,YAAA,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,qFAAqF,CAAC;YAC9G,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC;AACtD,YAAA,MAAM,KAAK;QACf;QACA,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC;IAC5C;IAEA,gBAAgB,GAAA;QACZ,OAAO,IAAI,CAAC,UAAU;IAC1B;IAEA,MAAM,SAAS,CAAC,OAIf,EAAA;AACG,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;AAClB,YAAA,MAAM,IAAI,KAAK,CAAC,qFAAqF,CAAC;QAC1G;QACA,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,OAAO,CAAC;IAC7C;;IAGA,MAAM,aAAa,CAAC,MAAc,EAAE,QAAgB,EAAE,OAAe,EAAE,IAAA,GAAoD,WAAW,EAAA;QAClI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mBAAmB,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,CAAC,MAAM,EAAE,CAAC;AACjG,QAAA,MAAM,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;IACnF;AAEA,IAAA,MAAM,YAAY,CAAC,MAAc,EAAE,QAAgB,EAAA;AAC/C,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mBAAmB,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;QAC5D,OAAO,MAAM,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;IAChE;IAEA,MAAM,YAAY,CAAC,MAAc,EAAA;QAC7B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,oBAAoB,EAAE,EAAE,MAAM,EAAE,CAAC;QACnD,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC;AACzD,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kBAAkB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,CAAC,MAAM,EAAE,CAAC;AAC1E,QAAA,OAAO,KAAK;IAChB;AAEA,IAAA,MAAM,SAAS,CAAC,MAAc,EAAE,IAAY,EAAA;AACxC,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC;QACrE,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC;IAClD;IAEA,MAAM,QAAQ,CAAC,MAAc,EAAA;QACzB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,cAAc,EAAE,EAAE,MAAM,EAAE,CAAC;QAC7C,OAAO,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC;IAClD;;IAGA,MAAM,oBAAoB,CAAC,MAAc,EAAA;QACrC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,MAAM,EAAE,CAAC;QACxD,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,wBAAwB,CAAC,MAAM,CAAC;AACzE,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;AACpE,QAAA,OAAO,UAAU;IACrB;AAEA,IAAA,MAAM,UAAU,CAAC,MAAc,EAAE,SAAiB,EAAA;AAC9C,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC;AAC1D,QAAA,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,MAAM,EAAE,SAAS,CAAC;AACtE,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;AAC3D,QAAA,OAAO,UAAU;IACrB;AAEA,IAAA,MAAM,0BAA0B,CAAC,MAAc,EAAE,kBAA2B,EAAA;AACxE,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,gCAAgC,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,kBAAkB,EAAE,CAAC;AAC9F,QAAA,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,8BAA8B,CAAC,MAAM,EAAE,kBAAkB,CAAC;AACnG,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;AAC1E,QAAA,OAAO,UAAU;IACrB;AAEA,IAAA,MAAM,oBAAoB,CAAC,MAAc,EAAE,SAAiB,EAAE,WAAoB,EAAA;AAC9E,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,2BAA2B,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC;AACpE,QAAA,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,oBAAoB,CAAC,MAAM,EAAE,SAAS,EAAE,WAAW,CAAC;AAC7F,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;AACrE,QAAA,OAAO,UAAU;IACrB;IAEA,MAAM,iBAAiB,CACnB,MAAc,EACd,UAAkB,EAClB,SAAiB,EACjB,eAAuB,EACvB,UAAmB,EAAA;AAEnB,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC;AAE5E,QAAA,MAAM,WAAW,GAAG,CAAA;eACb,MAAM;mBACF,eAAe;;;;;2BAKP;AACnB,QAAA,MAAM,MAAM,GAAG,UAAU,IAAI,WAAW;AAExC,QAAA,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,iBAAiB,CACjD,UAAU,EACV,SAAS,EACT,MAAM,CACT;AAED,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAsB,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;AAC3D,QAAA,OAAO,KAAK;IAChB;AAEA,IAAA,MAAM,uBAAuB,CAAC,MAAc,EAAE,KAAa,EAAE,UAAmB,EAAA;AAC5E,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC;AAE3E,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE;AAClD,YAAA,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,wEAAwE,CAAC;YACjG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC;AACtD,YAAA,MAAM,KAAK;QACf;AAEA,QAAA,MAAM,OAAO,GAAQ;AACjB,YAAA,MAAM,EAAE,EAAE,MAAM,EAAE,KAAK;SAC1B;QACD,IAAI,UAAU,EAAE;AACZ,YAAA,OAAO,CAAC,MAAM,GAAG,UAAU;QAC/B;AAEA,QAAA,MAAM,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,OAAO,CAAC;QACjF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC;IACvG;AAEA,IAAA,MAAM,gBAAgB,CAAC,MAAc,EAAE,UAAkB,EAAA;AACrD,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0BAA0B,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;AAEpE,QAAA,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE;AAClD,YAAA,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,oEAAoE,CAAC;YAC7F,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC;AACtD,YAAA,MAAM,KAAK;QACf;QAEA,MAAM,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;QAChG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,UAAU,EAAE,CAAC;IAC5G;;AAGA,IAAA,UAAU,CAAC,MAAc,EAAA;;AAErB,QAAA,KAAK,MAAM,CAAC,WAAW,EAAE,SAAS,CAAC,IAAI,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,EAAE;AACxE,YAAA,IAAI,SAAS,CAAC,MAAM,KAAK,MAAM,IAAI,SAAS,CAAC,MAAM,KAAK,SAAS,EAAE;AAC/D,gBAAA,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,WAAW,CAAC;gBAC7C;YACJ;QACJ;IACJ;AAEA,IAAA,sBAAsB,CAAC,MAAc,EAAA;;AAEjC,QAAA,KAAK,MAAM,SAAS,IAAI,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC,MAAM,EAAE,EAAE;AAClE,YAAA,IAAI,SAAS,CAAC,MAAM,KAAK,MAAM,EAAE;gBAC7B,OAAO,SAAS,CAAC,MAAM;YAC3B;QACJ;AACA,QAAA,OAAO,IAAI;IACf;AAEQ,IAAA,MAAM,iBAAiB,CAAC,QAAgB,EAAE,WAAoB,EAAA;QAClE,IAAI,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,EAAE;AACpC,YAAA,MAAM,IAAI,KAAK,CAAC,wFAAwF,CAAC;QAC7G;AAEA,QAAA,MAAM,IAAI,CAAC,UAAU,CAAC,4BAA4B,EAAE;QAEpD,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,QAAQ,CAAC;QACpE,IAAI,CAAC,cAAc,EAAE;YACjB,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,CAAC;AACnE,YAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAC;AAExF,YAAA,MAAM,IAAI,CAAC,UAAU,CAAC,kBAAkB,EAAE;;YAG1C,IAAI,WAAW,EAAE;AACb,gBAAA,MAAM,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAA,gBAAA,EAAmB,QAAQ,CAAA,CAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC;YAC5F;iBAAO;;gBAEH,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE;gBAC3D,IAAI,UAAU,EAAE;oBACZ,MAAM,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAA,gBAAA,EAAmB,QAAQ,CAAA,CAAE,CAAC;gBACtE;YACJ;QACJ;aAAO;AACH,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,mCAAmC,EAAE,EAAE,MAAM,EAAE,cAAc,EAAE,CAAC;YACjF,MAAM,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,cAAc,CAAC;QACxD;IACJ;IAEQ,sBAAsB,CAAC,UAAmB,EAAE,KAAc,EAAA;QAC9D,MAAM,kBAAkB,GAAG,UAAU,IAAI,OAAO,CAAC,GAAG,CAAC,kBAAkB;QACvE,MAAM,aAAa,GAAG,KAAK,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAE/D,IAAI,kBAAkB,EAAE;AACpB,YAAA,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,kBAAkB;QACpD;QAEA,IAAI,aAAa,EAAE;AACf,YAAA,OAAO,CAAC,GAAG,CAAC,cAAc,GAAG,aAAa;QAC9C;IACJ;AAEQ,IAAA,MAAM,iBAAiB,CAAC,IAAU,EAAE,WAAgC,EAAA;AACxE,QAAA,MAAM,SAAS,GAAG,IAAI,CAAC,UAAU;QACjC,MAAM,UAAU,GACZ,SAAS,EAAE,MAAM,IAAI,OAAO,SAAS,CAAC,MAAM,KAAK;AAC7C,cAAG,SAAS,CAAC,MAAc,CAAC;cAC1B,IAAI;QAEd,IAAI,UAAU,EAAE;AACZ,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sCAAsC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC;YAChG;QACJ;AAEA,QAAA,MAAM,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC;AACxC,QAAA,IAAI,CAAC,WAAW,EAAE,aAAa,EAAE;AAC7B,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,2DAA2D,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;YAClG;QACJ;QAEA,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE;AAC3D,QAAA,MAAM,cAAc,GAAG,WAAW,CAAC,UAAU,CAAC;AAC9C,QAAA,MAAM,MAAM,GAAG,cAAc,EAAE,MAAM;QAErC,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,iBAAiB,CACtC,IAAI,CAAC,EAAE,EACP,UAAU,EACV,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,WAAW,IAAI,EAAE,EACtB,MAAM,CACT;AAED,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,YAAY,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;AAEvE,QAAA,IAAI;AACA,YAAA,MAAM,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC;AAC9D,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kCAAkC,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC;QACpF;QAAE,OAAO,KAAK,EAAE;AACZ,YAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,6BAA6B,EAAE;AAC5C,gBAAA,KAAK,EAAE,KAAK,YAAY,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC;AAChE,aAAA,CAAC;QACN;IACJ;AAEQ,IAAA,SAAS,CAAC,KAAU,EAAA;QACxB,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;;YAEtC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,EAAE,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC;QAC3E;QACA,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,KAAK,CAAC;QAC/D,IAAI,cAAc,IAAI,OAAO,cAAc,CAAC,IAAI,KAAK,UAAU,EAAE;YAC7D,cAAc,CAAC,KAAK,CAAC,CAAC,KAAY,KAC9B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CACjF;QACL;AACA,QAAA,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;IACzB;AACH;;;;"}