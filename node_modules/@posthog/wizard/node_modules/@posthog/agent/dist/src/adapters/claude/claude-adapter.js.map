{"version":3,"file":"claude-adapter.js","sources":["../../../../src/adapters/claude/claude-adapter.ts"],"sourcesContent":["import type { AgentEvent } from '../../types.js';\nimport type { SDKMessage } from '@anthropic-ai/claude-agent-sdk';\nimport type { ProviderAdapter } from '../types.js';\nimport { ClaudeToolMapper } from './tool-mapper.js';\n\n/**\n * Claude provider adapter.\n * Transforms Claude SDK messages into our standardized AgentEvent format.\n */\nexport class ClaudeAdapter implements ProviderAdapter {\n  readonly name = 'claude';\n  private toolMapper = new ClaudeToolMapper();\n  createRawSDKEvent(sdkMessage: any): AgentEvent {\n    return {\n      type: 'raw_sdk_event',\n      ts: Date.now(),\n      sdkMessage\n    };\n  }\n\n  transform(sdkMessage: SDKMessage): AgentEvent | null {\n    const baseEvent = { ts: Date.now() };\n\n    // Handle stream events\n    if (sdkMessage.type === 'stream_event') {\n      const event = sdkMessage.event;\n\n      switch (event.type) {\n        case 'message_start':\n          return {\n            ...baseEvent,\n            type: 'message_start',\n            messageId: event.message?.id,\n            model: event.message?.model\n          };\n\n        case 'content_block_start':\n          const contentBlock = event.content_block;\n          if (!contentBlock) return null;\n\n          return {\n            ...baseEvent,\n            type: 'content_block_start',\n            index: event.index,\n            contentType: contentBlock.type as 'text' | 'tool_use' | 'thinking',\n            toolName: contentBlock.type === 'tool_use' ? contentBlock.name : undefined,\n            toolId: contentBlock.type === 'tool_use' ? contentBlock.id : undefined\n          };\n\n        case 'content_block_delta':\n          const delta = event.delta;\n          if (!delta) return null;\n\n          if (delta.type === 'text_delta') {\n            return {\n              ...baseEvent,\n              type: 'token',\n              content: delta.text,\n              contentType: 'text'\n            };\n          } else if (delta.type === 'input_json_delta') {\n            return {\n              ...baseEvent,\n              type: 'token',\n              content: delta.partial_json,\n              contentType: 'tool_input'\n            };\n          } else if (delta.type === 'thinking_delta') {\n            return {\n              ...baseEvent,\n              type: 'token',\n              content: delta.thinking,\n              contentType: 'thinking'\n            };\n          }\n          return null;\n\n        case 'content_block_stop':\n          return {\n            ...baseEvent,\n            type: 'content_block_stop',\n            index: event.index\n          };\n\n        case 'message_delta':\n          return {\n            ...baseEvent,\n            type: 'message_delta',\n            stopReason: event.delta?.stop_reason,\n            stopSequence: event.delta?.stop_sequence,\n            usage: event.usage ? {\n              outputTokens: event.usage.output_tokens\n            } : undefined\n          };\n\n        case 'message_stop':\n          return {\n            ...baseEvent,\n            type: 'message_stop'\n          };\n\n        case 'ping':\n          // Ignore ping events\n          return null;\n\n        case 'error':\n          return {\n            ...baseEvent,\n            type: 'error',\n            message: event.error?.message || 'Unknown error',\n            error: event.error,\n            errorType: event.error?.type || 'stream_error',\n            context: event.error ? {\n              type: event.error.type,\n              code: event.error.code,\n            } : undefined,\n            sdkError: event.error\n          };\n\n        default:\n          return null;\n      }\n    }\n\n    // Handle assistant messages (full message, not streaming)\n    if (sdkMessage.type === 'assistant') {\n      const message = sdkMessage.message;\n\n      // Extract tool calls from content blocks\n      if (message.content && Array.isArray(message.content)) {\n        for (const block of message.content) {\n          if (block.type === 'tool_use') {\n            // Create tool_call event and enrich with metadata\n            const toolCallEvent = {\n              ...baseEvent,\n              type: 'tool_call' as const,\n              toolName: block.name,\n              callId: block.id,\n              args: block.input || {},\n              parentToolUseId: sdkMessage.parent_tool_use_id\n            };\n            // Enrich with tool metadata\n            return this.toolMapper.enrichToolCall(toolCallEvent);\n          }\n        }\n      }\n\n      // If no tool calls, emit status event\n      return {\n        ...baseEvent,\n        type: 'status',\n        phase: 'assistant_message',\n        messageId: message.id,\n        model: message.model\n      };\n    }\n\n    // Handle user messages\n    if (sdkMessage.type === 'user') {\n      const message = sdkMessage.message;\n\n      // Check for tool results in content blocks\n      if (message?.content && Array.isArray(message.content)) {\n        for (const block of message.content) {\n          if (block.type === 'tool_result') {\n            // Create tool_result event and enrich with metadata\n            const toolResultEvent = {\n              ...baseEvent,\n              type: 'tool_result' as const,\n              toolName: block.tool_name || 'unknown',\n              callId: block.tool_use_id || '',\n              result: block.content,\n              isError: block.is_error,\n              parentToolUseId: sdkMessage.parent_tool_use_id\n            };\n            // Enrich with tool metadata\n            return this.toolMapper.enrichToolResult(toolResultEvent);\n          }\n        }\n      }\n\n      // Otherwise extract text content\n      const textContent = this.extractUserContent(message?.content);\n      if (!textContent) {\n        return null;\n      }\n      return {\n        ...baseEvent,\n        type: 'user_message',\n        content: textContent,\n        isSynthetic: sdkMessage.isSynthetic\n      };\n    }\n\n    // Handle result messages\n    if (sdkMessage.type === 'result') {\n      if (sdkMessage.subtype === 'success') {\n        return {\n          ...baseEvent,\n          type: 'done',\n          result: sdkMessage.result,\n          durationMs: sdkMessage.duration_ms,\n          durationApiMs: sdkMessage.duration_api_ms,\n          numTurns: sdkMessage.num_turns,\n          totalCostUsd: sdkMessage.total_cost_usd,\n          usage: sdkMessage.usage,\n          modelUsage: sdkMessage.modelUsage,\n          permissionDenials: sdkMessage.permission_denials\n        };\n      } else {\n        return {\n          ...baseEvent,\n          type: 'error',\n          message: `Execution failed: ${sdkMessage.subtype}`,\n          error: { subtype: sdkMessage.subtype },\n          errorType: sdkMessage.subtype || 'result_error',\n          context: {\n            subtype: sdkMessage.subtype,\n            duration_ms: sdkMessage.duration_ms,\n            num_turns: sdkMessage.num_turns\n          },\n          sdkError: sdkMessage\n        };\n      }\n    }\n\n    // Handle system messages\n    if (sdkMessage.type === 'system') {\n      if (sdkMessage.subtype === 'init') {\n        return {\n          ...baseEvent,\n          type: 'init',\n          model: sdkMessage.model,\n          tools: sdkMessage.tools,\n          permissionMode: sdkMessage.permissionMode,\n          cwd: sdkMessage.cwd,\n          apiKeySource: sdkMessage.apiKeySource,\n          agents: sdkMessage.agents,\n          slashCommands: sdkMessage.slash_commands,\n          outputStyle: sdkMessage.output_style,\n          mcpServers: sdkMessage.mcp_servers\n        };\n      } else if (sdkMessage.subtype === 'compact_boundary') {\n        return {\n          ...baseEvent,\n          type: 'compact_boundary',\n          trigger: sdkMessage.compact_metadata.trigger,\n          preTokens: sdkMessage.compact_metadata.pre_tokens\n        };\n      }\n    }\n\n    return null;\n  }\n  \n  createStatusEvent(phase: string, additionalData?: any): import('../../types.js').StatusEvent {\n    return {\n      type: 'status',\n      ts: Date.now(),\n      phase,\n      ...additionalData\n    };\n  }\n\n  private extractUserContent(content: unknown): string | null {\n    if (!content) {\n      return null;\n    }\n\n    if (typeof content === 'string') {\n      const trimmed = content.trim();\n      return trimmed.length > 0 ? trimmed : null;\n    }\n\n    if (Array.isArray(content)) {\n      const parts: string[] = [];\n      for (const block of content) {\n        const extracted = this.extractUserContent(block);\n        if (extracted) {\n          parts.push(extracted);\n        } else if (block && typeof block === 'object') {\n          const candidate = this.extractFromObject(block as Record<string, unknown>);\n          if (candidate) {\n            parts.push(candidate);\n          }\n        }\n      }\n      const text = parts.join('\\n').trim();\n      return text.length > 0 ? text : null;\n    }\n\n    if (typeof content === 'object') {\n      return this.extractFromObject(content as Record<string, unknown>);\n    }\n\n    return null;\n  }\n\n  private extractFromObject(value: Record<string, unknown>): string | null {\n    const preferredKeys = ['text', 'input_text', 'input', 'markdown', 'content', 'message'];\n    for (const key of preferredKeys) {\n      if (typeof value[key] === 'string') {\n        const trimmed = (value[key] as string).trim();\n        if (trimmed.length > 0) {\n          return trimmed;\n        }\n      }\n    }\n\n    for (const entry of Object.values(value)) {\n      const extracted = this.extractUserContent(entry);\n      if (extracted) {\n        return extracted;\n      }\n    }\n\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}