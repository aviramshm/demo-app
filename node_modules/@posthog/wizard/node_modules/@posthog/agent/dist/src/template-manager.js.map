{"version":3,"file":"template-manager.js","sources":["../../src/template-manager.ts"],"sourcesContent":["import { promises as fs, existsSync } from 'fs';\nimport { join, dirname } from 'path';\nimport { fileURLToPath } from 'url';\n\nexport interface TemplateVariables {\n  task_id: string;\n  task_title: string;\n  task_description?: string;\n  date: string;\n  repository?: string;\n  [key: string]: string | undefined;\n}\n\nexport class TemplateManager {\n  private templatesDir: string;\n\n  constructor() {\n    const __filename = fileURLToPath(import.meta.url);\n    const __dirname = dirname(__filename);\n    const candidateDirs = [\n      join(__dirname, 'templates'),\n      join(__dirname, '..', 'templates'),\n      join(__dirname, '..', '..', 'templates'),\n      join(__dirname, '..', '..', 'src', 'templates')\n    ];\n\n    const resolvedDir = candidateDirs.find((dir) => existsSync(dir));\n    this.templatesDir = resolvedDir ?? candidateDirs[0];\n  }\n\n  private async loadTemplate(templateName: string): Promise<string> {\n    try {\n      const templatePath = join(this.templatesDir, templateName);\n      return await fs.readFile(templatePath, 'utf8');\n    } catch (error) {\n      throw new Error(`Failed to load template ${templateName}: ${error}`);\n    }\n  }\n\n  private substituteVariables(template: string, variables: TemplateVariables): string {\n    let result = template;\n    \n    for (const [key, value] of Object.entries(variables)) {\n      if (value !== undefined) {\n        const placeholder = new RegExp(`{{${key}}}`, 'g');\n        result = result.replace(placeholder, value);\n      }\n    }\n    \n    result = result.replace(/{{[^}]+}}/g, '[PLACEHOLDER]');\n    \n    return result;\n  }\n\n  async generatePlan(variables: TemplateVariables): Promise<string> {\n    const template = await this.loadTemplate('plan-template.md');\n    return this.substituteVariables(template, {\n      ...variables,\n      date: variables.date || new Date().toISOString().split('T')[0]\n    });\n  }\n\n\n  async generateCustomFile(templateName: string, variables: TemplateVariables): Promise<string> {\n    const template = await this.loadTemplate(templateName);\n    return this.substituteVariables(template, {\n      ...variables,\n      date: variables.date || new Date().toISOString().split('T')[0]\n    });\n  }\n\n  async createTaskStructure(taskId: string, taskTitle: string, options?: {\n    includePlan?: boolean;\n    additionalFiles?: Array<{\n      name: string;\n      template?: string;\n      content?: string;\n    }>;\n  }): Promise<Array<{ name: string; content: string; type: 'plan' | 'context' | 'reference' | 'output' }>> {\n    const files: Array<{ name: string; content: string; type: 'plan' | 'context' | 'reference' | 'output' }> = [];\n    \n    const variables: TemplateVariables = {\n      task_id: taskId,\n      task_title: taskTitle,\n      date: new Date().toISOString().split('T')[0]\n    };\n\n    // Generate plan file if requested\n    if (options?.includePlan !== false) {\n      const planContent = await this.generatePlan(variables);\n      files.push({\n        name: 'plan.md',\n        content: planContent,\n        type: 'plan'\n      });\n    }\n\n\n    if (options?.additionalFiles) {\n      for (const file of options.additionalFiles) {\n        let content: string;\n        \n        if (file.template) {\n          content = await this.generateCustomFile(file.template, variables);\n        } else if (file.content) {\n          content = this.substituteVariables(file.content, variables);\n        } else {\n          content = `# ${file.name}\\n\\nPlaceholder content for ${file.name}`;\n        }\n\n        files.push({\n          name: file.name,\n          content,\n          type: file.name.includes('context') ? 'context' : 'reference'\n        });\n      }\n    }\n\n    return files;\n  }\n\n  generatePostHogReadme(): string {\n    return `# PostHog Task Files\n\nThis directory contains task-related files generated by the PostHog Agent.\n\n## Structure\n\nEach task has its own subdirectory: \\`.posthog/{task-id}/\\`\n\n### Common Files\n\n- **plan.md** - Implementation plan generated during planning phase\n- **Supporting files** - Any additional files added for task context\n- **artifacts/** - Generated files, outputs, and temporary artifacts\n\n### Usage\n\nThese files are:\n- Version controlled alongside your code\n- Used by the PostHog Agent for context\n- Available for review in pull requests\n- Organized by task ID for easy reference\n\n### Gitignore\n\nCustomize \\`.posthog/.gitignore\\` to control which files are committed:\n- Include plans and documentation by default\n- Exclude temporary files and sensitive data\n- Customize based on your team's workflow\n\n---\n\n*Generated by PostHog Agent*\n`;\n  }\n}\n"],"names":["fs"],"mappings":"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"}