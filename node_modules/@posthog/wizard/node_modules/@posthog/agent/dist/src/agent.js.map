{"version":3,"file":"agent.js","sources":["../../src/agent.ts"],"sourcesContent":["import { query } from \"@anthropic-ai/claude-agent-sdk\";\nimport type { Task, ExecutionResult, PlanResult, AgentConfig } from './types.js';\nimport type { WorkflowDefinition, WorkflowStage, WorkflowExecutionOptions } from './workflow-types.js';\nimport { TaskManager } from './task-manager.js';\nimport { PostHogAPIClient } from './posthog-api.js';\nimport { PostHogFileManager } from './file-manager.js';\nimport { GitManager } from './git-manager.js';\nimport { TemplateManager } from './template-manager.js';\nimport { ClaudeAdapter } from './adapters/claude/claude-adapter.js';\nimport type { ProviderAdapter } from './adapters/types.js';\nimport { PLANNING_SYSTEM_PROMPT } from './agents/planning.js';\nimport { EXECUTION_SYSTEM_PROMPT } from './agents/execution.js';\nimport { Logger } from './utils/logger.js';\nimport { AgentRegistry } from './agent-registry.js';\nimport { WorkflowRegistry } from './workflow-registry.js';\nimport { StageExecutor } from './stage-executor.js';\nimport { PromptBuilder } from './prompt-builder.js';\nimport { TaskProgressReporter } from './task-progress-reporter.js';\nimport { OpenAIExtractor, type ExtractedQuestion, type ExtractedQuestionWithAnswer } from './structured-extraction.js';\n\nexport class Agent {\n    private workingDirectory: string;\n    private onEvent?: (event: any) => void;\n    private taskManager: TaskManager;\n    private posthogAPI?: PostHogAPIClient;\n    private fileManager: PostHogFileManager;\n    private gitManager: GitManager;\n    private templateManager: TemplateManager;\n    private adapter: ProviderAdapter;\n    private logger: Logger;\n    private agentRegistry: AgentRegistry;\n    private workflowRegistry: WorkflowRegistry;\n    private stageExecutor: StageExecutor;\n    private progressReporter: TaskProgressReporter;\n    private promptBuilder: PromptBuilder;\n    private extractor?: OpenAIExtractor;\n    private mcpServers?: Record<string, any>;\n    public debug: boolean;\n\n    constructor(config: AgentConfig = {}) {\n        this.workingDirectory = config.workingDirectory || process.cwd();\n        this.onEvent = config.onEvent;\n        this.debug = config.debug || false;\n\n        // Build default PostHog MCP server configuration\n        const posthogMcpUrl = config.posthogMcpUrl\n            || process.env.POSTHOG_MCP_URL\n            || 'https://mcp.posthog.com/mcp';\n\n        // Add auth if API key provided\n        const headers: Record<string, string> = {};\n        if (config.posthogApiKey) {\n            headers['Authorization'] = `Bearer ${config.posthogApiKey}`;\n        }\n\n        const defaultMcpServers = {\n            posthog: {\n                type: 'http' as const,\n                url: posthogMcpUrl,\n                ...(Object.keys(headers).length > 0 ? { headers } : {}),\n            }\n        };\n\n        // Merge default PostHog MCP with user-provided servers (user config takes precedence)\n        this.mcpServers = {\n            ...defaultMcpServers,\n            ...config.mcpServers\n        };\n        this.logger = new Logger({ debug: this.debug, prefix: '[PostHog Agent]' });\n        this.taskManager = new TaskManager();\n        // Hardcode Claude adapter for now - extensible for other providers later\n        this.adapter = new ClaudeAdapter();\n\n        this.fileManager = new PostHogFileManager(\n            this.workingDirectory,\n            this.logger.child('FileManager')\n        );\n        this.gitManager = new GitManager({\n            repositoryPath: this.workingDirectory,\n            logger: this.logger.child('GitManager')\n            // TODO: Add author config from environment or config\n        });\n        this.templateManager = new TemplateManager();\n        this.agentRegistry = new AgentRegistry();\n\n        if (config.posthogApiUrl && config.posthogApiKey) {\n            this.posthogAPI = new PostHogAPIClient({\n                apiUrl: config.posthogApiUrl,\n                apiKey: config.posthogApiKey,\n            });\n        }\n\n        this.workflowRegistry = new WorkflowRegistry(this.posthogAPI);\n        this.promptBuilder = new PromptBuilder({\n            getTaskFiles: (taskId: string) => this.getTaskFiles(taskId),\n            generatePlanTemplate: (vars) => this.templateManager.generatePlan(vars),\n            posthogClient: this.posthogAPI,\n            logger: this.logger.child('PromptBuilder')\n        });\n        this.stageExecutor = new StageExecutor(\n            this.agentRegistry,\n            this.logger,\n            this.promptBuilder,\n            undefined, // eventHandler set via setEventHandler below\n            this.mcpServers\n        );\n        this.stageExecutor.setEventHandler((event) => this.emitEvent(event));\n        this.progressReporter = new TaskProgressReporter(this.posthogAPI, this.logger);\n        \n        // Initialize OpenAI extractor if API key is available\n        if (process.env.OPENAI_API_KEY) {\n            this.extractor = new OpenAIExtractor(this.logger.child('OpenAIExtractor'));\n        }\n    }\n\n    /**\n     * Enable or disable debug logging\n     */\n    setDebug(enabled: boolean) {\n        this.debug = enabled;\n        this.logger.setDebug(enabled);\n    }\n\n    /**\n     * Configure LLM gateway environment variables for Claude Code CLI\n     */\n    private async _configureLlmGateway(): Promise<void> {\n        if (!this.posthogAPI) {\n            return;\n        }\n\n        if (process.env.ANTHROPIC_BASE_URL && process.env.ANTHROPIC_AUTH_TOKEN) {\n            return;\n        }\n\n        try {\n            const gatewayUrl = await this.posthogAPI.getLlmGatewayUrl();\n            const apiKey = this.posthogAPI.getApiKey();\n\n            process.env.ANTHROPIC_BASE_URL = gatewayUrl;\n            process.env.ANTHROPIC_AUTH_TOKEN = apiKey;\n\n            this.logger.debug('Configured LLM gateway', { gatewayUrl });\n        } catch (error) {\n            this.logger.error('Failed to configure LLM gateway', error);\n            throw error;\n        }\n    }\n\n    // Workflow-based execution\n    async runWorkflow(taskOrId: Task | string, workflowId: string, options: WorkflowExecutionOptions = {}): Promise<{ task: Task; workflow: WorkflowDefinition }> {\n        await this._configureLlmGateway();\n\n        const task = typeof taskOrId === 'string' ? await this.fetchTask(taskOrId) : taskOrId;\n        await this.workflowRegistry.loadWorkflows();\n        const workflow = this.workflowRegistry.getWorkflow(workflowId);\n        if (!workflow) {\n            throw new Error(`Workflow ${workflowId} not found`);\n        }\n        const orderedStages = [...workflow.stages].sort((a, b) => a.position - b.position);\n\n        // Ensure task is assigned to workflow and positioned at first stage\n        if (this.posthogAPI) {\n            try {\n                if ((task.workflow as any) !== workflowId) {\n                    await this.posthogAPI.updateTask(task.id, { workflow: workflowId } as any);\n                    (task as any).workflow = workflowId;\n                }\n            } catch (e) {\n                this.logger.warn('Failed to sync task workflow before execution', { error: (e as Error).message });\n            }\n        }\n\n        const executionId = this.taskManager.generateExecutionId();\n        this.logger.info('Starting workflow execution', { taskId: task.id, workflowId, executionId });\n        this.taskManager.startExecution(task.id, 'plan_and_build', executionId);\n        await this.progressReporter.start(task.id, {\n            totalSteps: orderedStages.length,\n        });\n\n        // Set initial stage on the newly created run\n        const firstStage = orderedStages[0];\n        if (this.posthogAPI && this.progressReporter.runId && firstStage) {\n            try {\n                await this.posthogAPI.updateTaskRun(task.id, this.progressReporter.runId, {\n                    current_stage: firstStage.id\n                });\n            } catch (e) {\n                this.logger.warn('Failed to set initial stage on run', { error: (e as Error).message });\n            }\n        }\n\n        try {\n            let startIndex = 0;\n            const currentStageId = (task as any).current_stage as string | undefined;\n\n            // If task is already at the last stage, fail gracefully without progressing\n            if (currentStageId) {\n                const currIdx = orderedStages.findIndex(s => s.id === currentStageId);\n                const atLastStage = currIdx >= 0 && currIdx === orderedStages.length - 1;\n                if (atLastStage) {\n                    const finalStageKey = orderedStages[currIdx]?.key;\n                    this.emitEvent(this.adapter.createStatusEvent('no_next_stage', { stage: finalStageKey }));\n                    await this.progressReporter.noNextStage(finalStageKey);\n                    await this.progressReporter.complete();\n                    this.taskManager.completeExecution(executionId, { task, workflow });\n                    return { task, workflow };\n                }\n            }\n\n            if (options.resumeFromCurrentStage && currentStageId) {\n                const idx = orderedStages.findIndex(s => s.id === currentStageId);\n                if (idx >= 0) startIndex = idx;\n            }\n\n            // Align server-side stage when restarting from a different stage\n            if (this.posthogAPI && this.progressReporter.runId) {\n                const targetStage = orderedStages[startIndex];\n                if (targetStage && targetStage.id !== currentStageId) {\n                    try {\n                        await this.posthogAPI.updateTaskRun(task.id, this.progressReporter.runId, {\n                            current_stage: targetStage.id\n                        });\n                    } catch (e) {\n                        this.logger.warn('Failed to update run stage', { error: (e as Error).message });\n                    }\n                }\n            }\n\n            for (let i = startIndex; i < orderedStages.length; i++) {\n                const stage = orderedStages[i];\n                await this.progressReporter.stageStarted(stage.key, i);\n                await this.executeStage(task, stage, options);\n                await this.progressReporter.stageCompleted(stage.key, i + 1);\n                if (options.autoProgress) {\n                    const hasNext = i < orderedStages.length - 1;\n                    if (hasNext) {\n                        await this.progressToNextStage(task.id, stage.key);\n                    }\n                }\n            }\n            await this.progressReporter.complete();\n            this.taskManager.completeExecution(executionId, { task, workflow });\n            return { task, workflow };\n        } catch (error) {\n            await this.progressReporter.fail(error as Error);\n            this.taskManager.failExecution(executionId, error as Error);\n            throw error;\n        }\n    }\n\n    async executeStage(task: Task, stage: WorkflowStage, options: WorkflowExecutionOptions = {}): Promise<void> {\n        this.emitEvent(this.adapter.createStatusEvent('stage_start', { stage: stage.key }));\n        const overrides = options.stageOverrides?.[stage.key];\n        const agentName = stage.agent_name || 'code_generation';\n        const agentDef = this.agentRegistry.getAgent(agentName);\n        const isManual = stage.is_manual_only === true;\n        const stageKeyLower = (stage.key || '').toLowerCase().trim();\n        const isPlanningByKey = stageKeyLower === 'plan' || stageKeyLower.includes('plan');\n        const isPlanning = !isManual && ((agentDef?.agent_type === 'planning') || isPlanningByKey);\n        const shouldCreatePlanningBranch = overrides?.createPlanningBranch !== false; // default true\n        const shouldCreateImplBranch = overrides?.createImplementationBranch !== false; // default true\n\n        if (isPlanning && shouldCreatePlanningBranch) {\n            const planningBranch = await this.createPlanningBranch(task.id);\n            await this.updateTaskBranch(task.id, planningBranch);\n            this.emitEvent(this.adapter.createStatusEvent('branch_created', { stage: stage.key, branch: planningBranch }));\n            await this.progressReporter.branchCreated(stage.key, planningBranch);\n        } else if (!isPlanning && !isManual && shouldCreateImplBranch) {\n            const implBranch = await this.createImplementationBranch(task.id);\n            await this.updateTaskBranch(task.id, implBranch);\n            this.emitEvent(this.adapter.createStatusEvent('branch_created', { stage: stage.key, branch: implBranch }));\n            await this.progressReporter.branchCreated(stage.key, implBranch);\n        }\n\n        const result = await this.stageExecutor.execute(task, stage, options);\n\n        if (result.plan) {\n            await this.writePlan(task.id, result.plan);\n            await this.commitPlan(task.id, task.title);\n            this.emitEvent(this.adapter.createStatusEvent('commit_made', { stage: stage.key, kind: 'plan' }));\n            await this.progressReporter.commitMade(stage.key, 'plan');\n        }\n\n        if (isManual) {\n            const defaultOpenPR = true; // manual stages default to PR for review\n            const openPR = overrides?.openPullRequest ?? defaultOpenPR;\n            if (openPR) {\n                // Ensure we're on an implementation branch for PRs\n                let branchName = await this.gitManager.getCurrentBranch();\n                const onTaskBranch = branchName.includes(`posthog/task-${task.id}`);\n                if (!onTaskBranch && (overrides?.createImplementationBranch !== false)) {\n                    const implBranch = await this.createImplementationBranch(task.id);\n                    await this.updateTaskBranch(task.id, implBranch);\n                    branchName = implBranch;\n                    this.emitEvent(this.adapter.createStatusEvent('branch_created', { stage: stage.key, branch: implBranch }));\n                    await this.progressReporter.branchCreated(stage.key, implBranch);\n                }\n                try {\n                    const prUrl = await this.createPullRequest(task.id, branchName, task.title, task.description);\n                    await this.updateTaskBranch(task.id, branchName);\n                    await this.attachPullRequestToTask(task.id, prUrl, branchName);\n                    this.emitEvent(this.adapter.createStatusEvent('pr_created', { stage: stage.key, prUrl }));\n                    await this.progressReporter.pullRequestCreated(stage.key, prUrl);\n                } catch {}\n            }\n            // Do not auto-progress on manual stages\n            this.emitEvent(this.adapter.createStatusEvent('stage_complete', { stage: stage.key }));\n            return;\n        }\n\n        if (result.results) {\n            const existingPlan = await this.readPlan(task.id);\n            const planSummary = existingPlan ? existingPlan.split('\\n')[0] : undefined;\n            await this.commitImplementation(task.id, task.title, planSummary);\n            this.emitEvent(this.adapter.createStatusEvent('commit_made', { stage: stage.key, kind: 'implementation' }));\n            await this.progressReporter.commitMade(stage.key, 'implementation');\n        }\n\n        // PR creation on complete stage (or if explicitly requested), regardless of whether edits occurred\n        {\n            const defaultOpenPR = stage.key.toLowerCase().includes('complete');\n            const openPR = overrides?.openPullRequest ?? defaultOpenPR;\n            if (openPR) {\n                const branchName = await this.gitManager.getCurrentBranch();\n                try {\n                    const prUrl = await this.createPullRequest(task.id, branchName, task.title, task.description);\n                    await this.updateTaskBranch(task.id, branchName);\n                    await this.attachPullRequestToTask(task.id, prUrl, branchName);\n                    this.emitEvent(this.adapter.createStatusEvent('pr_created', { stage: stage.key, prUrl }));\n                    await this.progressReporter.pullRequestCreated(stage.key, prUrl);\n                } catch {}\n            }\n        }\n\n        this.emitEvent(this.adapter.createStatusEvent('stage_complete', { stage: stage.key }));\n    }\n\n    // Adaptive task execution - 3-phase workflow (research → plan → build)\n    async runTask(taskOrId: Task | string, options: import('./types.js').TaskExecutionOptions = {}): Promise<void> {\n        await this._configureLlmGateway();\n\n        const task = typeof taskOrId === 'string' ? await this.fetchTask(taskOrId) : taskOrId;\n        const cwd = options.repositoryPath || this.workingDirectory;\n        const isCloudMode = options.isCloudMode ?? false;\n        const taskSlug = (task as any).slug || task.id;\n\n        this.logger.info('Starting adaptive task execution', { taskId: task.id, taskSlug, isCloudMode });\n\n        // Initialize progress reporter for task run tracking (needed for PR attachment)\n        await this.progressReporter.start(task.id, { totalSteps: 3 }); // 3 phases: research, plan, build\n        this.emitEvent(this.adapter.createStatusEvent('run_started', { runId: this.progressReporter.runId }));\n\n        // Phase 1: Branch check\n        const existingBranch = await this.gitManager.getTaskBranch(taskSlug);\n        if (!existingBranch) {\n            this.logger.info('Creating task branch', { taskSlug });\n            const branchName = `posthog/task-${taskSlug}`;\n            await this.gitManager.createOrSwitchToBranch(branchName);\n            this.emitEvent(this.adapter.createStatusEvent('branch_created', { branch: branchName }));\n            \n            // Initial commit\n            await this.fileManager.ensureGitignore();\n            await this.gitManager.addAllPostHogFiles();\n            if (isCloudMode) {\n                await this.gitManager.commitAndPush(`Initialize task ${taskSlug}`, { allowEmpty: true });\n            } else {\n                await this.gitManager.commitChanges(`Initialize task ${taskSlug}`);\n            }\n        } else {\n            this.logger.info('Switching to existing task branch', { branch: existingBranch });\n            await this.gitManager.switchToBranch(existingBranch);\n        }\n\n        // Phase 2: Research\n        const researchExists = await this.fileManager.readResearch(task.id);\n        if (!researchExists) {\n            this.logger.info('Starting research phase', { taskId: task.id });\n            this.emitEvent(this.adapter.createStatusEvent('phase_start', { phase: 'research' }));\n            \n            // Run research agent\n            const researchPrompt = await this.promptBuilder.buildResearchPrompt(task, cwd);\n            const { RESEARCH_SYSTEM_PROMPT } = await import('./agents/research.js');\n            const fullPrompt = RESEARCH_SYSTEM_PROMPT + '\\n\\n' + researchPrompt;\n            \n            const baseOptions: Record<string, any> = {\n                model: 'claude-sonnet-4-5-20250929',\n                cwd,\n                permissionMode: 'plan',\n                settingSources: ['local'],\n                mcpServers: this.mcpServers,\n            };\n\n            const response = query({\n                prompt: fullPrompt,\n                options: { ...baseOptions, ...(options.queryOverrides || {}) },\n            });\n\n            let researchContent = '';\n            for await (const message of response) {\n                this.emitEvent(this.adapter.createRawSDKEvent(message));\n                const transformed = this.adapter.transform(message);\n                if (transformed) {\n                    this.emitEvent(transformed);\n                }\n                if (message.type === 'assistant' && message.message?.content) {\n                    for (const c of message.message.content) {\n                        if (c.type === 'text' && c.text) researchContent += c.text + '\\n';\n                    }\n                }\n            }\n\n            // Write research.md\n            if (researchContent.trim()) {\n                await this.fileManager.writeResearch(task.id, researchContent.trim());\n                this.logger.info('Research completed', { taskId: task.id });\n            }\n\n            // Commit research\n            await this.gitManager.addAllPostHogFiles();\n            \n            // Extract questions using structured output and save to questions.json\n            if (this.extractor) {\n                try {\n                    this.logger.info('Extracting questions from research.md', { taskId: task.id });\n                    const questions = await this.extractQuestionsFromResearch(task.id, false);\n                    \n                    this.logger.info('Questions extracted successfully', { taskId: task.id, count: questions.length });\n                    \n                    // Save questions.json\n                    await this.fileManager.writeQuestions(task.id, {\n                        questions,\n                        answered: false,\n                        answers: null,\n                    });\n                    \n                    this.logger.info('Questions saved to questions.json', { taskId: task.id });\n                    \n                    // Emit event for Array to pick up (local mode)\n                    if (!isCloudMode) {\n                        this.emitEvent({\n                            type: 'artifact',\n                            ts: Date.now(),\n                            kind: 'research_questions',\n                            content: questions,\n                        });\n                        this.logger.info('Emitted research_questions artifact event', { taskId: task.id });\n                    }\n                } catch (error) {\n                    this.logger.error('Failed to extract questions', { error: error instanceof Error ? error.message : String(error) });\n                    this.emitEvent({\n                        type: 'error',\n                        ts: Date.now(),\n                        message: `Failed to extract questions: ${error instanceof Error ? error.message : String(error)}`,\n                    });\n                }\n            } else {\n                this.logger.warn('OpenAI extractor not available (OPENAI_API_KEY not set), skipping question extraction');\n                this.emitEvent({\n                    type: 'status',\n                    ts: Date.now(),\n                    phase: 'extraction_skipped',\n                    message: 'Question extraction skipped - OPENAI_API_KEY not configured',\n                });\n            }\n            \n            if (isCloudMode) {\n                await this.gitManager.commitAndPush(`Research phase for ${task.title}`);\n            } else {\n                await this.gitManager.commitChanges(`Research phase for ${task.title}`);\n                this.emitEvent(this.adapter.createStatusEvent('phase_complete', { phase: 'research' }));\n                return; // Local mode: return to user\n            }\n        }\n\n        // Phase 3: Auto-answer questions (cloud mode only)\n        if (isCloudMode) {\n            const questionsData = await this.fileManager.readQuestions(task.id);\n            if (questionsData && !questionsData.answered) {\n                this.logger.info('Auto-answering research questions', { taskId: task.id });\n                \n                // Extract questions with recommended answers using structured output\n                if (this.extractor) {\n                    const questionsWithAnswers = await this.extractQuestionsFromResearch(task.id, true) as ExtractedQuestionWithAnswer[];\n                    \n                    // Save answers to questions.json\n                    await this.fileManager.writeQuestions(task.id, {\n                        questions: questionsWithAnswers.map(qa => ({\n                            id: qa.id,\n                            question: qa.question,\n                            options: qa.options,\n                        })),\n                        answered: true,\n                        answers: questionsWithAnswers.map(qa => ({\n                            questionId: qa.id,\n                            selectedOption: qa.recommendedAnswer,\n                            customInput: qa.justification,\n                        })),\n                    });\n                    \n                    this.logger.info('Auto-answers saved to questions.json', { taskId: task.id });\n                    await this.gitManager.addAllPostHogFiles();\n                    await this.gitManager.commitAndPush(`Answer research questions for ${task.title}`);\n                } else {\n                    this.logger.warn('OpenAI extractor not available, skipping auto-answer');\n                }\n            }\n        }\n\n        // Phase 4: Plan\n        const planExists = await this.readPlan(task.id);\n        if (!planExists) {\n            // Check if questions have been answered\n            const questionsData = await this.fileManager.readQuestions(task.id);\n            if (!questionsData || !questionsData.answered) {\n                this.logger.info('Waiting for user answers to research questions');\n                this.emitEvent(this.adapter.createStatusEvent('phase_complete', { phase: 'research_questions' }));\n                return; // Wait for user to answer questions\n            }\n\n            this.logger.info('Starting planning phase', { taskId: task.id });\n            this.emitEvent(this.adapter.createStatusEvent('phase_start', { phase: 'planning' }));\n            \n            // Build context with research + questions + answers\n            const research = await this.fileManager.readResearch(task.id);\n            let researchContext = '';\n            if (research) {\n                researchContext += `## Research Analysis\\n\\n${research}\\n\\n`;\n            }\n            \n            // Add questions and answers\n            researchContext += `## Implementation Decisions\\n\\n`;\n            const answers = questionsData.answers || [];\n            for (const question of questionsData.questions) {\n                const answer = answers.find((a: any) => a.questionId === question.id);\n                \n                researchContext += `### ${question.question}\\n\\n`;\n                if (answer) {\n                    researchContext += `**Selected:** ${answer.selectedOption}\\n`;\n                    if (answer.customInput) {\n                        researchContext += `**Details:** ${answer.customInput}\\n`;\n                    }\n                } else {\n                    this.logger.warn('No answer found for question', { questionId: question.id });\n                    researchContext += `**Selected:** Not answered\\n`;\n                }\n                researchContext += '\\n';\n            }\n            \n            // Run planning agent with full context\n            const planningPrompt = await this.promptBuilder.buildPlanningPrompt(task, cwd);\n            const { PLANNING_SYSTEM_PROMPT } = await import('./agents/planning.js');\n            const fullPrompt = PLANNING_SYSTEM_PROMPT + '\\n\\n' + planningPrompt + '\\n\\n' + researchContext;\n            \n            const baseOptions: Record<string, any> = {\n                model: 'claude-sonnet-4-5-20250929',\n                cwd,\n                permissionMode: 'plan',\n                settingSources: ['local'],\n                mcpServers: this.mcpServers,\n            };\n\n            const response = query({\n                prompt: fullPrompt,\n                options: { ...baseOptions, ...(options.queryOverrides || {}) },\n            });\n\n            let planContent = '';\n            for await (const message of response) {\n                this.emitEvent(this.adapter.createRawSDKEvent(message));\n                const transformed = this.adapter.transform(message);\n                if (transformed) {\n                    this.emitEvent(transformed);\n                }\n                if (message.type === 'assistant' && message.message?.content) {\n                    for (const c of message.message.content) {\n                        if (c.type === 'text' && c.text) planContent += c.text + '\\n';\n                    }\n                }\n            }\n\n            // Write plan.md\n            if (planContent.trim()) {\n                await this.writePlan(task.id, planContent.trim());\n                this.logger.info('Plan completed', { taskId: task.id });\n            }\n\n            // Commit plan\n            await this.gitManager.addAllPostHogFiles();\n            if (isCloudMode) {\n                await this.gitManager.commitAndPush(`Planning phase for ${task.title}`);\n            } else {\n                await this.gitManager.commitChanges(`Planning phase for ${task.title}`);\n                this.emitEvent(this.adapter.createStatusEvent('phase_complete', { phase: 'planning' }));\n                return; // Local mode: return to user\n            }\n        }\n\n        // Phase 5: Build\n        const latestRun = task.latest_run;\n        const prExists = latestRun?.output && (latestRun.output as any).pr_url;\n        \n        if (!prExists) {\n            this.logger.info('Starting build phase', { taskId: task.id });\n            this.emitEvent(this.adapter.createStatusEvent('phase_start', { phase: 'build' }));\n            \n            // Run execution agent\n            const executionPrompt = await this.promptBuilder.buildExecutionPrompt(task, cwd);\n            const { EXECUTION_SYSTEM_PROMPT } = await import('./agents/execution.js');\n            const fullPrompt = EXECUTION_SYSTEM_PROMPT + '\\n\\n' + executionPrompt;\n            \n            const { PermissionMode } = await import('./types.js');\n            const permissionMode = options.permissionMode || PermissionMode.ACCEPT_EDITS;\n            const baseOptions: Record<string, any> = {\n                model: 'claude-sonnet-4-5-20250929',\n                cwd,\n                permissionMode,\n                settingSources: ['local'],\n                mcpServers: this.mcpServers,\n            };\n\n            const response = query({\n                prompt: fullPrompt,\n                options: { ...baseOptions, ...(options.queryOverrides || {}) },\n            });\n\n            for await (const message of response) {\n                this.emitEvent(this.adapter.createRawSDKEvent(message));\n                const transformed = this.adapter.transform(message);\n                if (transformed) {\n                    this.emitEvent(transformed);\n                }\n            }\n\n            // Commit and push implementation\n            // Stage ALL changes (not just .posthog/)\n            const hasChanges = await this.gitManager.hasChanges();\n            if (hasChanges) {\n                await this.gitManager.addFiles(['.']); // Stage all changes\n                await this.gitManager.commitChanges(`Implementation for ${task.title}`);\n                \n                // Push to origin\n                const branchName = await this.gitManager.getCurrentBranch();\n                await this.gitManager.pushBranch(branchName);\n                \n                this.logger.info('Implementation committed and pushed', { taskId: task.id });\n            } else {\n                this.logger.warn('No changes to commit in build phase', { taskId: task.id });\n            }\n\n            // Create PR\n            const branchName = await this.gitManager.getCurrentBranch();\n            const prUrl = await this.createPullRequest(task.id, branchName, task.title, task.description);\n            this.logger.info('Pull request created', { taskId: task.id, prUrl });\n            this.emitEvent(this.adapter.createStatusEvent('pr_created', { prUrl }));\n            \n            // Attach PR to task run\n            try {\n                await this.attachPullRequestToTask(task.id, prUrl, branchName);\n                this.logger.info('PR attached to task successfully', { taskId: task.id, prUrl });\n            } catch (error) {\n                this.logger.warn('Could not attach PR to task', { error: error instanceof Error ? error.message : String(error) });\n            }\n        } else {\n            this.logger.info('PR already exists, skipping build phase', { taskId: task.id });\n        }\n\n        // Phase 6: Complete\n        await this.progressReporter.complete();\n        this.logger.info('Task execution complete', { taskId: task.id });\n        this.emitEvent(this.adapter.createStatusEvent('task_complete', { taskId: task.id }));\n    }\n\n    async progressToNextStage(taskId: string, currentStageKey?: string): Promise<void> {\n        if (!this.posthogAPI || !this.progressReporter.runId) {\n            throw new Error('PostHog API not configured or no active run. Cannot progress stage.');\n        }\n        try {\n            await this.posthogAPI.progressTaskRun(taskId, this.progressReporter.runId);\n        } catch (error) {\n            if (error instanceof Error && error.message.includes('No next stage available')) {\n                this.logger.warn('No next stage available when attempting to progress run', {\n                    taskId,\n                    runId: this.progressReporter.runId,\n                    stage: currentStageKey,\n                    error: error.message,\n                });\n                this.emitEvent(this.adapter.createStatusEvent('no_next_stage', { stage: currentStageKey }));\n                await this.progressReporter.noNextStage(currentStageKey);\n                return;\n            }\n            throw error;\n        }\n    }\n\n    // Direct prompt execution - still supported for low-level usage\n    async run(prompt: string, options: { repositoryPath?: string; permissionMode?: import('./types.js').PermissionMode; queryOverrides?: Record<string, any> } = {}): Promise<ExecutionResult> {\n        await this._configureLlmGateway();\n        const baseOptions: Record<string, any> = {\n            model: \"claude-sonnet-4-5-20250929\",\n            cwd: options.repositoryPath || this.workingDirectory,\n            permissionMode: (options.permissionMode as any) || \"default\",\n            settingSources: [\"local\"],\n            mcpServers: this.mcpServers,\n        };\n\n        const response = query({\n            prompt,\n            options: { ...baseOptions, ...(options.queryOverrides || {}) },\n        });\n\n        const results = [];\n        for await (const message of response) {\n            this.logger.debug('Received message in direct run', message);\n            // Emit raw SDK event\n            this.emitEvent(this.adapter.createRawSDKEvent(message));\n            // Emit transformed event\n            const transformedEvent = this.adapter.transform(message);\n            if (transformedEvent) {\n                this.emitEvent(transformedEvent);\n            }\n            results.push(message);\n        }\n        \n        return { results };\n    }\n    \n    // PostHog task operations\n    async fetchTask(taskId: string): Promise<Task> {\n        this.logger.debug('Fetching task from PostHog', { taskId });\n        if (!this.posthogAPI) {\n            const error = new Error('PostHog API not configured. Provide posthogApiUrl and posthogApiKey in constructor.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n        return this.posthogAPI.fetchTask(taskId);\n    }\n\n    getPostHogClient(): PostHogAPIClient | undefined {\n        return this.posthogAPI;\n    }\n    \n    async listTasks(filters?: {\n        repository?: string;\n        organization?: string;\n        origin_product?: string;\n        workflow?: string;\n        current_stage?: string;\n    }): Promise<Task[]> {\n        if (!this.posthogAPI) {\n            throw new Error('PostHog API not configured. Provide posthogApiUrl and posthogApiKey in constructor.');\n        }\n        return this.posthogAPI.listTasks(filters);\n    }\n    \n    // File system operations for task artifacts\n    async writeTaskFile(taskId: string, fileName: string, content: string, type: 'plan' | 'context' | 'reference' | 'output' = 'reference'): Promise<void> {\n        this.logger.debug('Writing task file', { taskId, fileName, type, contentLength: content.length });\n        await this.fileManager.writeTaskFile(taskId, { name: fileName, content, type });\n    }\n    \n    async readTaskFile(taskId: string, fileName: string): Promise<string | null> {\n        this.logger.debug('Reading task file', { taskId, fileName });\n        return await this.fileManager.readTaskFile(taskId, fileName);\n    }\n    \n    async getTaskFiles(taskId: string): Promise<any[]> {\n        this.logger.debug('Getting task files', { taskId });\n        const files = await this.fileManager.getTaskFiles(taskId);\n        this.logger.debug('Found task files', { taskId, fileCount: files.length });\n        return files;\n    }\n    \n    async writePlan(taskId: string, plan: string): Promise<void> {\n        this.logger.info('Writing plan', { taskId, planLength: plan.length });\n        await this.fileManager.writePlan(taskId, plan);\n    }\n    \n    async readPlan(taskId: string): Promise<string | null> {\n        this.logger.debug('Reading plan', { taskId });\n        return await this.fileManager.readPlan(taskId);\n    }\n\n    async extractQuestionsFromResearch(taskId: string, includeAnswers: boolean = false): Promise<ExtractedQuestion[] | ExtractedQuestionWithAnswer[]> {\n        this.logger.info('Extracting questions from research.md', { taskId, includeAnswers });\n        \n        if (!this.extractor) {\n            throw new Error('OpenAI extractor not initialized. Set OPENAI_API_KEY environment variable.');\n        }\n\n        const researchContent = await this.fileManager.readResearch(taskId);\n        if (!researchContent) {\n            throw new Error('research.md not found for task ' + taskId);\n        }\n\n        if (includeAnswers) {\n            return await this.extractor.extractQuestionsWithAnswers(researchContent);\n        } else {\n            return await this.extractor.extractQuestions(researchContent);\n        }\n    }\n    \n    // Git operations for task workflow\n    async createPlanningBranch(taskId: string): Promise<string> {\n        this.logger.info('Creating planning branch', { taskId });\n        const branchName = await this.gitManager.createTaskPlanningBranch(taskId);\n        this.logger.debug('Planning branch created', { taskId, branchName });\n        // Only create gitignore after we're on the new branch\n        await this.fileManager.ensureGitignore();\n        return branchName;\n    }\n    \n    async commitPlan(taskId: string, taskTitle: string): Promise<string> {\n        this.logger.info('Committing plan', { taskId, taskTitle });\n        const commitHash = await this.gitManager.commitPlan(taskId, taskTitle);\n        this.logger.debug('Plan committed', { taskId, commitHash });\n        return commitHash;\n    }\n    \n    async createImplementationBranch(taskId: string, planningBranchName?: string): Promise<string> {\n        this.logger.info('Creating implementation branch', { taskId, fromBranch: planningBranchName });\n        const branchName = await this.gitManager.createTaskImplementationBranch(taskId, planningBranchName);\n        this.logger.debug('Implementation branch created', { taskId, branchName });\n        return branchName;\n    }\n    \n    async commitImplementation(taskId: string, taskTitle: string, planSummary?: string): Promise<string> {\n        this.logger.info('Committing implementation', { taskId, taskTitle });\n        const commitHash = await this.gitManager.commitImplementation(taskId, taskTitle, planSummary);\n        this.logger.debug('Implementation committed', { taskId, commitHash });\n        return commitHash;\n    }\n\n    async createPullRequest(taskId: string, branchName: string, taskTitle: string, taskDescription: string): Promise<string> {\n        this.logger.info('Creating pull request', { taskId, branchName, taskTitle });\n\n        // Build PR body\n        const prBody = `## Task Details\n**Task ID**: ${taskId}\n**Description**: ${taskDescription}\n\n## Changes\nThis PR implements the changes described in the task.\n\nGenerated by PostHog Agent`;\n\n        const prUrl = await this.gitManager.createPullRequest(\n            branchName,\n            taskTitle,\n            prBody\n        );\n\n        this.logger.info('Pull request created', { taskId, prUrl });\n        return prUrl;\n    }\n\n    async attachPullRequestToTask(taskId: string, prUrl: string, branchName?: string): Promise<void> {\n        this.logger.info('Attaching PR to task run', { taskId, prUrl, branchName });\n\n        if (!this.posthogAPI || !this.progressReporter.runId) {\n            const error = new Error('PostHog API not configured or no active run. Cannot attach PR to task.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n\n        const updates: any = {\n            output: { pr_url: prUrl }\n        };\n        if (branchName) {\n            updates.branch = branchName;\n        }\n\n        await this.posthogAPI.updateTaskRun(taskId, this.progressReporter.runId, updates);\n        this.logger.debug('PR attached to task run', { taskId, runId: this.progressReporter.runId, prUrl });\n    }\n\n    async updateTaskBranch(taskId: string, branchName: string): Promise<void> {\n        this.logger.info('Updating task run branch', { taskId, branchName });\n\n        if (!this.posthogAPI || !this.progressReporter.runId) {\n            const error = new Error('PostHog API not configured or no active run. Cannot update branch.');\n            this.logger.error('PostHog API not configured', error);\n            throw error;\n        }\n\n        await this.posthogAPI.updateTaskRun(taskId, this.progressReporter.runId, { branch: branchName });\n        this.logger.debug('Task run branch updated', { taskId, runId: this.progressReporter.runId, branchName });\n    }\n\n    // Execution management\n    cancelTask(taskId: string): void {\n        // Find the execution for this task and cancel it\n        for (const [executionId, execution] of this.taskManager['executionStates']) {\n            if (execution.taskId === taskId && execution.status === 'running') {\n                this.taskManager.cancelExecution(executionId);\n                break;\n            }\n        }\n    }\n\n    getTaskExecutionStatus(taskId: string): string | null {\n        // Find the execution for this task\n        for (const execution of this.taskManager['executionStates'].values()) {\n            if (execution.taskId === taskId) {\n                return execution.status;\n            }\n        }\n        return null;\n    }\n\n    private emitEvent(event: any): void {\n        if (this.debug && event.type !== 'token') {\n            // Log all events except tokens (too verbose)\n            this.logger.debug('Emitting event', { type: event.type, ts: event.ts });\n        }\n        const persistPromise = this.progressReporter.recordEvent(event);\n        if (persistPromise && typeof persistPromise.then === 'function') {\n            persistPromise.catch((error: Error) =>\n                this.logger.debug('Failed to persist agent event', { message: error.message })\n            );\n        }\n        this.onEvent?.(event);\n    }\n}\n\nexport { PermissionMode } from './types.js';\nexport type { Task, SupportingFile, ExecutionResult, AgentConfig } from './types.js';\nexport type { WorkflowDefinition, WorkflowStage, WorkflowExecutionOptions } from './workflow-types.js';\n"],"names":[],"mappings":"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"}