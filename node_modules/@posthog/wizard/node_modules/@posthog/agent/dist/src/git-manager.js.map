{"version":3,"file":"git-manager.js","sources":["../../src/git-manager.ts"],"sourcesContent":["import { exec } from 'child_process';\nimport { promisify } from 'util';\nimport { Logger } from './utils/logger.js';\n\nconst execAsync = promisify(exec);\n\nexport interface GitConfig {\n  repositoryPath: string;\n  authorName?: string;\n  authorEmail?: string;\n  logger?: Logger;\n}\n\nexport interface BranchInfo {\n  name: string;\n  exists: boolean;\n  isCurrentBranch: boolean;\n}\n\nexport class GitManager {\n  private repositoryPath: string;\n  private authorName?: string;\n  private authorEmail?: string;\n  private logger: Logger;\n\n  constructor(config: GitConfig) {\n    this.repositoryPath = config.repositoryPath;\n    this.authorName = config.authorName;\n    this.authorEmail = config.authorEmail;\n    this.logger = config.logger || new Logger({ debug: false, prefix: '[GitManager]' });\n  }\n\n  private async runGitCommand(command: string): Promise<string> {\n    try {\n      const { stdout } = await execAsync(`cd \"${this.repositoryPath}\" && git ${command}`);\n      return stdout.trim();\n    } catch (error) {\n      throw new Error(`Git command failed: ${command}\\n${error}`);\n    }\n  }\n\n  private async runCommand(command: string): Promise<string> {\n    try {\n      const { stdout } = await execAsync(`cd \"${this.repositoryPath}\" && ${command}`);\n      return stdout.trim();\n    } catch (error) {\n      throw new Error(`Command failed: ${command}\\n${error}`);\n    }\n  }\n\n  async isGitRepository(): Promise<boolean> {\n    try {\n      await this.runGitCommand('rev-parse --git-dir');\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async getCurrentBranch(): Promise<string> {\n    return await this.runGitCommand('branch --show-current');\n  }\n\n  async getDefaultBranch(): Promise<string> {\n    try {\n      // Try to get the default branch from remote\n      const remoteBranch = await this.runGitCommand('symbolic-ref refs/remotes/origin/HEAD');\n      return remoteBranch.replace('refs/remotes/origin/', '');\n    } catch {\n      // Fallback: check if main exists, otherwise use master\n      if (await this.branchExists('main')) {\n        return 'main';\n      } else if (await this.branchExists('master')) {\n        return 'master';\n      } else {\n        throw new Error('Cannot determine default branch. No main or master branch found.');\n      }\n    }\n  }\n\n  async branchExists(branchName: string): Promise<boolean> {\n    try {\n      await this.runGitCommand(`rev-parse --verify ${branchName}`);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async createBranch(branchName: string, baseBranch?: string): Promise<void> {\n    const base = baseBranch || await this.getCurrentBranch();\n    await this.runGitCommand(`checkout -b ${branchName} ${base}`);\n  }\n\n  async switchToBranch(branchName: string): Promise<void> {\n    await this.runGitCommand(`checkout ${branchName}`);\n  }\n\n  async createOrSwitchToBranch(branchName: string, baseBranch?: string): Promise<void> {\n    const exists = await this.branchExists(branchName);\n    if (exists) {\n      await this.switchToBranch(branchName);\n    } else {\n      await this.createBranch(branchName, baseBranch);\n    }\n  }\n\n  async addFiles(paths: string[]): Promise<void> {\n    const pathList = paths.map(p => `\"${p}\"`).join(' ');\n    await this.runGitCommand(`add ${pathList}`);\n  }\n\n  async addAllPostHogFiles(): Promise<void> {\n    await this.runGitCommand('add .posthog/');\n  }\n\n  async commitChanges(message: string, options?: {\n    authorName?: string;\n    authorEmail?: string;\n  }): Promise<string> {\n    let command = 'commit -m \"' + message.replace(/\"/g, '\\\\\"') + '\"';\n\n    const authorName = options?.authorName || this.authorName;\n    const authorEmail = options?.authorEmail || this.authorEmail;\n\n    if (authorName && authorEmail) {\n      command += ` --author=\"${authorName} <${authorEmail}>\"`;\n    }\n\n    return await this.runGitCommand(command);\n  }\n\n  async hasChanges(): Promise<boolean> {\n    try {\n      const status = await this.runGitCommand('status --porcelain');\n      return status.length > 0;\n    } catch {\n      return false;\n    }\n  }\n\n  async hasStagedChanges(): Promise<boolean> {\n    try {\n      const status = await this.runGitCommand('diff --cached --name-only');\n      return status.length > 0;\n    } catch {\n      return false;\n    }\n  }\n\n  async getRemoteUrl(): Promise<string | null> {\n    try {\n      return await this.runGitCommand('remote get-url origin');\n    } catch {\n      return null;\n    }\n  }\n\n  async pushBranch(branchName: string, force: boolean = false): Promise<void> {\n    const forceFlag = force ? '--force' : '';\n    await this.runGitCommand(`push ${forceFlag} -u origin ${branchName}`);\n  }\n\n  // Utility methods for PostHog task workflow\n  async createTaskPlanningBranch(taskId: string, baseBranch?: string): Promise<string> {\n    let branchName = `posthog/task-${taskId}-planning`;\n    let counter = 1;\n\n    // Find a unique branch name if the base name already exists\n    while (await this.branchExists(branchName)) {\n      branchName = `posthog/task-${taskId}-planning-${counter}`;\n      counter++;\n    }\n\n    this.logger.debug('Creating unique planning branch', { branchName, taskId });\n\n    // If no base branch specified, ensure we're on main/master\n    if (!baseBranch) {\n      baseBranch = await this.getDefaultBranch();\n      await this.switchToBranch(baseBranch);\n\n      // Check for uncommitted changes\n      if (await this.hasChanges()) {\n        throw new Error(`Uncommitted changes detected. Please commit or stash changes before running tasks.`);\n      }\n    }\n\n    await this.createBranch(branchName, baseBranch); // Use createBranch instead of createOrSwitchToBranch for new branches\n    return branchName;\n  }\n\n  async createTaskImplementationBranch(taskId: string, planningBranchName?: string): Promise<string> {\n    let branchName = `posthog/task-${taskId}-implementation`;\n    let counter = 1;\n\n    // Find a unique branch name if the base name already exists\n    while (await this.branchExists(branchName)) {\n      branchName = `posthog/task-${taskId}-implementation-${counter}`;\n      counter++;\n    }\n\n    const currentBranchBefore = await this.getCurrentBranch();\n    this.logger.debug('Creating unique implementation branch', {\n      branchName,\n      taskId,\n      currentBranch: currentBranchBefore\n    });\n\n    // Implementation branch should branch from the specific planning branch\n    let baseBranch = planningBranchName;\n\n    if (!baseBranch) {\n      // Try to find the corresponding planning branch\n      const currentBranch = await this.getCurrentBranch();\n      if (currentBranch.includes('-planning')) {\n        baseBranch = currentBranch; // Use current planning branch\n        this.logger.debug('Using current planning branch', { baseBranch });\n      } else {\n        // Fallback to default branch\n        baseBranch = await this.getDefaultBranch();\n        this.logger.debug('No planning branch found, using default', { baseBranch });\n        await this.switchToBranch(baseBranch);\n      }\n    }\n\n    this.logger.debug('Creating implementation branch from base', { baseBranch, branchName });\n    await this.createBranch(branchName, baseBranch); // Create fresh branch from base\n\n    const currentBranchAfter = await this.getCurrentBranch();\n    this.logger.info('Implementation branch created', {\n      branchName,\n      currentBranch: currentBranchAfter\n    });\n\n    return branchName;\n  }\n\n  async commitPlan(taskId: string, taskTitle: string): Promise<string> {\n    const currentBranch = await this.getCurrentBranch();\n    this.logger.debug('Committing plan', { taskId, currentBranch });\n\n    await this.addAllPostHogFiles();\n\n    const hasChanges = await this.hasStagedChanges();\n    this.logger.debug('Checking for staged changes', { hasChanges });\n\n    if (!hasChanges) {\n      this.logger.info('No plan changes to commit', { taskId });\n      return 'No changes to commit';\n    }\n\n    const message = `ðŸ“‹ Add plan for task: ${taskTitle}\n\nTask ID: ${taskId}\nGenerated by PostHog Agent\n\nThis commit contains the implementation plan and supporting documentation\nfor the task. Review the plan before proceeding with implementation.`;\n\n    const result = await this.commitChanges(message);\n    this.logger.info('Plan committed', { taskId, taskTitle });\n    return result;\n  }\n\n  async commitImplementation(taskId: string, taskTitle: string, planSummary?: string): Promise<string> {\n    await this.runGitCommand('add .');\n\n    const hasChanges = await this.hasStagedChanges();\n    if (!hasChanges) {\n      this.logger.warn('No implementation changes to commit', { taskId });\n      return 'No changes to commit';\n    }\n\n    let message = `âœ¨ Implement task: ${taskTitle}\n\nTask ID: ${taskId}\nGenerated by PostHog Agent`;\n\n    if (planSummary) {\n      message += `\\n\\nPlan Summary:\\n${planSummary}`;\n    }\n\n    message += `\\n\\nThis commit implements the changes described in the task plan.`;\n\n    const result = await this.commitChanges(message);\n    this.logger.info('Implementation committed', { taskId, taskTitle });\n    return result;\n  }\n\n  async deleteBranch(branchName: string, force: boolean = false): Promise<void> {\n    const forceFlag = force ? '-D' : '-d';\n    await this.runGitCommand(`branch ${forceFlag} ${branchName}`);\n  }\n\n  async deleteRemoteBranch(branchName: string): Promise<void> {\n    await this.runGitCommand(`push origin --delete ${branchName}`);\n  }\n\n  async getBranchInfo(branchName: string): Promise<BranchInfo> {\n    const exists = await this.branchExists(branchName);\n    const currentBranch = await this.getCurrentBranch();\n\n    return {\n      name: branchName,\n      exists,\n      isCurrentBranch: branchName === currentBranch\n    };\n  }\n\n  async getCommitSha(ref: string = 'HEAD'): Promise<string> {\n    return await this.runGitCommand(`rev-parse ${ref}`);\n  }\n\n  async getCommitMessage(ref: string = 'HEAD'): Promise<string> {\n    return await this.runGitCommand(`log -1 --pretty=%B ${ref}`);\n  }\n\n  async createPullRequest(\n    branchName: string,\n    title: string,\n    body: string,\n    baseBranch?: string\n  ): Promise<string> {\n    const currentBranch = await this.getCurrentBranch();\n    if (currentBranch !== branchName) {\n      await this.switchToBranch(branchName);\n    }\n\n    await this.pushBranch(branchName);\n\n    let command = `gh pr create --title \"${title.replace(/\"/g, '\\\\\"')}\" --body \"${body.replace(/\"/g, '\\\\\"')}\"`;\n\n    if (baseBranch) {\n      command += ` --base ${baseBranch}`;\n    }\n\n    try {\n      const prUrl = await this.runCommand(command);\n      return prUrl.trim();\n    } catch (error) {\n      throw new Error(`Failed to create PR: ${error}`);\n    }\n  }\n\n  async getTaskBranch(taskSlug: string): Promise<string | null> {\n    try {\n      // Get all branches matching the task slug pattern\n      const branches = await this.runGitCommand('branch --list --all');\n      const branchPattern = `posthog/task-${taskSlug}`;\n      \n      // Look for exact match or with counter suffix\n      const lines = branches.split('\\n').map(l => l.trim().replace(/^\\*\\s+/, ''));\n      for (const line of lines) {\n        const cleanBranch = line.replace('remotes/origin/', '');\n        if (cleanBranch.startsWith(branchPattern)) {\n          return cleanBranch;\n        }\n      }\n      \n      return null;\n    } catch (error) {\n      this.logger.debug('Failed to get task branch', { taskSlug, error });\n      return null;\n    }\n  }\n\n  async commitAndPush(message: string, options?: { allowEmpty?: boolean }): Promise<void> {\n    const hasChanges = await this.hasStagedChanges();\n    \n    if (!hasChanges && !options?.allowEmpty) {\n      this.logger.debug('No changes to commit, skipping');\n      return;\n    }\n\n    let command = `commit -m \"${message.replace(/\"/g, '\\\\\"')}\"`;\n    \n    if (options?.allowEmpty) {\n      command += ' --allow-empty';\n    }\n\n    const authorName = this.authorName;\n    const authorEmail = this.authorEmail;\n\n    if (authorName && authorEmail) {\n      command += ` --author=\"${authorName} <${authorEmail}>\"`;\n    }\n\n    await this.runGitCommand(command);\n    \n    // Push to origin\n    const currentBranch = await this.getCurrentBranch();\n    await this.pushBranch(currentBranch);\n    \n    this.logger.info('Committed and pushed changes', { branch: currentBranch, message });\n  }\n}\n"],"names":[],"mappings":"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"}