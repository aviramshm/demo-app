{"version":3,"file":"astro-wizard.js","sourceRoot":"","sources":["../../../src/astro/astro-wizard.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\n\nimport {\n  abort,\n  askForAIConsent,\n  confirmContinueIfNoOrDirtyGitRepo,\n  ensurePackageIsInstalled,\n  getOrAskForProjectData,\n  getPackageDotJson,\n  printWelcome,\n} from '../utils/clack-utils';\nimport { getPackageVersion } from '../utils/package-json';\nimport clack from '../utils/clack';\nimport { Integration } from '../lib/constants';\nimport { getAstroDocumentation } from './docs';\nimport { analytics } from '../utils/analytics';\nimport {\n  generateFileChangesForIntegration,\n  getFilesToChange,\n  getRelevantFilesForIntegration,\n} from '../utils/file-utils';\nimport type { WizardOptions } from '../utils/types';\nimport { askForCloudRegion } from '../utils/clack-utils';\nimport { getOutroMessage } from '../lib/messages';\nimport {\n  addEditorRulesStep,\n  addMCPServerToClientsStep,\n  runPrettierStep,\n} from '../steps';\n\nexport async function runAstroWizard(options: WizardOptions): Promise<void> {\n  printWelcome({\n    wizardName: 'PostHog Astro wizard',\n  });\n\n  const aiConsent = await askForAIConsent(options);\n\n  if (!aiConsent) {\n    await abort(\n      'The Astro wizard requires AI to get setup right now. Please view the docs to setup Astro manually instead: https://posthog.com/docs/libraries/js',\n      0,\n    );\n  }\n\n  const cloudRegion = options.cloudRegion ?? (await askForCloudRegion());\n\n  await confirmContinueIfNoOrDirtyGitRepo(options);\n\n  const packageJson = await getPackageDotJson(options);\n\n  await ensurePackageIsInstalled(packageJson, 'astro', 'Astro');\n\n  const astroVersion = getPackageVersion('astro', packageJson);\n\n  if (astroVersion) {\n    analytics.setTag('astro-version', astroVersion);\n  }\n\n  const { projectApiKey, accessToken, host, projectId } =\n    await getOrAskForProjectData({\n      ...options,\n      cloudRegion,\n    });\n\n  clack.log.info('Heading to include the PostHogSnippet in your Astro project');\n\n  const relevantFiles = await getRelevantFilesForIntegration({\n    installDir: options.installDir,\n    integration: Integration.astro,\n  });\n\n  const installationDocumentation = getAstroDocumentation({\n    projectApiKey,\n    host,\n  });\n\n  clack.log.info('Reviewing PostHog documentation for Astro');\n\n  const filesToChange = await getFilesToChange({\n    integration: Integration.astro,\n    relevantFiles,\n    documentation: installationDocumentation,\n    accessToken,\n    cloudRegion,\n    projectId,\n  });\n\n  await generateFileChangesForIntegration({\n    integration: Integration.astro,\n    filesToChange,\n    accessToken,\n    installDir: options.installDir,\n    documentation: installationDocumentation,\n    cloudRegion,\n    projectId,\n  });\n\n  await runPrettierStep({\n    installDir: options.installDir,\n    integration: Integration.astro,\n  });\n\n  const addedEditorRules = await addEditorRulesStep({\n    installDir: options.installDir,\n    rulesName: 'astro-rules.md',\n    integration: Integration.astro,\n  });\n\n  await addMCPServerToClientsStep({\n    cloudRegion,\n    integration: Integration.astro,\n  });\n\n  const outroMessage = getOutroMessage({\n    options,\n    integration: Integration.astro,\n    cloudRegion,\n    addedEditorRules,\n    uploadedEnvVars: [],\n  });\n\n  clack.outro(outroMessage);\n\n  await analytics.shutdown('success');\n}\n"]}