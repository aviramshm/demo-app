{"version":3,"file":"clack-utils.test.js","sourceRoot":"","sources":["../../../../src/utils/__tests__/clack-utils.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { installPackage } from '../clack-utils';\n\nimport * as ChildProcess from 'node:child_process';\nimport type { PackageManager } from '../package-manager';\n\njest.mock('node:child_process', () => ({\n  __esModule: true,\n  ...jest.requireActual('node:child_process'),\n}));\n\njest.mock('@clack/prompts', () => ({\n  log: {\n    info: jest.fn(),\n    success: jest.fn(),\n    warn: jest.fn(),\n    error: jest.fn(),\n  },\n  text: jest.fn(),\n  confirm: jest.fn(),\n  cancel: jest.fn(),\n  outro: jest.fn(),\n  // passthrough for abortIfCancelled\n  isCancel: jest.fn().mockReturnValue(false),\n  spinner: jest\n    .fn()\n    .mockImplementation(() => ({ start: jest.fn(), stop: jest.fn() })),\n}));\n\ndescribe.skip('installPackage', () => {\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('force-installs a package if the forceInstall flag is set', async () => {\n    const packageManagerMock: PackageManager = {\n      name: 'npm',\n      label: 'NPM',\n      installCommand: 'npm install',\n      buildCommand: 'npm run build',\n      runScriptCommand: 'npm run',\n      flags: '',\n      forceInstallFlag: '--force',\n      detect: jest.fn(),\n      addOverride: jest.fn(),\n    };\n\n    const execSpy = jest\n      .spyOn(ChildProcess, 'exec')\n      // @ts-expect-error - don't care about the return value\n      .mockImplementationOnce((cmd, cb) => {\n        if (cb) {\n          // @ts-expect-error - don't care about the options value\n          cb(null, '', '');\n        }\n      });\n\n    await installPackage({\n      alreadyInstalled: false,\n      packageName: 'posthog-js',\n      packageNameDisplayLabel: 'posthog-js',\n      forceInstall: true,\n      askBeforeUpdating: false,\n      packageManager: packageManagerMock,\n      installDir: process.cwd(),\n    });\n\n    expect(execSpy).toHaveBeenCalledWith(\n      'npm install posthog-js  --force',\n      expect.any(Function),\n    );\n  });\n\n  it.each([false, undefined])(\n    \"doesn't force-install a package if the forceInstall flag is %s\",\n    async (flag) => {\n      const packageManagerMock: PackageManager = {\n        name: 'npm',\n        label: 'NPM',\n        installCommand: 'npm install',\n        buildCommand: 'npm run build',\n        runScriptCommand: 'npm run',\n        flags: '',\n        forceInstallFlag: '--force',\n        detect: jest.fn(),\n        addOverride: jest.fn(),\n      };\n\n      const execSpy = jest\n        .spyOn(ChildProcess, 'exec')\n        // @ts-expect-error - don't care about the return value\n        .mockImplementationOnce((cmd, cb) => {\n          if (cb) {\n            // @ts-expect-error - don't care about the options value\n            cb(null, '', '');\n          }\n        });\n\n      await installPackage({\n        alreadyInstalled: false,\n        packageName: 'posthog-js',\n        packageNameDisplayLabel: 'posthog-js',\n        forceInstall: flag,\n        askBeforeUpdating: false,\n        packageManager: packageManagerMock,\n        installDir: process.cwd(),\n      });\n\n      expect(execSpy).toHaveBeenCalledWith(\n        'npm install posthog-js  ',\n        expect.any(Function),\n      );\n    },\n  );\n});\n"]}