{"version":3,"file":"clack-utils.js","sourceRoot":"","sources":["../../../src/utils/clack-utils.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA,sBAKC;AAED,4CAyBC;AAED,oCAaC;AAED,8EA6CC;AAED,kCASC;AAED,wEAmBC;AAED,kDAmBC;AAED,kGAkDC;AAED,gDAmBC;AAQD,wCAgHC;AAYD,4DAuBC;AAED,8CA4BC;AAED,oDAmBC;AAED,8CAoCC;AAED,8CAQC;AASD,wDAwCC;AAiED,oDAkCC;AAwBD,8DAwBC;AAgCD,0CASC;AAmBD,kDA+BC;AAED,wDA+BC;AAED,0DAUC;AAED,kEAaC;AAED,0CAyBC;AAED,8CAsBC;AAp6BD,iEAAmD;AACnD,4CAA8B;AAC9B,4CAA8B;AAC9B,yCAAiE;AAEjE,kDAA0B;AAC1B,4CAAyC;AACzC,mCAAgC;AAChC,iDAA0E;AAC1E,uDAI2B;AAC3B,qCAAgD;AAEhD,iDAAmD;AACnD,gDAK0B;AAC1B,2CAAwC;AACxC,oDAA4B;AAC5B,iCAAkE;AAClE,0CAAmD;AACnD,mCAA2C;AAC3C,oCAA6D;AAgCtD,KAAK,UAAU,KAAK,CAAC,OAAgB,EAAE,MAAe;IAC3D,MAAM,qBAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;IAEtC,eAAK,CAAC,KAAK,CAAC,OAAO,IAAI,yBAAyB,CAAC,CAAC;IAClD,OAAO,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC;AACnC,CAAC;AAEM,KAAK,UAAU,gBAAgB,CACpC,KAAqB,EACrB,WAAyB;IAEzB,MAAM,qBAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;IACtC,MAAM,aAAa,GAAG,MAAM,KAAK,CAAC;IAElC,IACE,eAAK,CAAC,QAAQ,CAAC,aAAa,CAAC;QAC7B,CAAC,OAAO,aAAa,KAAK,QAAQ;YAChC,aAAa,CAAC,WAAW,KAAK,cAAc,CAAC,EAC/C,CAAC;QACD,MAAM,OAAO,GAAG,WAAW;YACzB,CAAC,CAAC,2BAAkB,CAAC,WAAW,CAAC,CAAC,OAAO;YACzC,CAAC,CAAC,0BAA0B,CAAC;QAE/B,eAAK,CAAC,MAAM,CACV,8DACE,WAAW,IAAI,SACjB,OAAO,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,uCAAuC,CAClE,CAAC;QACF,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC;SAAM,CAAC;QACN,OAAO,KAA2B,CAAC;IACrC,CAAC;AACH,CAAC;AAED,SAAgB,YAAY,CAAC,OAG5B;IACC,sCAAsC;IACtC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IAChB,eAAK,CAAC,KAAK,CAAC,eAAK,CAAC,OAAO,CAAC,IAAI,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC;IAEtD,MAAM,WAAW,GACf,OAAO,CAAC,OAAO;QACf,OAAO,OAAO,CAAC,UAAU,qFAAqF,CAAC;IAEjH,eAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC1B,CAAC;AAEM,KAAK,UAAU,iCAAiC,CACrD,OAAuC;IAEvC,OAAO,IAAA,qBAAS,EAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;QAC9C,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC;YACnB,MAAM,kBAAkB,GAAG,OAAO,CAAC,OAAO;gBACxC,CAAC,CAAC,IAAI;gBACN,CAAC,CAAC,MAAM,gBAAgB,CACpB,eAAK,CAAC,OAAO,CAAC;oBACZ,OAAO,EACL,+GAA+G;iBAClH,CAAC,CACH,CAAC;YAEN,qBAAS,CAAC,MAAM,CAAC,sBAAsB,EAAE,kBAAkB,CAAC,CAAC;YAE7D,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBACxB,MAAM,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC;YACD,uDAAuD;YACvD,OAAO;QACT,CAAC;QAED,MAAM,2BAA2B,GAAG,8BAA8B,EAAE,CAAC;QACrE,IAAI,2BAA2B,CAAC,MAAM,EAAE,CAAC;YACvC,eAAK,CAAC,GAAG,CAAC,IAAI,CACZ;;EAEN,2BAA2B,CAAC,IAAI,CAAC,IAAI,CAAC;;yCAEC,CAClC,CAAC;YACF,MAAM,qBAAqB,GAAG,MAAM,gBAAgB,CAClD,eAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,iCAAiC;aAC3C,CAAC,CACH,CAAC;YAEF,qBAAS,CAAC,MAAM,CAAC,0BAA0B,EAAE,qBAAqB,CAAC,CAAC;YAEpE,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBAC3B,MAAM,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC;QACH,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAgB,WAAW;IACzB,IAAI,CAAC;QACH,YAAY,CAAC,QAAQ,CAAC,qCAAqC,EAAE;YAC3D,KAAK,EAAE,QAAQ;SAChB,CAAC,CAAC;QACH,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AACH,CAAC;AAED,SAAgB,8BAA8B;IAC5C,IAAI,CAAC;QACH,MAAM,SAAS,GAAG,YAAY;aAC3B,QAAQ,CAAC,2BAA2B,EAAE;YACrC,4BAA4B;YAC5B,KAAK,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC;SACpC,CAAC;aACD,QAAQ,EAAE,CAAC;QAEd,MAAM,KAAK,GAAG,SAAS;aACpB,KAAK,CAAC,EAAE,CAAC,GAAG,CAAC;aACb,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;aAC1B,MAAM,CAAC,OAAO,CAAC;aACf,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAExC,OAAO,KAAK,CAAC;IACf,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,EAAE,CAAC;IACZ,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,mBAAmB,CACvC,KAAe,EACf,OAAe;IAEf,MAAM,SAAS,GACb,MAAM,gBAAgB,CACpB,eAAK,CAAC,MAAM,CAAC;QACX,QAAQ,EAAE,EAAE;QACZ,OAAO,EAAE,OAAO;QAChB,OAAO,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;YACjC,OAAO;gBACL,KAAK,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE;gBACpC,KAAK,EAAE,IAAI;aACZ,CAAC;QACJ,CAAC,CAAC;KACH,CAAC,CACH,CAAC;IAEJ,OAAO,SAAS,CAAC;AACnB,CAAC;AAEM,KAAK,UAAU,2CAA2C,CAAC,EAChE,SAAS,EACT,WAAW,EACX,cAAc,EACd,kBAAkB,EAClB,IAAI,GAOL;IACC,OAAO,IAAA,qBAAS,EAAC,uBAAuB,EAAE,KAAK,IAAI,EAAE;QACnD,qBAAS,CAAC,MAAM,CAAC,GAAG,WAAW,CAAC,WAAW,EAAE,UAAU,EAAE,cAAc,CAAC,CAAC;QACzE,MAAM,kBAAkB,GAAG,IAAA,6BAAoB,EAAC;YAC9C,kBAAkB;YAClB,OAAO,EAAE,cAAc;YACvB,WAAW,EAAE,IAAI;SAClB,CAAC,CAAC;QAEH,IAAI,kBAAkB,EAAE,CAAC;YACvB,qBAAS,CAAC,MAAM,CAAC,GAAG,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;YACjE,OAAO;QACT,CAAC;QAED,eAAK,CAAC,GAAG,CAAC,IAAI,CACZ,sCAAsC,WAAW;;IAEnD,SAAS,IAAI,cAAc,EAAE,CAC5B,CAAC;QAEF,eAAK,CAAC,IAAI,CACR,IAAI;YACF,qBAAqB,kBAAkB,yCAAyC,CACnF,CAAC;QACF,MAAM,8BAA8B,GAAG,MAAM,gBAAgB,CAC3D,eAAK,CAAC,OAAO,CAAC;YACZ,OAAO,EAAE,iCAAiC;SAC3C,CAAC,CACH,CAAC;QACF,qBAAS,CAAC,MAAM,CACd,GAAG,WAAW,CAAC,WAAW,EAAE,oCAAoC,EAChE,8BAA8B,CAC/B,CAAC;QAEF,IAAI,CAAC,8BAA8B,EAAE,CAAC;YACpC,MAAM,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QAC5B,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAEM,KAAK,UAAU,kBAAkB,CAAC,EACvC,UAAU,GACwB;IAClC,IAAI,CAAC;QACH,MAAM,WAAW,GAAG,MAAM,iBAAiB,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC;QAC5D,MAAM,YAAY,GAAG,IAAA,gCAAiB,EAAC,OAAO,EAAE,WAAW,CAAC,CAAC;QAE7D,IAAI,CAAC,YAAY,EAAE,CAAC;YAClB,OAAO,KAAK,CAAC;QACf,CAAC;QAED,OAAO,IAAA,6BAAoB,EAAC;YAC1B,OAAO,EAAE,YAAY;YACrB,kBAAkB,EAAE,UAAU;YAC9B,WAAW,EAAE,IAAI;SAClB,CAAC,CAAC;IACL,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,KAAK,CAAC;IACf,CAAC;AACH,CAAC;AAED;;;;;GAKG;AACI,KAAK,UAAU,cAAc,CAAC,EACnC,WAAW,EACX,gBAAgB,EAChB,iBAAiB,GAAG,IAAI,EACxB,uBAAuB,EACvB,cAAc,EACd,YAAY,GAAG,KAAK,EACpB,WAAW,EACX,UAAU,GAeX;IACC,OAAO,IAAA,qBAAS,EAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;QAC7C,IAAI,gBAAgB,IAAI,iBAAiB,EAAE,CAAC;YAC1C,MAAM,mBAAmB,GAAG,MAAM,gBAAgB,CAChD,eAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,OAAO,eAAK,CAAC,IAAI,CAAC,IAAI,CAC7B,uBAAuB,IAAI,WAAW,CACvC,gFAAgF;aAClF,CAAC,CACH,CAAC;YAEF,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACzB,OAAO,EAAE,CAAC;YACZ,CAAC;QACH,CAAC;QAED,MAAM,iBAAiB,GAAG,eAAK,CAAC,OAAO,EAAE,CAAC;QAE1C,MAAM,UAAU,GACd,cAAc,IAAI,CAAC,MAAM,iBAAiB,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC,CAAC;QAE9D,mGAAmG;QACnG,MAAM,SAAS,GAAG,MAAM,kBAAkB,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC;QAC3D,MAAM,kBAAkB,GACtB,SAAS,IAAI,UAAU,CAAC,IAAI,KAAK,KAAK,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC;QAErE,iBAAiB,CAAC,KAAK,CACrB,GAAG,gBAAgB,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,YAAY,IAAI,eAAK,CAAC,IAAI,CAAC,IAAI,CAChE,uBAAuB,IAAI,WAAW,CACvC,SAAS,eAAK,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAC1C,CAAC;QAEF,IAAI,CAAC;YACH,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;gBAC1C,YAAY,CAAC,IAAI,CACf,GAAG,UAAU,CAAC,cAAc,IAAI,WAAW,IAAI,UAAU,CAAC,KAAK,IAC7D,YAAY,CAAC,CAAC,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAC/C,IAAI,kBAAkB,EAAE,CAAC,IAAI,EAAE,EAC/B,EAAE,GAAG,EAAE,UAAU,EAAE,EACnB,CAAC,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,EAAE;oBACtB,IAAI,GAAG,EAAE,CAAC;wBACR,wDAAwD;wBACxD,EAAE,CAAC,aAAa,CACd,IAAA,gBAAI,EACF,OAAO,CAAC,GAAG,EAAE,EACb,qCAAqC,IAAI,CAAC,GAAG,EAAE,MAAM,CACtD,EACD,IAAI,CAAC,SAAS,CAAC;4BACb,MAAM;4BACN,MAAM;yBACP,CAAC,EACF,EAAE,QAAQ,EAAE,MAAM,EAAE,CACrB,CAAC;wBAEF,MAAM,CAAC,GAAG,CAAC,CAAC;oBACd,CAAC;yBAAM,CAAC;wBACN,OAAO,EAAE,CAAC;oBACZ,CAAC;gBACH,CAAC,CACF,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,iBAAiB,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;YAC/C,eAAK,CAAC,GAAG,CAAC,KAAK,CACb,GAAG,eAAK,CAAC,GAAG,CACV,sDAAsD,CAEvD,OAAO,CAAC,OAAO,eAAK,CAAC,GAAG,CACvB,sMAAsM,sBAAU,EAAE,CACnN,EAAE,CACJ,CAAC;YACF,MAAM,KAAK,EAAE,CAAC;QAChB,CAAC;QAED,iBAAiB,CAAC,IAAI,CACpB,GAAG,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,IAAI,eAAK,CAAC,IAAI,CAAC,IAAI,CAC9D,uBAAuB,IAAI,WAAW,CACvC,SAAS,eAAK,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAC1C,CAAC;QAEF,qBAAS,CAAC,OAAO,CAAC,oBAAoB,EAAE;YACtC,MAAM,EAAE,mBAAmB;YAC3B,YAAY,EAAE,WAAW;YACzB,eAAe,EAAE,UAAU,CAAC,IAAI;YAChC,WAAW;SACZ,CAAC,CAAC;QAEH,OAAO,EAAE,cAAc,EAAE,UAAU,EAAE,CAAC;IACxC,CAAC,CAAC,CAAC;AACL,CAAC;AAED;;;;;;;;;GASG;AACI,KAAK,UAAU,wBAAwB,CAC5C,WAA2B,EAC3B,SAAiB,EACjB,WAAmB;IAEnB,OAAO,IAAA,qBAAS,EAAC,0BAA0B,EAAE,KAAK,IAAI,EAAE;QACtD,MAAM,SAAS,GAAG,IAAA,kCAAmB,EAAC,SAAS,EAAE,WAAW,CAAC,CAAC;QAE9D,qBAAS,CAAC,MAAM,CAAC,GAAG,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC;QAEtE,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,MAAM,sBAAsB,GAAG,MAAM,gBAAgB,CACnD,eAAK,CAAC,OAAO,CAAC;gBACZ,OAAO,EAAE,GAAG,WAAW,gEAAgE;gBACvF,YAAY,EAAE,KAAK;aACpB,CAAC,CACH,CAAC;YAEF,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAC5B,MAAM,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YAC5B,CAAC;QACH,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAEM,KAAK,UAAU,iBAAiB,CAAC,EACtC,UAAU,GACwB;IAClC,MAAM,uBAAuB,GAAG,MAAM,EAAE,CAAC,QAAQ;SAC9C,QAAQ,CAAC,IAAA,gBAAI,EAAC,UAAU,EAAE,cAAc,CAAC,EAAE,MAAM,CAAC;SAClD,KAAK,CAAC,GAAG,EAAE;QACV,eAAK,CAAC,GAAG,CAAC,KAAK,CACb,mFAAmF,CACpF,CAAC;QACF,OAAO,KAAK,EAAE,CAAC;IACjB,CAAC,CAAC,CAAC;IAEL,IAAI,WAAW,GAA+B,SAAS,CAAC;IAExD,IAAI,CAAC;QACH,mEAAmE;QACnE,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;IACpD,CAAC;IAAC,MAAM,CAAC;QACP,eAAK,CAAC,GAAG,CAAC,KAAK,CACb,wBAAwB,eAAK,CAAC,IAAI,CAChC,cAAc,CACf,oCAAoC,CACtC,CAAC;QAEF,MAAM,KAAK,EAAE,CAAC;IAChB,CAAC;IAED,OAAO,WAAW,IAAI,EAAE,CAAC;AAC3B,CAAC;AAEM,KAAK,UAAU,oBAAoB,CACxC,cAA8B,EAC9B,EAAE,UAAU,EAAqC;IAEjD,IAAI,CAAC;QACH,MAAM,EAAE,CAAC,QAAQ,CAAC,SAAS,CACzB,IAAA,gBAAI,EAAC,UAAU,EAAE,cAAc,CAAC;QAChC,kDAAkD;QAClD,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC,EACvC;YACE,QAAQ,EAAE,MAAM;YAChB,IAAI,EAAE,GAAG;SACV,CACF,CAAC;IACJ,CAAC;IAAC,MAAM,CAAC;QACP,eAAK,CAAC,GAAG,CAAC,KAAK,CAAC,yBAAyB,eAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;QAExE,MAAM,KAAK,EAAE,CAAC;IAChB,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,iBAAiB,CAAC,EACtC,UAAU,GACwB;IAClC,MAAM,uBAAuB,GAAG,IAAA,0CAAwB,EAAC,EAAE,UAAU,EAAE,CAAC,CAAC;IAEzE,gEAAgE;IAChE,IAAI,uBAAuB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACzC,MAAM,sBAAsB,GAAG,uBAAuB,CAAC,CAAC,CAAC,CAAC;QAC1D,qBAAS,CAAC,MAAM,CAAC,iBAAiB,EAAE,sBAAsB,CAAC,IAAI,CAAC,CAAC;QACjE,OAAO,sBAAsB,CAAC;IAChC,CAAC;IAED,qEAAqE;IACrE,MAAM,OAAO,GACX,uBAAuB,CAAC,MAAM,GAAG,CAAC;QAChC,CAAC,CAAC,uBAAuB;QACzB,CAAC,CAAC,iCAAe,CAAC;IAEtB,MAAM,OAAO,GACX,uBAAuB,CAAC,MAAM,GAAG,CAAC;QAChC,CAAC,CAAC,wDAAwD;QAC1D,CAAC,CAAC,qCAAqC,CAAC;IAE5C,MAAM,sBAAsB,GAC1B,MAAM,gBAAgB,CACpB,eAAK,CAAC,MAAM,CAAC;QACX,OAAO;QACP,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;YACxC,KAAK,EAAE,cAAc;YACrB,KAAK,EAAE,cAAc,CAAC,KAAK;SAC5B,CAAC,CAAC;KACJ,CAAC,CACH,CAAC;IAEJ,qBAAS,CAAC,MAAM,CAAC,iBAAiB,EAAE,sBAAsB,CAAC,IAAI,CAAC,CAAC;IACjE,OAAO,sBAAsB,CAAC;AAChC,CAAC;AAED,SAAgB,iBAAiB,CAAC,EAChC,UAAU,GACwB;IAClC,IAAI,CAAC;QACH,OAAO,EAAE,CAAC,UAAU,CAAC,IAAA,gBAAI,EAAC,UAAU,EAAE,eAAe,CAAC,CAAC,CAAC;IAC1D,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,KAAK,CAAC;IACf,CAAC;AACH,CAAC;AAED;;;;;;GAMG;AACI,KAAK,UAAU,sBAAsB,CAC1C,QAEC;IAOD,MAAM,QAAQ,GAAG,IAAA,4BAAqB,EAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;IAC7D,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,WAAW,EAAE,SAAS,EAAE,GAAG,MAAM,IAAA,qBAAS,EACrE,OAAO,EACP,GAAG,EAAE,CACH,iBAAiB,CAAC;QAChB,WAAW,EAAE,QAAQ,CAAC,WAAW;QACjC,MAAM,EAAE,QAAQ,CAAC,MAAM;KACxB,CAAC,CACL,CAAC;IAEF,IAAI,CAAC,aAAa,EAAE,CAAC;QACnB,eAAK,CAAC,GAAG,CAAC,KAAK,CAAC;;;EAGlB,eAAK,CAAC,IAAI,CAAC,sBAAU,CAAC,EAAE,CAAC,CAAC;QAExB,eAAK,CAAC,GAAG;aACN,IAAI,CAAC,uDAAuD,eAAK,CAAC,IAAI,CACvE,IAAI,iCAAqB,GAAG,CAC7B;;EAEH,eAAK,CAAC,IAAI,CAAC,GAAG,QAAQ,6BAA6B,CAAC,EAAE,CAAC,CAAC;IACxD,CAAC;IAED,OAAO;QACL,WAAW;QACX,IAAI,EAAE,IAAI,IAAI,4BAAgB;QAC9B,aAAa,EAAE,aAAa,IAAI,iCAAqB;QACrD,SAAS;KACV,CAAC;AACJ,CAAC;AAED,KAAK,UAAU,iBAAiB,CAAC,OAGhC;IACC,MAAM,aAAa,GAAG,MAAM,IAAA,wBAAgB,EAAC;QAC3C,WAAW,EAAE,OAAO,CAAC,WAAW;QAChC,MAAM,EAAE,CAAC,WAAW,EAAE,cAAc,EAAE,eAAe,CAAC;QACtD,MAAM,EAAE,OAAO,CAAC,MAAM;KACvB,CAAC,CAAC;IAEH,MAAM,SAAS,GAAG,aAAa,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,CAAC;IAElD,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;QAC5B,MAAM,KAAK,GAAG,IAAI,KAAK,CACrB,wEAAwE,CACzE,CAAC;QACF,qBAAS,CAAC,gBAAgB,CAAC,KAAK,EAAE;YAChC,IAAI,EAAE,cAAc;YACpB,gBAAgB,EAAE,CAAC,CAAC,aAAa,CAAC,YAAY;SAC/C,CAAC,CAAC;QACH,eAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QAC/B,MAAM,KAAK,EAAE,CAAC;IAChB,CAAC;IAED,MAAM,QAAQ,GAAG,IAAA,4BAAqB,EAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IAC5D,MAAM,IAAI,GAAG,IAAA,wBAAiB,EAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IAEpD,MAAM,WAAW,GAAG,MAAM,IAAA,sBAAgB,EACxC,aAAa,CAAC,YAAY,EAC1B,SAAU,EACV,QAAQ,CACT,CAAC;IACF,MAAM,QAAQ,GAAG,MAAM,IAAA,mBAAa,EAAC,aAAa,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;IAE3E,MAAM,IAAI,GAAgB;QACxB,WAAW,EAAE,aAAa,CAAC,YAAY;QACvC,aAAa,EAAE,WAAW,CAAC,SAAS;QACpC,IAAI;QACJ,UAAU,EAAE,QAAQ,CAAC,WAAW;QAChC,SAAS,EAAE,SAAU;KACtB,CAAC;IAEF,eAAK,CAAC,GAAG,CAAC,OAAO,CACf,mBAAmB,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE,EAAE,CACpE,CAAC;IACF,qBAAS,CAAC,MAAM,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;IAC7C,qBAAS,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAEzC,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;;;;;;;;;GAWG;AACI,KAAK,UAAU,oBAAoB,CACxC,QAAgB,EAChB,cAAsB;IAEtB,MAAM,SAAS,GAAG,MAAM,gBAAgB,CACtC,eAAK,CAAC,OAAO,CAAC;QACZ,OAAO,EAAE,iBAAiB,QAAQ,sBAAsB,eAAK,CAAC,IAAI,CAChE,cAAc,CACf,IAAI;QACL,YAAY,EAAE,IAAI;KACnB,CAAC,CACH,CAAC;IAEF,IAAI,CAAC,SAAS,EAAE,CAAC;QACf,OAAO,SAAS,CAAC;IACnB,CAAC;IAED,OAAO,MAAM,gBAAgB,CAC3B,eAAK,CAAC,IAAI,CAAC;QACT,OAAO,EAAE,iCAAiC,QAAQ,eAAe;QACjE,WAAW,EAAE,IAAA,gBAAI,EAAC,GAAG,EAAE,cAAc,CAAC;QACtC,QAAQ,EAAE,CAAC,KAAK,EAAE,EAAE;YAClB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,OAAO,sBAAsB,CAAC;YAChC,CAAC;YAED,IAAI,CAAC;gBACH,EAAE,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YACvB,CAAC;YAAC,MAAM,CAAC;gBACP,OAAO,yCAAyC,CAAC;YACnD,CAAC;QACH,CAAC;KACF,CAAC,CACH,CAAC;AACJ,CAAC;AAED;;;;;;;;;;;;;;;;;;;;;GAqBG;AACI,KAAK,UAAU,yBAAyB,CAC7C,QAAgB,EAChB,WAAmB,EACnB,IAAa;IAEb,eAAK,CAAC,GAAG,CAAC,IAAI,CACZ,kCAAkC,eAAK,CAAC,IAAI,CAAC,IAAA,oBAAQ,EAAC,QAAQ,CAAC,CAAC,SAC9D,IAAI,CAAC,CAAC,CAAC,eAAK,CAAC,GAAG,CAAC,KAAK,eAAK,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAC9C,EAAE,CACH,CAAC;IAEF,4EAA4E;IAC5E,8EAA8E;IAC9E,gGAAgG;IAChG,sCAAsC;IACtC,OAAO,CAAC,GAAG,CAAC,KAAK,WAAW,IAAI,CAAC,CAAC;IAElC,MAAM,gBAAgB,CACpB,eAAK,CAAC,MAAM,CAAC;QACX,OAAO,EAAE,kCAAkC;QAC3C,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,gBAAgB,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;QACnD,YAAY,EAAE,IAAI;KACnB,CAAC,CACH,CAAC;AACJ,CAAC;AAcD;;;;;;;;;;;;;;;;;GAiBG;AACH,SAAgB,eAAe,CAC7B,MAAe,EACf,QAA8B;IAE9B,MAAM,SAAS,GAAG,CAAC,GAAW,EAAE,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,eAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IACpE,MAAM,IAAI,GAAG,CAAC,GAAW,EAAE,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,eAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IACtE,MAAM,KAAK,GAAG,CAAC,GAAW,EAAE,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,eAAK,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IAErE,OAAO,QAAQ,CAAC,SAAS,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;AAC1C,CAAC;AAED;;;;;;;;;;;;;;;;GAgBG;AACI,KAAK,UAAU,mBAAmB,CACvC,QAAgB,EAChB,WAAmB,EACnB,EAAE,UAAU,EAAqC,EACjD,eAAwB;IAExB,IAAI,CAAC,IAAA,sBAAU,EAAC,QAAQ,CAAC,EAAE,CAAC;QAC1B,IAAA,aAAK,EAAC,kDAAkD,QAAQ,EAAE,CAAC,CAAC;QACpE,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,cAAc,GAAG,eAAK,CAAC,IAAI,CAAC,IAAA,oBAAQ,EAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;IAElE,IAAI,CAAC;QACH,MAAM,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;QAEnD,eAAK,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,cAAc,QAAQ,CAAC,CAAC;QAEvD,IAAI,eAAe,EAAE,CAAC;YACpB,eAAK,CAAC,GAAG,CAAC,IAAI,CAAC,eAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC;QAC9C,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,IAAA,aAAK,EAAC,CAAC,CAAC,CAAC;QACT,eAAK,CAAC,GAAG,CAAC,IAAI,CACZ,0BAA0B,cAAc,sEAAsE,CAC/G,CAAC;IACJ,CAAC;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAEM,KAAK,UAAU,sBAAsB,CAC1C,QAAW;IAEX,OAAO,IAAA,qBAAS,EAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;QAC/C,MAAM,gBAAgB,GAA4B,EAAE,CAAC;QAErD,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE,CAAC;YAC/B,MAAM,QAAQ,GAAG,MAAM,gBAAgB,CACrC,eAAK,CAAC,MAAM,CAAC;gBACX,OAAO,EAAE,OAAO,CAAC,MAAM;gBACvB,YAAY,EAAE,IAAI;gBAClB,OAAO,EAAE;oBACP;wBACE,KAAK,EAAE,IAAI;wBACX,KAAK,EAAE,KAAK;wBACZ,IAAI,EAAE,OAAO,CAAC,WAAW;qBAC1B;oBACD;wBACE,KAAK,EAAE,KAAK;wBACZ,KAAK,EAAE,IAAI;wBACX,IAAI,EAAE,OAAO,CAAC,YAAY;qBAC3B;iBACF;aACF,CAAC,CACH,CAAC;YAEF,gBAAgB,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC;QAC1C,CAAC;QAED,OAAO,gBAAyD,CAAC;IACnE,CAAC,CAAC,CAAC;AACL,CAAC;AAEM,KAAK,UAAU,uBAAuB,CAC3C,OAAe;IAEf,OAAO,IAAA,qBAAS,EAAC,qBAAqB,EAAE,GAAG,EAAE,CAC3C,gBAAgB,CACd,eAAK,CAAC,OAAO,CAAC;QACZ,OAAO,EAAE,0BAA0B,eAAK,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG;KAC1D,CAAC,CACH,CACF,CAAC;AACJ,CAAC;AAEM,KAAK,UAAU,2BAA2B,CAC/C,OAAe,EACf,UAAkB;IAElB,OAAO,IAAA,qBAAS,EAAC,0BAA0B,EAAE,GAAG,EAAE,CAChD,gBAAgB,CACd,eAAK,CAAC,OAAO,CAAC;QACZ,OAAO,EAAE,sCAAsC,eAAK,CAAC,IAAI,CACvD,OAAO,CACR,YAAY,eAAK,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG;KACvC,CAAC,CACH,CACF,CAAC;AACJ,CAAC;AAEM,KAAK,UAAU,eAAe,CAAC,OAAuC;IAC3E,OAAO,MAAM,IAAA,qBAAS,EAAC,oBAAoB,EAAE,KAAK,IAAI,EAAE;QACtD,MAAM,SAAS,GAAG,OAAO,CAAC,OAAO;YAC/B,CAAC,CAAC,IAAI;YACN,CAAC,CAAC,MAAM,gBAAgB,CACpB,eAAK,CAAC,MAAM,CAAC;gBACX,OAAO,EAAE,yDAAyD;gBAClE,OAAO,EAAE;oBACP;wBACE,KAAK,EAAE,KAAK;wBACZ,KAAK,EAAE,IAAI;wBACX,IAAI,EAAE,kDAAkD;qBACzD;oBACD;wBACE,KAAK,EAAE,IAAI;wBACX,KAAK,EAAE,KAAK;wBACZ,IAAI,EAAE,iBAAiB;qBACxB;iBACF;gBACD,YAAY,EAAE,IAAI;aACnB,CAAC,CACH,CAAC;QAEN,OAAO,SAAS,CAAC;IACnB,CAAC,CAAC,CAAC;AACL,CAAC;AAEM,KAAK,UAAU,iBAAiB;IACrC,OAAO,MAAM,IAAA,qBAAS,EAAC,sBAAsB,EAAE,KAAK,IAAI,EAAE;QACxD,MAAM,WAAW,GAAgB,MAAM,gBAAgB,CACrD,eAAK,CAAC,MAAM,CAAC;YACX,OAAO,EAAE,kCAAkC;YAC3C,OAAO,EAAE;gBACP;oBACE,KAAK,EAAE,SAAS;oBAChB,KAAK,EAAE,IAAI;oBACX,IAAI,EAAE,oCAAoC;iBAC3C;gBACD;oBACE,KAAK,EAAE,SAAS;oBAChB,KAAK,EAAE,IAAI;oBACX,IAAI,EAAE,oCAAoC;iBAC3C;aACF;SACF,CAAC,CACH,CAAC;QAEF,OAAO,WAAW,CAAC;IACrB,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["import * as childProcess from 'node:child_process';\nimport * as fs from 'node:fs';\nimport * as os from 'node:os';\nimport { basename, isAbsolute, join, relative } from 'node:path';\n\nimport chalk from 'chalk';\nimport { traceStep } from '../telemetry';\nimport { debug } from './debug';\nimport { type PackageDotJson, hasPackageInstalled } from './package-json';\nimport {\n  type PackageManager,\n  detectAllPackageManagers,\n  packageManagers,\n} from './package-manager';\nimport { fulfillsVersionRange } from './semver';\nimport type { CloudRegion, Feature, WizardOptions } from './types';\nimport { getPackageVersion } from './package-json';\nimport {\n  DEFAULT_HOST_URL,\n  DUMMY_PROJECT_API_KEY,\n  ISSUES_URL,\n  type Integration,\n} from '../lib/constants';\nimport { analytics } from './analytics';\nimport clack from './clack';\nimport { getCloudUrlFromRegion, getHostFromRegion } from './urls';\nimport { INTEGRATION_CONFIG } from '../lib/config';\nimport { performOAuthFlow } from './oauth';\nimport { fetchUserData, fetchProjectData } from '../lib/api';\n\ninterface ProjectData {\n  projectApiKey: string;\n  accessToken: string;\n  host: string;\n  distinctId: string;\n  projectId: number;\n}\n\nexport interface CliSetupConfig {\n  filename: string;\n  name: string;\n  gitignore: boolean;\n\n  likelyAlreadyHasAuthToken(contents: string): boolean;\n  tokenContent(authToken: string): string;\n\n  likelyAlreadyHasOrgAndProject(contents: string): boolean;\n  orgAndProjContent(org: string, project: string): string;\n\n  likelyAlreadyHasUrl?(contents: string): boolean;\n  urlContent?(url: string): string;\n}\n\nexport interface CliSetupConfigContent {\n  authToken: string;\n  org?: string;\n  project?: string;\n  url?: string;\n}\n\nexport async function abort(message?: string, status?: number): Promise<never> {\n  await analytics.shutdown('cancelled');\n\n  clack.outro(message ?? 'Wizard setup cancelled.');\n  return process.exit(status ?? 1);\n}\n\nexport async function abortIfCancelled<T>(\n  input: T | Promise<T>,\n  integration?: Integration,\n): Promise<Exclude<T, symbol>> {\n  await analytics.shutdown('cancelled');\n  const resolvedInput = await input;\n\n  if (\n    clack.isCancel(resolvedInput) ||\n    (typeof resolvedInput === 'symbol' &&\n      resolvedInput.description === 'clack:cancel')\n  ) {\n    const docsUrl = integration\n      ? INTEGRATION_CONFIG[integration].docsUrl\n      : 'https://posthog.com/docs';\n\n    clack.cancel(\n      `Wizard setup cancelled. You can read the documentation for ${\n        integration ?? 'PostHog'\n      } at ${chalk.cyan(docsUrl)} to continue with the setup manually.`,\n    );\n    process.exit(0);\n  } else {\n    return input as Exclude<T, symbol>;\n  }\n}\n\nexport function printWelcome(options: {\n  wizardName: string;\n  message?: string;\n}): void {\n  // eslint-disable-next-line no-console\n  console.log('');\n  clack.intro(chalk.inverse(` ${options.wizardName} `));\n\n  const welcomeText =\n    options.message ||\n    `The ${options.wizardName} will help you set up PostHog for your application.\\nThank you for using PostHog :)`;\n\n  clack.note(welcomeText);\n}\n\nexport async function confirmContinueIfNoOrDirtyGitRepo(\n  options: Pick<WizardOptions, 'default'>,\n): Promise<void> {\n  return traceStep('check-git-status', async () => {\n    if (!isInGitRepo()) {\n      const continueWithoutGit = options.default\n        ? true\n        : await abortIfCancelled(\n            clack.confirm({\n              message:\n                'You are not inside a git repository. The wizard will create and update files. Do you want to continue anyway?',\n            }),\n          );\n\n      analytics.setTag('continue-without-git', continueWithoutGit);\n\n      if (!continueWithoutGit) {\n        await abort(undefined, 0);\n      }\n      // return early to avoid checking for uncommitted files\n      return;\n    }\n\n    const uncommittedOrUntrackedFiles = getUncommittedOrUntrackedFiles();\n    if (uncommittedOrUntrackedFiles.length) {\n      clack.log.warn(\n        `You have uncommitted or untracked files in your repo:\n\n${uncommittedOrUntrackedFiles.join('\\n')}\n\nThe wizard will create and update files.`,\n      );\n      const continueWithDirtyRepo = await abortIfCancelled(\n        clack.confirm({\n          message: 'Do you want to continue anyway?',\n        }),\n      );\n\n      analytics.setTag('continue-with-dirty-repo', continueWithDirtyRepo);\n\n      if (!continueWithDirtyRepo) {\n        await abort(undefined, 0);\n      }\n    }\n  });\n}\n\nexport function isInGitRepo() {\n  try {\n    childProcess.execSync('git rev-parse --is-inside-work-tree', {\n      stdio: 'ignore',\n    });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function getUncommittedOrUntrackedFiles(): string[] {\n  try {\n    const gitStatus = childProcess\n      .execSync('git status --porcelain=v1', {\n        // we only care about stdout\n        stdio: ['ignore', 'pipe', 'ignore'],\n      })\n      .toString();\n\n    const files = gitStatus\n      .split(os.EOL)\n      .map((line) => line.trim())\n      .filter(Boolean)\n      .map((f) => `- ${f.split(/\\s+/)[1]}`);\n\n    return files;\n  } catch {\n    return [];\n  }\n}\n\nexport async function askForItemSelection(\n  items: string[],\n  message: string,\n): Promise<{ value: string; index: number }> {\n  const selection: { value: string; index: number } | symbol =\n    await abortIfCancelled(\n      clack.select({\n        maxItems: 12,\n        message: message,\n        options: items.map((item, index) => {\n          return {\n            value: { value: item, index: index },\n            label: item,\n          };\n        }),\n      }),\n    );\n\n  return selection;\n}\n\nexport async function confirmContinueIfPackageVersionNotSupported({\n  packageId,\n  packageName,\n  packageVersion,\n  acceptableVersions,\n  note,\n}: {\n  packageId: string;\n  packageName: string;\n  packageVersion: string;\n  acceptableVersions: string;\n  note?: string;\n}): Promise<void> {\n  return traceStep(`check-package-version`, async () => {\n    analytics.setTag(`${packageName.toLowerCase()}-version`, packageVersion);\n    const isSupportedVersion = fulfillsVersionRange({\n      acceptableVersions,\n      version: packageVersion,\n      canBeLatest: true,\n    });\n\n    if (isSupportedVersion) {\n      analytics.setTag(`${packageName.toLowerCase()}-supported`, true);\n      return;\n    }\n\n    clack.log.warn(\n      `You have an unsupported version of ${packageName} installed:\n\n  ${packageId}@${packageVersion}`,\n    );\n\n    clack.note(\n      note ??\n        `Please upgrade to ${acceptableVersions} if you wish to use the PostHog wizard.`,\n    );\n    const continueWithUnsupportedVersion = await abortIfCancelled(\n      clack.confirm({\n        message: 'Do you want to continue anyway?',\n      }),\n    );\n    analytics.setTag(\n      `${packageName.toLowerCase()}-continue-with-unsupported-version`,\n      continueWithUnsupportedVersion,\n    );\n\n    if (!continueWithUnsupportedVersion) {\n      await abort(undefined, 0);\n    }\n  });\n}\n\nexport async function isReact19Installed({\n  installDir,\n}: Pick<WizardOptions, 'installDir'>): Promise<boolean> {\n  try {\n    const packageJson = await getPackageDotJson({ installDir });\n    const reactVersion = getPackageVersion('react', packageJson);\n\n    if (!reactVersion) {\n      return false;\n    }\n\n    return fulfillsVersionRange({\n      version: reactVersion,\n      acceptableVersions: '>=19.0.0',\n      canBeLatest: true,\n    });\n  } catch (error) {\n    return false;\n  }\n}\n\n/**\n * Installs or updates a package with the user's package manager.\n *\n * IMPORTANT: This function modifies the `package.json`! Be sure to re-read\n * it if you make additional modifications to it after calling this function!\n */\nexport async function installPackage({\n  packageName,\n  alreadyInstalled,\n  askBeforeUpdating = true,\n  packageNameDisplayLabel,\n  packageManager,\n  forceInstall = false,\n  integration,\n  installDir,\n}: {\n  /** The string that is passed to the package manager CLI as identifier to install (e.g. `posthog-js`, or `posthog-js@^1.100.0`) */\n  packageName: string;\n  alreadyInstalled: boolean;\n  askBeforeUpdating?: boolean;\n  /** Overrides what is shown in the installation logs in place of the `packageName` option. Useful if the `packageName` is ugly */\n  packageNameDisplayLabel?: string;\n  packageManager?: PackageManager;\n  /** Add force install flag to command to skip install precondition fails */\n  forceInstall?: boolean;\n  /** The integration that is being used */\n  integration?: string;\n  /** The directory to install the package in */\n  installDir: string;\n}): Promise<{ packageManager?: PackageManager }> {\n  return traceStep('install-package', async () => {\n    if (alreadyInstalled && askBeforeUpdating) {\n      const shouldUpdatePackage = await abortIfCancelled(\n        clack.confirm({\n          message: `The ${chalk.bold.cyan(\n            packageNameDisplayLabel ?? packageName,\n          )} package is already installed. Do you want to update it to the latest version?`,\n        }),\n      );\n\n      if (!shouldUpdatePackage) {\n        return {};\n      }\n    }\n\n    const sdkInstallSpinner = clack.spinner();\n\n    const pkgManager =\n      packageManager || (await getPackageManager({ installDir }));\n\n    // Most packages aren't compatible with React 19 yet, skip strict peer dependency checks if needed.\n    const isReact19 = await isReact19Installed({ installDir });\n    const legacyPeerDepsFlag =\n      isReact19 && pkgManager.name === 'npm' ? '--legacy-peer-deps' : '';\n\n    sdkInstallSpinner.start(\n      `${alreadyInstalled ? 'Updating' : 'Installing'} ${chalk.bold.cyan(\n        packageNameDisplayLabel ?? packageName,\n      )} with ${chalk.bold(pkgManager.label)}.`,\n    );\n\n    try {\n      await new Promise<void>((resolve, reject) => {\n        childProcess.exec(\n          `${pkgManager.installCommand} ${packageName} ${pkgManager.flags} ${\n            forceInstall ? pkgManager.forceInstallFlag : ''\n          } ${legacyPeerDepsFlag}`.trim(),\n          { cwd: installDir },\n          (err, stdout, stderr) => {\n            if (err) {\n              // Write a log file so we can better troubleshoot issues\n              fs.writeFileSync(\n                join(\n                  process.cwd(),\n                  `posthog-wizard-installation-error-${Date.now()}.log`,\n                ),\n                JSON.stringify({\n                  stdout,\n                  stderr,\n                }),\n                { encoding: 'utf8' },\n              );\n\n              reject(err);\n            } else {\n              resolve();\n            }\n          },\n        );\n      });\n    } catch (e) {\n      sdkInstallSpinner.stop('Installation failed.');\n      clack.log.error(\n        `${chalk.red(\n          'Encountered the following error during installation:',\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        )}\\n\\n${e}\\n\\n${chalk.dim(\n          `The wizard has created a \\`posthog-wizard-installation-error-*.log\\` file. If you think this issue is caused by the PostHog wizard, create an issue on GitHub and include the log file's content:\\n${ISSUES_URL}`,\n        )}`,\n      );\n      await abort();\n    }\n\n    sdkInstallSpinner.stop(\n      `${alreadyInstalled ? 'Updated' : 'Installed'} ${chalk.bold.cyan(\n        packageNameDisplayLabel ?? packageName,\n      )} with ${chalk.bold(pkgManager.label)}.`,\n    );\n\n    analytics.capture('wizard interaction', {\n      action: 'package installed',\n      package_name: packageName,\n      package_manager: pkgManager.name,\n      integration,\n    });\n\n    return { packageManager: pkgManager };\n  });\n}\n\n/**\n * Checks if @param packageId is listed as a dependency in @param packageJson.\n * If not, it will ask users if they want to continue without the package.\n *\n * Use this function to check if e.g. a the framework of the SDK is installed\n *\n * @param packageJson the package.json object\n * @param packageId the npm name of the package\n * @param packageName a human readable name of the package\n */\nexport async function ensurePackageIsInstalled(\n  packageJson: PackageDotJson,\n  packageId: string,\n  packageName: string,\n): Promise<void> {\n  return traceStep('ensure-package-installed', async () => {\n    const installed = hasPackageInstalled(packageId, packageJson);\n\n    analytics.setTag(`${packageName.toLowerCase()}-installed`, installed);\n\n    if (!installed) {\n      const continueWithoutPackage = await abortIfCancelled(\n        clack.confirm({\n          message: `${packageName} does not seem to be installed. Do you still want to continue?`,\n          initialValue: false,\n        }),\n      );\n\n      if (!continueWithoutPackage) {\n        await abort(undefined, 0);\n      }\n    }\n  });\n}\n\nexport async function getPackageDotJson({\n  installDir,\n}: Pick<WizardOptions, 'installDir'>): Promise<PackageDotJson> {\n  const packageJsonFileContents = await fs.promises\n    .readFile(join(installDir, 'package.json'), 'utf8')\n    .catch(() => {\n      clack.log.error(\n        'Could not find package.json. Make sure to run the wizard in the root of your app!',\n      );\n      return abort();\n    });\n\n  let packageJson: PackageDotJson | undefined = undefined;\n\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n    packageJson = JSON.parse(packageJsonFileContents);\n  } catch {\n    clack.log.error(\n      `Unable to parse your ${chalk.cyan(\n        'package.json',\n      )}. Make sure it has a valid format!`,\n    );\n\n    await abort();\n  }\n\n  return packageJson || {};\n}\n\nexport async function updatePackageDotJson(\n  packageDotJson: PackageDotJson,\n  { installDir }: Pick<WizardOptions, 'installDir'>,\n): Promise<void> {\n  try {\n    await fs.promises.writeFile(\n      join(installDir, 'package.json'),\n      // TODO: maybe figure out the original indentation\n      JSON.stringify(packageDotJson, null, 2),\n      {\n        encoding: 'utf8',\n        flag: 'w',\n      },\n    );\n  } catch {\n    clack.log.error(`Unable to update your ${chalk.cyan('package.json')}.`);\n\n    await abort();\n  }\n}\n\nexport async function getPackageManager({\n  installDir,\n}: Pick<WizardOptions, 'installDir'>): Promise<PackageManager> {\n  const detectedPackageManagers = detectAllPackageManagers({ installDir });\n\n  // If exactly one package manager detected, use it automatically\n  if (detectedPackageManagers.length === 1) {\n    const detectedPackageManager = detectedPackageManagers[0];\n    analytics.setTag('package-manager', detectedPackageManager.name);\n    return detectedPackageManager;\n  }\n\n  // If multiple or no package managers detected, prompt user to select\n  const options =\n    detectedPackageManagers.length > 0\n      ? detectedPackageManagers\n      : packageManagers;\n\n  const message =\n    detectedPackageManagers.length > 1\n      ? 'Multiple package managers detected. Please select one:'\n      : 'Please select your package manager.';\n\n  const selectedPackageManager: PackageManager | symbol =\n    await abortIfCancelled(\n      clack.select({\n        message,\n        options: options.map((packageManager) => ({\n          value: packageManager,\n          label: packageManager.label,\n        })),\n      }),\n    );\n\n  analytics.setTag('package-manager', selectedPackageManager.name);\n  return selectedPackageManager;\n}\n\nexport function isUsingTypeScript({\n  installDir,\n}: Pick<WizardOptions, 'installDir'>) {\n  try {\n    return fs.existsSync(join(installDir, 'tsconfig.json'));\n  } catch {\n    return false;\n  }\n}\n\n/**\n *\n * Use this function to get project data for the wizard.\n *\n * @param options wizard options\n * @returns project data (token, url)\n */\nexport async function getOrAskForProjectData(\n  _options: Pick<WizardOptions, 'signup'> & {\n    cloudRegion: CloudRegion;\n  },\n): Promise<{\n  host: string;\n  projectApiKey: string;\n  accessToken: string;\n  projectId: number;\n}> {\n  const cloudUrl = getCloudUrlFromRegion(_options.cloudRegion);\n  const { host, projectApiKey, accessToken, projectId } = await traceStep(\n    'login',\n    () =>\n      askForWizardLogin({\n        cloudRegion: _options.cloudRegion,\n        signup: _options.signup,\n      }),\n  );\n\n  if (!projectApiKey) {\n    clack.log.error(`Didn't receive a project API key. This shouldn't happen :(\n\nPlease let us know if you think this is a bug in the wizard:\n${chalk.cyan(ISSUES_URL)}`);\n\n    clack.log\n      .info(`In the meantime, we'll add a dummy project API key (${chalk.cyan(\n      `\"${DUMMY_PROJECT_API_KEY}\"`,\n    )}) for you to replace later.\nYou can find your Project API key here:\n${chalk.cyan(`${cloudUrl}/settings/project#variables`)}`);\n  }\n\n  return {\n    accessToken,\n    host: host || DEFAULT_HOST_URL,\n    projectApiKey: projectApiKey || DUMMY_PROJECT_API_KEY,\n    projectId,\n  };\n}\n\nasync function askForWizardLogin(options: {\n  cloudRegion: CloudRegion;\n  signup: boolean;\n}): Promise<ProjectData> {\n  const tokenResponse = await performOAuthFlow({\n    cloudRegion: options.cloudRegion,\n    scopes: ['user:read', 'project:read', 'introspection'],\n    signup: options.signup,\n  });\n\n  const projectId = tokenResponse.scoped_teams?.[0];\n\n  if (projectId === undefined) {\n    const error = new Error(\n      'No project access granted. Please authorize with project-level access.',\n    );\n    analytics.captureException(error, {\n      step: 'wizard_login',\n      has_scoped_teams: !!tokenResponse.scoped_teams,\n    });\n    clack.log.error(error.message);\n    await abort();\n  }\n\n  const cloudUrl = getCloudUrlFromRegion(options.cloudRegion);\n  const host = getHostFromRegion(options.cloudRegion);\n\n  const projectData = await fetchProjectData(\n    tokenResponse.access_token,\n    projectId!,\n    cloudUrl,\n  );\n  const userData = await fetchUserData(tokenResponse.access_token, cloudUrl);\n\n  const data: ProjectData = {\n    accessToken: tokenResponse.access_token,\n    projectApiKey: projectData.api_token,\n    host,\n    distinctId: userData.distinct_id,\n    projectId: projectId!,\n  };\n\n  clack.log.success(\n    `Login complete. ${options.signup ? 'Welcome to PostHog! ðŸŽ‰' : ''}`,\n  );\n  analytics.setTag('opened-wizard-link', true);\n  analytics.setDistinctId(data.distinctId);\n\n  return data;\n}\n\n/**\n * Asks users if they have a config file for @param tool (e.g. Vite).\n * If yes, asks users to specify the path to their config file.\n *\n * Use this helper function as a fallback mechanism if the lookup for\n * a config file with its most usual location/name fails.\n *\n * @param toolName Name of the tool for which we're looking for the config file\n * @param configFileName Name of the most common config file name (e.g. vite.config.js)\n *\n * @returns a user path to the config file or undefined if the user doesn't have a config file\n */\nexport async function askForToolConfigPath(\n  toolName: string,\n  configFileName: string,\n): Promise<string | undefined> {\n  const hasConfig = await abortIfCancelled(\n    clack.confirm({\n      message: `Do you have a ${toolName} config file (e.g. ${chalk.cyan(\n        configFileName,\n      )})?`,\n      initialValue: true,\n    }),\n  );\n\n  if (!hasConfig) {\n    return undefined;\n  }\n\n  return await abortIfCancelled(\n    clack.text({\n      message: `Please enter the path to your ${toolName} config file:`,\n      placeholder: join('.', configFileName),\n      validate: (value) => {\n        if (!value) {\n          return 'Please enter a path.';\n        }\n\n        try {\n          fs.accessSync(value);\n        } catch {\n          return 'Could not access the file at this path.';\n        }\n      },\n    }),\n  );\n}\n\n/**\n * Prints copy/paste-able instructions to the console.\n * Afterwards asks the user if they added the code snippet to their file.\n *\n * While there's no point in providing a \"no\" answer here, it gives users time to fulfill the\n * task before the wizard continues with additional steps.\n *\n * Use this function if you want to show users instructions on how to add/modify\n * code in their file. This is helpful if automatic insertion failed or is not possible/feasible.\n *\n * @param filename the name of the file to which the code snippet should be applied.\n * If a path is provided, only the filename will be used.\n *\n * @param codeSnippet the snippet to be printed. Use {@link makeCodeSnippet}  to create the\n * diff-like format for visually highlighting unchanged or modified lines of code.\n *\n * @param hint (optional) a hint to be printed after the main instruction to add\n * the code from @param codeSnippet to their @param filename.\n *\n * TODO: refactor copy paste instructions across different wizards to use this function.\n *       this might require adding a custom message parameter to the function\n */\nexport async function showCopyPasteInstructions(\n  filename: string,\n  codeSnippet: string,\n  hint?: string,\n): Promise<void> {\n  clack.log.step(\n    `Add the following code to your ${chalk.cyan(basename(filename))} file:${\n      hint ? chalk.dim(` (${chalk.dim(hint)})`) : ''\n    }`,\n  );\n\n  // Padding the code snippet to be printed with a \\n at the beginning and end\n  // This makes it easier to distinguish the snippet from the rest of the output\n  // Intentionally logging directly to console here so that the code can be copied/pasted directly\n  // eslint-disable-next-line no-console\n  console.log(`\\n${codeSnippet}\\n`);\n\n  await abortIfCancelled(\n    clack.select({\n      message: 'Did you apply the snippet above?',\n      options: [{ label: 'Yes, continue!', value: true }],\n      initialValue: true,\n    }),\n  );\n}\n\n/**\n * Callback that exposes formatting helpers for a code snippet.\n * @param unchanged - Formats text as old code.\n * @param plus - Formats text as new code.\n * @param minus - Formats text as removed code.\n */\ntype CodeSnippetFormatter = (\n  unchanged: (txt: string) => string,\n  plus: (txt: string) => string,\n  minus: (txt: string) => string,\n) => string;\n\n/**\n * Crafts a code snippet that can be used to e.g.\n * - print copy/paste instructions to the console\n * - create a new config file.\n *\n * @param colors set this to true if you want the final snippet to be colored.\n * This is useful for printing the snippet to the console as part of copy/paste instructions.\n *\n * @param callback the callback that returns the formatted code snippet.\n * It exposes takes the helper functions for marking code as unchanged, new or removed.\n * These functions no-op if no special formatting should be applied\n * and otherwise apply the appropriate formatting/coloring.\n * (@see {@link CodeSnippetFormatter})\n *\n * @see {@link showCopyPasteInstructions} for the helper with which to display the snippet in the console.\n *\n * @returns a string containing the final, formatted code snippet.\n */\nexport function makeCodeSnippet(\n  colors: boolean,\n  callback: CodeSnippetFormatter,\n): string {\n  const unchanged = (txt: string) => (colors ? chalk.grey(txt) : txt);\n  const plus = (txt: string) => (colors ? chalk.greenBright(txt) : txt);\n  const minus = (txt: string) => (colors ? chalk.redBright(txt) : txt);\n\n  return callback(unchanged, plus, minus);\n}\n\n/**\n * Creates a new config file with the given @param filepath and @param codeSnippet.\n *\n * Use this function to create a new config file for users. This is useful\n * when users answered that they don't yet have a config file for a tool.\n *\n * (This doesn't mean that they don't yet have some other way of configuring\n * their tool but we can leave it up to them to figure out how to merge configs\n * here.)\n *\n * @param filepath absolute path to the new config file\n * @param codeSnippet the snippet to be inserted into the file\n * @param moreInformation (optional) the message to be printed after the file was created\n * For example, this can be a link to more information about configuring the tool.\n *\n * @returns true on success, false otherwise\n */\nexport async function createNewConfigFile(\n  filepath: string,\n  codeSnippet: string,\n  { installDir }: Pick<WizardOptions, 'installDir'>,\n  moreInformation?: string,\n): Promise<boolean> {\n  if (!isAbsolute(filepath)) {\n    debug(`createNewConfigFile: filepath is not absolute: ${filepath}`);\n    return false;\n  }\n\n  const prettyFilename = chalk.cyan(relative(installDir, filepath));\n\n  try {\n    await fs.promises.writeFile(filepath, codeSnippet);\n\n    clack.log.success(`Added new ${prettyFilename} file.`);\n\n    if (moreInformation) {\n      clack.log.info(chalk.gray(moreInformation));\n    }\n\n    return true;\n  } catch (e) {\n    debug(e);\n    clack.log.warn(\n      `Could not create a new ${prettyFilename} file. Please create one manually and follow the instructions below.`,\n    );\n  }\n\n  return false;\n}\n\nexport async function featureSelectionPrompt<F extends ReadonlyArray<Feature>>(\n  features: F,\n): Promise<{ [key in F[number]['id']]: boolean }> {\n  return traceStep('feature-selection', async () => {\n    const selectedFeatures: Record<string, boolean> = {};\n\n    for (const feature of features) {\n      const selected = await abortIfCancelled(\n        clack.select({\n          message: feature.prompt,\n          initialValue: true,\n          options: [\n            {\n              value: true,\n              label: 'Yes',\n              hint: feature.enabledHint,\n            },\n            {\n              value: false,\n              label: 'No',\n              hint: feature.disabledHint,\n            },\n          ],\n        }),\n      );\n\n      selectedFeatures[feature.id] = selected;\n    }\n\n    return selectedFeatures as { [key in F[number]['id']]: boolean };\n  });\n}\n\nexport async function askShouldInstallPackage(\n  pkgName: string,\n): Promise<boolean> {\n  return traceStep(`ask-install-package`, () =>\n    abortIfCancelled(\n      clack.confirm({\n        message: `Do you want to install ${chalk.cyan(pkgName)}?`,\n      }),\n    ),\n  );\n}\n\nexport async function askShouldAddPackageOverride(\n  pkgName: string,\n  pkgVersion: string,\n): Promise<boolean> {\n  return traceStep(`ask-add-package-override`, () =>\n    abortIfCancelled(\n      clack.confirm({\n        message: `Do you want to add an override for ${chalk.cyan(\n          pkgName,\n        )} version ${chalk.cyan(pkgVersion)}?`,\n      }),\n    ),\n  );\n}\n\nexport async function askForAIConsent(options: Pick<WizardOptions, 'default'>) {\n  return await traceStep('ask-for-ai-consent', async () => {\n    const aiConsent = options.default\n      ? true\n      : await abortIfCancelled(\n          clack.select({\n            message: 'This setup wizard uses AI, are you happy to continue? âœ¨',\n            options: [\n              {\n                label: 'Yes',\n                value: true,\n                hint: 'We will use AI to help you setup PostHog quickly',\n              },\n              {\n                label: 'No',\n                value: false,\n                hint: \"I don't like AI\",\n              },\n            ],\n            initialValue: true,\n          }),\n        );\n\n    return aiConsent;\n  });\n}\n\nexport async function askForCloudRegion(): Promise<CloudRegion> {\n  return await traceStep('ask-for-cloud-region', async () => {\n    const cloudRegion: CloudRegion = await abortIfCancelled(\n      clack.select({\n        message: 'Select your PostHog Cloud region',\n        options: [\n          {\n            label: 'US ðŸ‡ºðŸ‡¸',\n            value: 'us',\n            hint: 'Your data will be stored in the US',\n          },\n          {\n            label: 'EU ðŸ‡ªðŸ‡º',\n            value: 'eu',\n            hint: 'Your data will be stored in the EU',\n          },\n        ],\n      }),\n    );\n\n    return cloudRegion;\n  });\n}\n"]}