{"version":3,"file":"claude.test.js","sourceRoot":"","sources":["../../../../../../src/steps/add-mcp-server-to-clients/clients/__tests__/claude.test.ts"],"names":[],"mappings":"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","sourcesContent":["// We use the ClaudeMCPClient as a reference to test the DefaultMCPClient\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as os from 'os';\nimport { ClaudeMCPClient } from '../claude';\nimport { getDefaultServerConfig } from '../../defaults';\n\njest.mock('fs', () => ({\n  promises: {\n    mkdir: jest.fn(),\n    readFile: jest.fn(),\n    writeFile: jest.fn(),\n  },\n  existsSync: jest.fn(),\n}));\n\njest.mock('os', () => ({\n  homedir: jest.fn(),\n}));\n\njest.mock('../../defaults', () => ({\n  DefaultMCPClientConfig: {\n    parse: jest.fn(),\n  },\n  getDefaultServerConfig: jest.fn(),\n}));\n\ndescribe('ClaudeMCPClient', () => {\n  let client: ClaudeMCPClient;\n  const mockHomeDir = '/mock/home';\n  const mockApiKey = 'test-api-key';\n  const mockServerConfig = {\n    command: 'npx',\n    args: ['-y', 'mcp-remote@latest'],\n    env: { POSTHOG_AUTH_HEADER: `Bearer ${mockApiKey}` },\n  };\n\n  const mkdirMock = fs.promises.mkdir as jest.Mock;\n  const readFileMock = fs.promises.readFile as jest.Mock;\n  const writeFileMock = fs.promises.writeFile as jest.Mock;\n  const existsSyncMock = fs.existsSync as jest.Mock;\n  const homedirMock = os.homedir as jest.Mock;\n  const getDefaultServerConfigMock = getDefaultServerConfig as jest.Mock;\n\n  const originalPlatform = process.platform;\n\n  beforeEach(() => {\n    client = new ClaudeMCPClient();\n    jest.clearAllMocks();\n    homedirMock.mockReturnValue(mockHomeDir);\n    getDefaultServerConfigMock.mockReturnValue(mockServerConfig);\n\n    // Mock the Zod schema parse method\n    const { DefaultMCPClientConfig } = require('../../defaults');\n    DefaultMCPClientConfig.parse.mockImplementation((data: any) => data);\n  });\n\n  afterEach(() => {\n    Object.defineProperty(process, 'platform', {\n      value: originalPlatform,\n      writable: true,\n    });\n  });\n\n  describe('constructor', () => {\n    it('should set the correct name', () => {\n      expect(client.name).toBe('Claude Desktop');\n    });\n  });\n\n  describe('isClientSupported', () => {\n    it('should return true for macOS', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'darwin',\n        writable: true,\n      });\n      await expect(client.isClientSupported()).resolves.toBe(true);\n    });\n\n    it('should return true for Windows', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'win32',\n        writable: true,\n      });\n      await expect(client.isClientSupported()).resolves.toBe(true);\n    });\n\n    it('should return false for Linux', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'linux',\n        writable: true,\n      });\n      await expect(client.isClientSupported()).resolves.toBe(false);\n    });\n\n    it('should return false for other platforms', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'freebsd',\n        writable: true,\n      });\n      await expect(client.isClientSupported()).resolves.toBe(false);\n    });\n  });\n\n  describe('getConfigPath', () => {\n    it('should return correct path for macOS', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'darwin',\n        writable: true,\n      });\n\n      const configPath = await client.getConfigPath();\n      expect(configPath).toBe(\n        path.join(\n          mockHomeDir,\n          'Library',\n          'Application Support',\n          'Claude',\n          'claude_desktop_config.json',\n        ),\n      );\n    });\n\n    it('should return correct path for Windows', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'win32',\n        writable: true,\n      });\n\n      const mockAppData = 'C:\\\\Users\\\\Test\\\\AppData\\\\Roaming';\n      process.env.APPDATA = mockAppData;\n\n      const configPath = await client.getConfigPath();\n      expect(configPath).toBe(\n        path.join(mockAppData, 'Claude', 'claude_desktop_config.json'),\n      );\n    });\n\n    it('should throw error for unsupported platform', async () => {\n      Object.defineProperty(process, 'platform', {\n        value: 'linux',\n        writable: true,\n      });\n\n      await expect(client.getConfigPath()).rejects.toThrow(\n        'Unsupported platform: linux',\n      );\n    });\n  });\n\n  describe('isServerInstalled', () => {\n    beforeEach(() => {\n      Object.defineProperty(process, 'platform', {\n        value: 'darwin',\n        writable: true,\n      });\n    });\n\n    it('should return false when config file does not exist', async () => {\n      existsSyncMock.mockReturnValue(false);\n\n      const result = await client.isServerInstalled();\n      expect(result).toBe(false);\n    });\n\n    it('should return false when config file exists but posthog server is not configured', async () => {\n      existsSyncMock.mockReturnValue(true);\n      const configData = {\n        mcpServers: {\n          otherServer: mockServerConfig,\n        },\n      };\n      readFileMock.mockResolvedValue(JSON.stringify(configData));\n\n      const result = await client.isServerInstalled();\n      expect(result).toBe(false);\n    });\n\n    it('should return true when posthog server is configured', async () => {\n      existsSyncMock.mockReturnValue(true);\n      const configData = {\n        mcpServers: {\n          posthog: mockServerConfig,\n          otherServer: mockServerConfig,\n        },\n      };\n      readFileMock.mockResolvedValue(JSON.stringify(configData));\n\n      const result = await client.isServerInstalled();\n      expect(result).toBe(true);\n    });\n\n    it('should return false when config file is invalid JSON', async () => {\n      existsSyncMock.mockReturnValue(true);\n      readFileMock.mockResolvedValue('invalid json');\n\n      const result = await client.isServerInstalled();\n      expect(result).toBe(false);\n    });\n\n    it('should return false when readFile throws an error', async () => {\n      existsSyncMock.mockReturnValue(true);\n      readFileMock.mockRejectedValue(new Error('File read error'));\n\n      const result = await client.isServerInstalled();\n      expect(result).toBe(false);\n    });\n  });\n\n  describe('addServer', () => {\n    beforeEach(() => {\n      Object.defineProperty(process, 'platform', {\n        value: 'darwin',\n        writable: true,\n      });\n    });\n\n    it('should create config directory and add server when config file does not exist', async () => {\n      existsSyncMock.mockReturnValue(false);\n\n      await client.addServer(mockApiKey);\n\n      const expectedConfigPath = path.join(\n        mockHomeDir,\n        'Library',\n        'Application Support',\n        'Claude',\n        'claude_desktop_config.json',\n      );\n      const expectedConfigDir = path.dirname(expectedConfigPath);\n\n      expect(mkdirMock).toHaveBeenCalledWith(expectedConfigDir, {\n        recursive: true,\n      });\n\n      expect(writeFileMock).toHaveBeenCalledWith(\n        expectedConfigPath,\n        JSON.stringify(\n          {\n            mcpServers: {\n              posthog: mockServerConfig,\n            },\n          },\n          null,\n          2,\n        ),\n        'utf8',\n      );\n    });\n\n    it('should merge with existing config when config file exists', async () => {\n      existsSyncMock.mockReturnValue(true);\n      const existingConfig = {\n        mcpServers: {\n          existingServer: {\n            command: 'existing',\n            args: [],\n            env: {},\n          },\n        },\n      };\n      readFileMock.mockResolvedValue(JSON.stringify(existingConfig));\n\n      await client.addServer(mockApiKey);\n\n      expect(writeFileMock).toHaveBeenCalledWith(\n        expect.any(String),\n        JSON.stringify(\n          {\n            mcpServers: {\n              existingServer: existingConfig.mcpServers.existingServer,\n              posthog: mockServerConfig,\n            },\n          },\n          null,\n          2,\n        ),\n        'utf8',\n      );\n    });\n\n    it('should not overwrite existing config when it is invalid', async () => {\n      existsSyncMock.mockReturnValue(true);\n      readFileMock.mockResolvedValue(\n        JSON.stringify({\n          invalidKey: {\n            existingServer: {\n              command: 'existing',\n              args: [],\n              env: {},\n            },\n          },\n          x: 'y',\n        }),\n      );\n\n      await client.addServer(mockApiKey);\n\n      expect(writeFileMock).toHaveBeenCalledWith(\n        expect.any(String),\n        JSON.stringify(\n          {\n            invalidKey: {\n              existingServer: {\n                command: 'existing',\n                args: [],\n                env: {},\n              },\n            },\n            x: 'y',\n            mcpServers: {\n              posthog: mockServerConfig,\n            },\n          },\n          null,\n          2,\n        ),\n        'utf8',\n      );\n    });\n\n    it('should call getDefaultServerConfig with the provided API key', async () => {\n      existsSyncMock.mockReturnValue(false);\n\n      await client.addServer(mockApiKey);\n\n      expect(getDefaultServerConfigMock).toHaveBeenCalledWith(\n        mockApiKey,\n        'sse',\n        undefined,\n        undefined,\n      );\n    });\n  });\n\n  describe('removeServer', () => {\n    beforeEach(() => {\n      Object.defineProperty(process, 'platform', {\n        value: 'darwin',\n        writable: true,\n      });\n    });\n\n    it('should do nothing when config file does not exist', async () => {\n      existsSyncMock.mockReturnValue(false);\n\n      await client.removeServer();\n\n      expect(readFileMock).not.toHaveBeenCalled();\n      expect(writeFileMock).not.toHaveBeenCalled();\n    });\n\n    it('should remove posthog server from config', async () => {\n      existsSyncMock.mockReturnValue(true);\n      const configWithPosthog = {\n        mcpServers: {\n          posthog: mockServerConfig,\n          otherServer: {\n            command: 'other',\n            args: [],\n            env: {},\n          },\n        },\n      };\n      readFileMock.mockResolvedValue(JSON.stringify(configWithPosthog));\n\n      await client.removeServer();\n\n      expect(writeFileMock).toHaveBeenCalledWith(\n        expect.any(String),\n        JSON.stringify(\n          {\n            mcpServers: {\n              otherServer: configWithPosthog.mcpServers.otherServer,\n            },\n          },\n          null,\n          2,\n        ),\n        'utf8',\n      );\n    });\n\n    it('should do nothing when posthog server is not in config', async () => {\n      existsSyncMock.mockReturnValue(true);\n      const configWithoutPosthog = {\n        mcpServers: {\n          otherServer: {\n            command: 'other',\n            args: [],\n            env: {},\n          },\n        },\n      };\n      readFileMock.mockResolvedValue(JSON.stringify(configWithoutPosthog));\n\n      await client.removeServer();\n\n      expect(writeFileMock).not.toHaveBeenCalled();\n    });\n\n    it('should handle invalid JSON gracefully', async () => {\n      existsSyncMock.mockReturnValue(true);\n      readFileMock.mockResolvedValue('invalid json');\n\n      await client.removeServer();\n\n      expect(writeFileMock).not.toHaveBeenCalled();\n    });\n\n    it('should handle file read errors gracefully', async () => {\n      existsSyncMock.mockReturnValue(true);\n      readFileMock.mockRejectedValue(new Error('File read error'));\n\n      await client.removeServer();\n\n      expect(writeFileMock).not.toHaveBeenCalled();\n    });\n  });\n});\n"]}