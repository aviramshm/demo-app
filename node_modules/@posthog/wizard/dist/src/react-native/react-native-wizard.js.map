{"version":3,"file":"react-native-wizard.js","sourceRoot":"","sources":["../../../src/react-native/react-native-wizard.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\n\nimport {\n  abort,\n  askForAIConsent,\n  confirmContinueIfNoOrDirtyGitRepo,\n  ensurePackageIsInstalled,\n  getOrAskForProjectData,\n  getPackageDotJson,\n  getPackageManager,\n  installPackage,\n  isUsingTypeScript,\n  printWelcome,\n} from '../utils/clack-utils';\nimport { getPackageVersion, hasPackageInstalled } from '../utils/package-json';\nimport clack from '../utils/clack';\nimport { Integration } from '../lib/constants';\nimport { getReactNativeDocumentation } from './docs';\nimport { analytics } from '../utils/analytics';\nimport {\n  generateFileChangesForIntegration,\n  getFilesToChange,\n  getRelevantFilesForIntegration,\n} from '../utils/file-utils';\nimport type { WizardOptions } from '../utils/types';\nimport { askForCloudRegion } from '../utils/clack-utils';\nimport {\n  addEditorRulesStep,\n  addMCPServerToClientsStep,\n  runPrettierStep,\n} from '../steps';\nimport { EXPO } from '../utils/package-manager';\nimport { getOutroMessage } from '../lib/messages';\n\nexport async function runReactNativeWizard(\n  options: WizardOptions,\n): Promise<void> {\n  printWelcome({\n    wizardName: 'PostHog React Native wizard',\n  });\n\n  const aiConsent = await askForAIConsent(options);\n\n  if (!aiConsent) {\n    await abort(\n      'The React Native wizard requires AI to get setup right now. Please view the docs to setup React Native manually instead: https://posthog.com/docs/libraries/react-native',\n      0,\n    );\n  }\n\n  const cloudRegion = options.cloudRegion ?? (await askForCloudRegion());\n\n  const typeScriptDetected = isUsingTypeScript(options);\n\n  await confirmContinueIfNoOrDirtyGitRepo(options);\n\n  const packageJson = await getPackageDotJson(options);\n\n  await ensurePackageIsInstalled(packageJson, 'react-native', 'React Native');\n\n  const reactNativeVersion = getPackageVersion('react-native', packageJson);\n\n  if (reactNativeVersion) {\n    analytics.setTag('react-native-version', reactNativeVersion);\n  }\n\n  const { projectApiKey, accessToken, host, projectId } =\n    await getOrAskForProjectData({\n      ...options,\n      cloudRegion,\n    });\n\n  const sdkAlreadyInstalled = hasPackageInstalled('posthog-js', packageJson);\n\n  analytics.setTag('sdk-already-installed', sdkAlreadyInstalled);\n\n  const isUsingExpo = hasPackageInstalled('expo', packageJson);\n\n  if (isUsingExpo) {\n    analytics.setTag('is-using-expo', true);\n    analytics.setTag('expo-version', getPackageVersion('expo', packageJson));\n  }\n\n  clack.log.info(`Detected ${isUsingExpo ? 'Expo' : 'React Native'}`);\n\n  const packagesToInstall = isUsingExpo\n    ? [\n        'posthog-react-native',\n        'posthog-react-native-session-replay',\n        'expo-file-system',\n        'expo-application',\n        'expo-device',\n        'expo-localization',\n      ]\n    : [\n        'posthog-react-native',\n        '@react-native-async-storage/async-storage',\n        'react-native-device-info',\n        'react-native-localize',\n      ];\n\n  for (const packageName of packagesToInstall) {\n    await installPackage({\n      packageName,\n      packageNameDisplayLabel: packageName,\n      alreadyInstalled: !!packageJson?.dependencies?.[packageName],\n      forceInstall: options.forceInstall,\n      askBeforeUpdating: false,\n      installDir: options.installDir,\n      integration: Integration.reactNative,\n      packageManager: isUsingExpo ? EXPO : undefined,\n    });\n  }\n\n  const relevantFiles = await getRelevantFilesForIntegration({\n    installDir: options.installDir,\n    integration: Integration.reactNative,\n  });\n\n  const installationDocumentation = getReactNativeDocumentation({\n    language: typeScriptDetected ? 'typescript' : 'javascript',\n    host,\n    projectApiKey,\n  });\n\n  clack.log.info(\n    `Reviewing PostHog documentation for ${\n      isUsingExpo ? 'Expo' : 'React Native'\n    }`,\n  );\n\n  const filesToChange = await getFilesToChange({\n    integration: Integration.reactNative,\n    relevantFiles,\n    documentation: installationDocumentation,\n    accessToken,\n    cloudRegion,\n    projectId,\n  });\n\n  await generateFileChangesForIntegration({\n    integration: Integration.reactNative,\n    filesToChange,\n    accessToken,\n    installDir: options.installDir,\n    documentation: installationDocumentation,\n    cloudRegion,\n    projectId,\n  });\n\n  await runPrettierStep({\n    installDir: options.installDir,\n    integration: Integration.reactNative,\n  });\n\n  const addedEditorRules = await addEditorRulesStep({\n    installDir: options.installDir,\n    rulesName: 'react-native-rules.md',\n    integration: Integration.reactNative,\n  });\n\n  await addMCPServerToClientsStep({\n    cloudRegion,\n    integration: Integration.reactNative,\n  });\n\n  const packageManagerForOutro = await getPackageManager({\n    installDir: options.installDir,\n  });\n\n  const outroMessage = getOutroMessage({\n    options,\n    integration: Integration.reactNative,\n    cloudRegion,\n    addedEditorRules,\n    packageManager: packageManagerForOutro,\n    uploadedEnvVars: [],\n  });\n\n  clack.outro(outroMessage);\n\n  await analytics.shutdown('success');\n}\n"]}