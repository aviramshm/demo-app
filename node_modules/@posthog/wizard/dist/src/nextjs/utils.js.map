{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/nextjs/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { major, minVersion } from 'semver';\nimport fg from 'fast-glob';\nimport { abortIfCancelled } from '../utils/clack-utils';\nimport clack from '../utils/clack';\nimport type { WizardOptions } from '../utils/types';\nimport { Integration } from '../lib/constants';\n\nexport function getNextJsVersionBucket(version: string | undefined) {\n  if (!version) {\n    return 'none';\n  }\n\n  try {\n    const minVer = minVersion(version);\n    if (!minVer) {\n      return 'invalid';\n    }\n    const majorVersion = major(minVer);\n    if (majorVersion >= 11) {\n      return `${majorVersion}.x`;\n    }\n    return '<11.0.0';\n  } catch {\n    return 'unknown';\n  }\n}\n\nexport enum NextJsRouter {\n  APP_ROUTER = 'app-router',\n  PAGES_ROUTER = 'pages-router',\n}\n\nexport const IGNORE_PATTERNS = [\n  '**/node_modules/**',\n  '**/dist/**',\n  '**/build/**',\n  '**/public/**',\n  '**/.next/**',\n];\nexport async function getNextJsRouter({\n  installDir,\n}: Pick<WizardOptions, 'installDir'>): Promise<NextJsRouter> {\n  const pagesMatches = await fg('**/pages/_app.@(ts|tsx|js|jsx)', {\n    dot: true,\n    cwd: installDir,\n    ignore: IGNORE_PATTERNS,\n  });\n\n  const hasPagesDir = pagesMatches.length > 0;\n\n  const appMatches = await fg('**/app/**/layout.@(ts|tsx|js|jsx)', {\n    dot: true,\n    cwd: installDir,\n    ignore: IGNORE_PATTERNS,\n  });\n\n  const hasAppDir = appMatches.length > 0;\n\n  if (hasPagesDir && !hasAppDir) {\n    clack.log.info(\n      `Detected ${getNextJsRouterName(NextJsRouter.PAGES_ROUTER)} ðŸ“ƒ`,\n    );\n    return NextJsRouter.PAGES_ROUTER;\n  }\n\n  if (hasAppDir && !hasPagesDir) {\n    clack.log.info(\n      `Detected ${getNextJsRouterName(NextJsRouter.APP_ROUTER)} ðŸ“±`,\n    );\n    return NextJsRouter.APP_ROUTER;\n  }\n\n  const result: NextJsRouter = await abortIfCancelled(\n    clack.select({\n      message: 'What router are you using?',\n      options: [\n        {\n          label: getNextJsRouterName(NextJsRouter.APP_ROUTER),\n          value: NextJsRouter.APP_ROUTER,\n        },\n        {\n          label: getNextJsRouterName(NextJsRouter.PAGES_ROUTER),\n          value: NextJsRouter.PAGES_ROUTER,\n        },\n      ],\n    }),\n    Integration.nextjs,\n  );\n\n  return result;\n}\n\nexport const getNextJsRouterName = (router: NextJsRouter) => {\n  return router === NextJsRouter.APP_ROUTER ? 'app router' : 'pages router';\n};\n"]}