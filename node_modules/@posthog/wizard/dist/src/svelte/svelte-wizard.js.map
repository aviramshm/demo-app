{"version":3,"file":"svelte-wizard.js","sourceRoot":"","sources":["../../../src/svelte/svelte-wizard.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\n\nimport {\n  abort,\n  askForAIConsent,\n  confirmContinueIfNoOrDirtyGitRepo,\n  ensurePackageIsInstalled,\n  getOrAskForProjectData,\n  getPackageDotJson,\n  getPackageManager,\n  installPackage,\n  isUsingTypeScript,\n  printWelcome,\n} from '../utils/clack-utils';\nimport { getPackageVersion, hasPackageInstalled } from '../utils/package-json';\nimport clack from '../utils/clack';\nimport { Integration } from '../lib/constants';\nimport { getSvelteDocumentation } from './docs';\nimport { analytics } from '../utils/analytics';\nimport {\n  generateFileChangesForIntegration,\n  getFilesToChange,\n  getRelevantFilesForIntegration,\n} from '../utils/file-utils';\nimport type { WizardOptions } from '../utils/types';\nimport { askForCloudRegion } from '../utils/clack-utils';\nimport { addEditorRulesStep } from '../steps/add-editor-rules';\nimport { getOutroMessage } from '../lib/messages';\nimport {\n  addMCPServerToClientsStep,\n  addOrUpdateEnvironmentVariablesStep,\n  runPrettierStep,\n} from '../steps';\n\nexport async function runSvelteWizard(options: WizardOptions): Promise<void> {\n  printWelcome({\n    wizardName: 'PostHog Svelte wizard',\n  });\n\n  const aiConsent = await askForAIConsent(options);\n\n  if (!aiConsent) {\n    await abort(\n      'The Svelte wizard requires AI to get setup right now. Please view the docs to setup Svelte manually instead: https://posthog.com/docs/libraries/svelte',\n      0,\n    );\n  }\n\n  const cloudRegion = options.cloudRegion ?? (await askForCloudRegion());\n\n  const typeScriptDetected = isUsingTypeScript(options);\n\n  await confirmContinueIfNoOrDirtyGitRepo(options);\n\n  const packageJson = await getPackageDotJson(options);\n\n  await ensurePackageIsInstalled(packageJson, '@sveltejs/kit', '@sveltejs/kit');\n\n  const svelteVersion = getPackageVersion('@sveltejs/kit', packageJson);\n\n  if (svelteVersion) {\n    analytics.setTag('svelte-version', svelteVersion);\n  }\n\n  const { projectApiKey, accessToken, host, projectId } =\n    await getOrAskForProjectData({\n      ...options,\n      cloudRegion,\n    });\n\n  const sdkAlreadyInstalled = hasPackageInstalled('posthog-js', packageJson);\n\n  analytics.setTag('sdk-already-installed', sdkAlreadyInstalled);\n\n  const { packageManager: packageManagerFromInstallStep } =\n    await installPackage({\n      packageName: 'posthog-js',\n      packageNameDisplayLabel: 'posthog-js',\n      alreadyInstalled: !!packageJson?.dependencies?.['posthog-js'],\n      forceInstall: options.forceInstall,\n      askBeforeUpdating: false,\n      installDir: options.installDir,\n      integration: Integration.svelte,\n    });\n\n  await installPackage({\n    packageName: 'posthog-node',\n    packageNameDisplayLabel: 'posthog-node',\n    packageManager: packageManagerFromInstallStep,\n    alreadyInstalled: !!packageJson?.dependencies?.['posthog-node'],\n    forceInstall: options.forceInstall,\n    askBeforeUpdating: false,\n    installDir: options.installDir,\n    integration: Integration.svelte,\n  });\n\n  const relevantFiles = await getRelevantFilesForIntegration({\n    installDir: options.installDir,\n    integration: Integration.svelte,\n  });\n\n  const installationDocumentation = getSvelteDocumentation({\n    language: typeScriptDetected ? 'typescript' : 'javascript',\n  });\n\n  clack.log.info(`Reviewing PostHog documentation for Svelte`);\n\n  const filesToChange = await getFilesToChange({\n    integration: Integration.svelte,\n    relevantFiles,\n    documentation: installationDocumentation,\n    accessToken,\n    cloudRegion,\n    projectId,\n  });\n\n  await generateFileChangesForIntegration({\n    integration: Integration.svelte,\n    filesToChange,\n    accessToken,\n    installDir: options.installDir,\n    documentation: installationDocumentation,\n    cloudRegion,\n    projectId,\n  });\n\n  const { relativeEnvFilePath, addedEnvVariables } =\n    await addOrUpdateEnvironmentVariablesStep({\n      variables: {\n        ['PUBLIC_POSTHOG_KEY']: projectApiKey,\n        ['PUBLIC_POSTHOG_HOST']: host,\n      },\n      installDir: options.installDir,\n      integration: Integration.svelte,\n    });\n\n  const packageManagerForOutro =\n    packageManagerFromInstallStep ?? (await getPackageManager(options));\n\n  await runPrettierStep({\n    installDir: options.installDir,\n    integration: Integration.svelte,\n  });\n\n  const addedEditorRules = await addEditorRulesStep({\n    installDir: options.installDir,\n    rulesName: 'svelte-rules.md',\n    integration: Integration.svelte,\n  });\n\n  await addMCPServerToClientsStep({\n    cloudRegion,\n    integration: Integration.svelte,\n  });\n\n  const outroMessage = getOutroMessage({\n    options,\n    integration: Integration.svelte,\n    cloudRegion,\n    addedEditorRules,\n    packageManager: packageManagerForOutro,\n    envFileChanged: addedEnvVariables ? relativeEnvFilePath : undefined,\n    uploadedEnvVars: [],\n  });\n\n  clack.outro(outroMessage);\n\n  await analytics.shutdown('success');\n}\n"]}