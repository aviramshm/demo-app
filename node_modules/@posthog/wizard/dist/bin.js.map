{"version":3,"file":"bin.js","sourceRoot":"","sources":["../bin.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport { satisfies } from 'semver';\nimport { red } from './src/utils/logging';\n\nimport yargs from 'yargs';\nimport { hideBin } from 'yargs/helpers';\nimport chalk from 'chalk';\n\nconst NODE_VERSION_RANGE = '>=18.17.0';\n\n// Have to run this above the other imports because they are importing clack that\n// has the problematic imports.\nif (!satisfies(process.version, NODE_VERSION_RANGE)) {\n  red(\n    `PostHog wizard requires Node.js ${NODE_VERSION_RANGE}. You are using Node.js ${process.version}. Please upgrade your Node.js version.`,\n  );\n  process.exit(1);\n}\n\nimport { runMCPInstall, runMCPRemove } from './src/mcp';\nimport type { CloudRegion, WizardOptions } from './src/utils/types';\nimport { runWizard } from './src/run';\nimport { runEventSetupWizard } from './src/nextjs/event-setup';\nimport {\n  readEnvironment,\n  isNonInteractiveEnvironment,\n} from './src/utils/environment';\nimport path from 'path';\nimport clack from './src/utils/clack';\n\nif (isNonInteractiveEnvironment()) {\n  clack.intro(chalk.inverse(`PostHog Wizard`));\n\n  clack.log.error(\n    'This installer requires an interactive terminal (TTY) to run.\\n' +\n      'It appears you are running in a non-interactive environment.\\n' +\n      'Please run the wizard in an interactive terminal.',\n  );\n  process.exit(1);\n}\n\nif (process.env.NODE_ENV === 'test') {\n  void (async () => {\n    try {\n      const { server } = await import('./e2e-tests/mocks/server.js');\n      server.listen({\n        onUnhandledRequest: 'bypass',\n      });\n    } catch (error) {\n      // Mock server import failed - this can happen during non-E2E tests\n    }\n  })();\n}\n\nyargs(hideBin(process.argv))\n  .env('POSTHOG_WIZARD')\n  // global options\n  .options({\n    debug: {\n      default: false,\n      describe: 'Enable verbose logging\\nenv: POSTHOG_WIZARD_DEBUG',\n      type: 'boolean',\n    },\n    region: {\n      describe: 'PostHog cloud region\\nenv: POSTHOG_WIZARD_REGION',\n      choices: ['us', 'eu'],\n      type: 'string',\n    },\n    default: {\n      default: true,\n      describe:\n        'Use default options for all prompts\\nenv: POSTHOG_WIZARD_DEFAULT',\n      type: 'boolean',\n    },\n    signup: {\n      default: false,\n      describe:\n        'Create a new PostHog account during setup\\nenv: POSTHOG_WIZARD_SIGNUP',\n      type: 'boolean',\n    },\n  })\n  .command(\n    ['$0'],\n    'Run the PostHog setup wizard',\n    (yargs) => {\n      return yargs.options({\n        'force-install': {\n          default: false,\n          describe:\n            'Force install packages even if peer dependency checks fail\\nenv: POSTHOG_WIZARD_FORCE_INSTALL',\n          type: 'boolean',\n        },\n        'install-dir': {\n          describe:\n            'Directory to install PostHog in\\nenv: POSTHOG_WIZARD_INSTALL_DIR',\n          type: 'string',\n        },\n        integration: {\n          describe: 'Integration to set up',\n          choices: ['nextjs', 'astro', 'react', 'svelte', 'react-native'],\n          type: 'string',\n        },\n      });\n    },\n    (argv) => {\n      const options = { ...argv };\n      void runWizard(options as unknown as WizardOptions);\n    },\n  )\n  .command(\n    'event-setup',\n    'Run the event setup wizard',\n    (yargs) => {\n      return yargs.options({\n        'install-dir': {\n          describe:\n            'Directory to run the wizard in\\nenv: POSTHOG_WIZARD_INSTALL_DIR',\n          type: 'string',\n        },\n      });\n    },\n    (argv) => {\n      const finalArgs = {\n        ...argv,\n        ...readEnvironment(),\n      } as any;\n\n      let resolvedInstallDir: string;\n      if (finalArgs.installDir) {\n        if (path.isAbsolute(finalArgs.installDir)) {\n          resolvedInstallDir = finalArgs.installDir;\n        } else {\n          resolvedInstallDir = path.join(process.cwd(), finalArgs.installDir);\n        }\n      } else {\n        resolvedInstallDir = process.cwd();\n      }\n\n      const wizardOptions: WizardOptions = {\n        debug: finalArgs.debug ?? false,\n        installDir: resolvedInstallDir,\n        cloudRegion: finalArgs.region as CloudRegion | undefined,\n        default: finalArgs.default ?? false,\n        signup: finalArgs.signup ?? false,\n        forceInstall: false,\n      };\n\n      void runEventSetupWizard(wizardOptions);\n    },\n  )\n  .command('mcp <command>', 'MCP server management commands', (yargs) => {\n    return yargs\n      .command(\n        'add',\n        'Install PostHog MCP server to supported clients',\n        (yargs) => {\n          return yargs.options({\n            local: {\n              default: false,\n              describe:\n                'Add local development MCP server (http://localhost:8787)',\n              type: 'boolean',\n            },\n          });\n        },\n        (argv) => {\n          const options = { ...argv };\n          void runMCPInstall(\n            options as unknown as {\n              signup: boolean;\n              region?: CloudRegion;\n              local?: boolean;\n              debug?: boolean;\n            },\n          );\n        },\n      )\n      .command(\n        'remove',\n        'Remove PostHog MCP server from supported clients',\n        (yargs) => {\n          return yargs.options({\n            local: {\n              default: false,\n              describe:\n                'Remove local development MCP server (http://localhost:8787)',\n              type: 'boolean',\n            },\n          });\n        },\n        (argv) => {\n          const options = { ...argv };\n          void runMCPRemove(options as { local?: boolean });\n        },\n      )\n      .demandCommand(1, 'You must specify a subcommand (add or remove)')\n      .help();\n  })\n  .help()\n  .alias('help', 'h')\n  .version()\n  .alias('version', 'v')\n  .wrap(process.stdout.isTTY ? yargs.terminalWidth() : 80).argv;\n"]}