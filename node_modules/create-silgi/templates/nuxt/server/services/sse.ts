import { createEventStream, createService } from 'silgi'

export const sseApi = createService({
  path: '/_sse/test',
  handler: async (input, _shared, event) => {
    const eventStream = createEventStream(event as any)

    const interval = setInterval(async () => {
      await eventStream.push(`Message @ ${new Date().toLocaleTimeString()}`)
    }, 1000)

    eventStream.onClosed(async () => {
      clearInterval(interval)
      await eventStream.close()
    })

    return eventStream.send()
  },
})
