import { createClient, OpenAPIBuilder } from 'apiful'

let _authInstance: ReturnType<typeof createApi>

function createApi() {
  const url = useRequestURL()
  const headers = import.meta.server ? useRequestHeaders() : undefined
  // const config = useAppConfig()

  const client = createClient({
    baseURL: `${url.origin}`,
    headers: {
      ...headers,
    },
  })
    .with(OpenAPIBuilder<'silgi'>())

  return client
}

export function useApi() {
  if (!_authInstance) {
    _authInstance = createApi()
  }
  return _authInstance
}
